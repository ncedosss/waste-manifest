/* eslint-disable */
var Module = (() => {
  var _scriptName = import.meta.url;
  
  return (
function(moduleArg = {}) {
  var moduleRtn;

var Module=moduleArg;var readyPromiseResolve,readyPromiseReject;var readyPromise=new Promise((resolve,reject)=>{readyPromiseResolve=resolve;readyPromiseReject=reject});var ENVIRONMENT_IS_WEB=true;var ENVIRONMENT_IS_WORKER=false;var moduleOverrides=Object.assign({},Module);var arguments_=[];var thisProgram="./this.program";var quit_=(status,toThrow)=>{throw toThrow};var scriptDirectory="";function locateFile(path){if(Module["locateFile"]){return Module["locateFile"](path,scriptDirectory)}return scriptDirectory+path}var readAsync,readBinary;if(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER){if(ENVIRONMENT_IS_WORKER){scriptDirectory=self.location.href}else if(typeof document!="undefined"&&document.currentScript){scriptDirectory=document.currentScript.src}if(_scriptName){scriptDirectory=_scriptName}if(scriptDirectory.startsWith("blob:")){scriptDirectory=""}else{scriptDirectory=scriptDirectory.substr(0,scriptDirectory.replace(/[?#].*/,"").lastIndexOf("/")+1)}{readAsync=url=>fetch(url,{credentials:"same-origin"}).then(response=>{if(response.ok){return response.arrayBuffer()}return Promise.reject(new Error(response.status+" : "+response.url))})}}else{}var out=Module["print"]||console.log.bind(console);var err=Module["printErr"]||console.error.bind(console);Object.assign(Module,moduleOverrides);moduleOverrides=null;if(Module["arguments"])arguments_=Module["arguments"];if(Module["thisProgram"])thisProgram=Module["thisProgram"];var wasmBinary=Module["wasmBinary"];var wasmMemory;var ABORT=false;var EXITSTATUS;var HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAP64,HEAPU64,HEAPF64;function updateMemoryViews(){var b=wasmMemory.buffer;Module["HEAP8"]=HEAP8=new Int8Array(b);Module["HEAP16"]=HEAP16=new Int16Array(b);Module["HEAPU8"]=HEAPU8=new Uint8Array(b);Module["HEAPU16"]=HEAPU16=new Uint16Array(b);Module["HEAP32"]=HEAP32=new Int32Array(b);Module["HEAPU32"]=HEAPU32=new Uint32Array(b);Module["HEAPF32"]=HEAPF32=new Float32Array(b);Module["HEAPF64"]=HEAPF64=new Float64Array(b);Module["HEAP64"]=HEAP64=new BigInt64Array(b);Module["HEAPU64"]=HEAPU64=new BigUint64Array(b)}var __ATPRERUN__=[];var __ATINIT__=[];var __ATPOSTRUN__=[];var runtimeInitialized=false;function preRun(){if(Module["preRun"]){if(typeof Module["preRun"]=="function")Module["preRun"]=[Module["preRun"]];while(Module["preRun"].length){addOnPreRun(Module["preRun"].shift())}}callRuntimeCallbacks(__ATPRERUN__)}function initRuntime(){runtimeInitialized=true;if(!Module["noFSInit"]&&!FS.initialized)FS.init();FS.ignorePermissions=false;TTY.init();callRuntimeCallbacks(__ATINIT__)}function postRun(){if(Module["postRun"]){if(typeof Module["postRun"]=="function")Module["postRun"]=[Module["postRun"]];while(Module["postRun"].length){addOnPostRun(Module["postRun"].shift())}}callRuntimeCallbacks(__ATPOSTRUN__)}function addOnPreRun(cb){__ATPRERUN__.unshift(cb)}function addOnInit(cb){__ATINIT__.unshift(cb)}function addOnPostRun(cb){__ATPOSTRUN__.unshift(cb)}var runDependencies=0;var runDependencyWatcher=null;var dependenciesFulfilled=null;function getUniqueRunDependency(id){return id}function addRunDependency(id){runDependencies++;Module["monitorRunDependencies"]?.(runDependencies)}function removeRunDependency(id){runDependencies--;Module["monitorRunDependencies"]?.(runDependencies);if(runDependencies==0){if(runDependencyWatcher!==null){clearInterval(runDependencyWatcher);runDependencyWatcher=null}if(dependenciesFulfilled){var callback=dependenciesFulfilled;dependenciesFulfilled=null;callback()}}}function abort(what){Module["onAbort"]?.(what);what="Aborted("+what+")";err(what);ABORT=true;what+=". Build with -sASSERTIONS for more info.";var e=new WebAssembly.RuntimeError(what);readyPromiseReject(e);throw e}var dataURIPrefix="data:application/octet-stream;base64,";var isDataURI=filename=>filename.startsWith(dataURIPrefix);function findWasmBinary(){if(Module["locateFile"]){var f="signature-sdk.wasm";if(!isDataURI(f)){return locateFile(f)}return f}return new URL("signature-sdk.wasm",import.meta.url).href}var wasmBinaryFile;function getBinarySync(file){if(file==wasmBinaryFile&&wasmBinary){return new Uint8Array(wasmBinary)}if(readBinary){return readBinary(file)}throw"both async and sync fetching of the wasm failed"}function getBinaryPromise(binaryFile){if(!wasmBinary){return readAsync(binaryFile).then(response=>new Uint8Array(response),()=>getBinarySync(binaryFile))}return Promise.resolve().then(()=>getBinarySync(binaryFile))}function instantiateArrayBuffer(binaryFile,imports,receiver){return getBinaryPromise(binaryFile).then(binary=>WebAssembly.instantiate(binary,imports)).then(receiver,reason=>{err(`failed to asynchronously prepare wasm: ${reason}`);abort(reason)})}function instantiateAsync(binary,binaryFile,imports,callback){if(!binary&&typeof WebAssembly.instantiateStreaming=="function"&&!isDataURI(binaryFile)&&typeof fetch=="function"){return fetch(binaryFile,{credentials:"same-origin"}).then(response=>{var result=WebAssembly.instantiateStreaming(response,imports);return result.then(callback,function(reason){err(`wasm streaming compile failed: ${reason}`);err("falling back to ArrayBuffer instantiation");return instantiateArrayBuffer(binaryFile,imports,callback)})})}return instantiateArrayBuffer(binaryFile,imports,callback)}function getWasmImports(){return{a:wasmImports}}function createWasm(){var info=getWasmImports();function receiveInstance(instance,module){wasmExports=instance.exports;wasmExports=Asyncify.instrumentWasmExports(wasmExports);wasmMemory=wasmExports["Ga"];updateMemoryViews();wasmTable=wasmExports["Ja"];addOnInit(wasmExports["Ha"]);removeRunDependency("wasm-instantiate");return wasmExports}addRunDependency("wasm-instantiate");function receiveInstantiationResult(result){receiveInstance(result["instance"])}if(Module["instantiateWasm"]){try{return Module["instantiateWasm"](info,receiveInstance)}catch(e){err(`Module.instantiateWasm callback failed with error: ${e}`);readyPromiseReject(e)}}wasmBinaryFile??=findWasmBinary();instantiateAsync(wasmBinary,wasmBinaryFile,info,receiveInstantiationResult).catch(readyPromiseReject);return{}}var ASM_CONSTS={1046043:$0=>{let hidDevice=Emval.toValue($0);hidDevice.removeEventListener("inputreport",stuOnInputReport)},1046146:$0=>{let hidDevice=Emval.toValue($0);hidDevice.addEventListener("inputreport",stuOnInputReport)},1046246:()=>{if(!FS.analyzePath("/signature_sdk").exists){FS.mkdir("/signature_sdk");FS.mount(IDBFS,{},"/signature_sdk")}FS.syncfs(true,function(err){if(!err){ccall("readLicenceInternal","v")}else{ccall("readLicenceInternalError","v",["boolean"],false)}})},1046517:()=>{FS.syncfs(function(err){if(!err){ccall("writeLicenceInternal","v")}else{ccall("writeLicenceInternalError","v")}})},1046647:()=>{FS.syncfs(function(err){if(!err){ccall("deleteLicenceInternal","v")}else{ccall("deleteLicenceInternalError","v")}})},1046779:()=>Math.floor(Date.now()/1e3)};function stuOnInputReport(event){const typedArray=new Uint8Array(event.data.buffer);const numBytes=typedArray.length*typedArray.BYTES_PER_ELEMENT;const buf=Module._malloc(numBytes);Module.HEAPU8.set(typedArray,buf);Module.ccall("internalStuOnInputReport",null,["number","number","number"],[event.reportId,buf,numBytes]);Module._free(buf)}function SigCaptDialog_new(configPtr){function Button(){this.Bounds;this.Text;this.Click}function Rectangle(x,y,width,height){this.x=x;this.y=y;this.width=width;this.height=height;this.Contains=function(pt){if(pt.x>=this.x&&pt.x<=this.x+this.width&&(pt.y>=this.y&&pt.y<=this.y+this.height)){return true}else{return false}}}function getLocateString(string){var deStrings={evaluation:"Evaluierung",ok:"OK",cancel:"Abbrechen",clear:"Löschen",defaultName:"Kunde",defaultReason:"Bestätigt"};var elStrings={evaluation:"Αξιολόγηση",ok:"Εντάξει",cancel:"Ακύρωση",clear:"Διαγραφή",defaultName:"Πελάτης",defaultReason:"Επιβεβαιωμένος"};var enStrings={evaluation:"Evaluation",ok:"OK",cancel:"Cancel",clear:"Clear",defaultName:"Customer",defaultReason:"Confirmed"};var esStrings={evaluation:"Evaluación",ok:"Aceptar",cancel:"Cancelar",clear:"Borrar",defaultName:"Cliente",defaultReason:"Confirmado"};var frStrings={evaluation:"Évaluation",ok:"OK",cancel:"Annuler",clear:"Effacer",defaultName:"Client",defaultReason:"Confirmé"};var itStrings={evaluation:"Valutazione",ok:"OK",cancel:"Annulla",clear:"Cancella",defaultName:"Utente",defaultReason:"Confermato"};var jaStrings={evaluation:"評価",ok:"OK",cancel:"キャンセル",clear:"クリア",defaultName:"署名者",defaultReason:"確認済"};var koStrings={evaluation:"평가",ok:"확인",cancel:"취소",clear:"지우기",defaultName:"고객",defaultReason:"확인됨"};var nlStrings={evaluation:"Evaluatie",ok:"OK",cancel:"Annuleren",clear:"Verwijderen",defaultName:"Klant",defaultReason:"Bevestigd"};var plStrings={evaluation:"Ocena",ok:"OK",cancel:"Anuluj",clear:"Wyczyść",defaultName:"Klient",defaultReason:"Potwierdzono"};var ptStrings={evaluation:"Avaliação",ok:"OK",cancel:"Cancelar",clear:"Apagar",defaultName:"Cliente",defaultReason:"Confirmado"};var ruStrings={evaluation:"Оценка",ok:"OK",cancel:"Отмена",clear:"Удалить",defaultName:"Клиент",defaultReason:"Подтверждено"};var zhStrings={evaluation:"评估",ok:"确定",cancel:"取消",clear:"清除",defaultName:"顾客",defaultReason:"确认"};var strings={de:deStrings,el:elStrings,en:enStrings,es:esStrings,fr:frStrings,it:itStrings,ja:jaStrings,ko:koStrings,nl:nlStrings,pl:plStrings,pt:ptStrings,ru:ruStrings,zh:zhStrings};var userLang=(navigator.language||navigator.userLanguage||"en-GB").split("-")[0];let strLang=strings[userLang];if(strLang){}else{strLang=strings["en"]}return strLang[string]}function getPenOrientation(ev){let altitudeAngle=0;let azimuthAngle=0;let rotationAngle=0;if(ev instanceof PointerEvent){if(event.altitudeAngle!==undefined&&event.azimuthAngle!==undefined){altitudeAngle=event.altitudeAngle;azimuthAngle=event.azimuthAngle}else if(event.tiltX!==undefined&&event.tilY!==undefined){let params=tilt2spherical(event.tiltX,event.tiltY);altitudeAngle=params.altitudeAngle;azimuthAngle=params.azimuthAngle}return{altitude:altitudeAngle,azimuth:azimuthAngle,twist:event.twist}}else{const touch=ev.touches?ev.touches[0]:null;if(touch){if(touch.altitudeAngle){altitudeAngle=touch.altitudeAngle}if(touch.azimuthAngle){azimuthAngle=touch.azimuthAngle}if(touch.rotationAngle){rotationAngle=touch.rotationAngle}}return{altitude:altitudeAngle,azimuth:azimuthAngle,twist:rotationAngle}}function tilt2spherical(tiltX,tiltY){const tiltXrad=tiltX*Math.PI/180;const tiltYrad=tiltY*Math.PI/180;let azimuthAngle=0;if(tiltX==0){if(tiltY>0){azimuthAngle=Math.PI/2}else if(tiltY<0){azimuthAngle=3*Math.PI/2}}else if(tiltY==0){if(tiltX<0){azimuthAngle=Math.PI}}else if(Math.abs(tiltX)==90||Math.abs(tiltY)==90){azimuthAngle=0}else{const tanX=Math.tan(tiltXrad);const tanY=Math.tan(tiltYrad);azimuthAngle=Math.atan2(tanY,tanX);if(azimuthAngle<0){azimuthAngle+=2*Math.PI}}let altitudeAngle=0;if(Math.abs(tiltX)==90||Math.abs(tiltY)==90){altitudeAngle=0}else if(tiltX==0){altitudeAngle=Math.PI/2-Math.abs(tiltYrad)}else if(tiltY==0){altitudeAngle=Math.PI/2-Math.abs(tiltXrad)}else{altitudeAngle=Math.atan(1/Math.sqrt(Math.pow(Math.tan(tiltXrad),2)+Math.pow(Math.tan(tiltYrad),2)))}return{altitudeAngle,azimuthAngle}}}class SigCaptDialog{constructor(config){this.config=config;this.capturedPoints=new Array;this.onClearListeners=new Array;this.onCancelListeners=new Array;this.onOkListeners=new Array;this.timeOnSurface=0}addEventListener(eventType,listener){switch(eventType){case Module["EventType"].CLEAR:this.onClearListeners.push(listener);break;case Module["EventType"].CANCEL:this.onCancelListeners.push(listener);break;case Module["EventType"].OK:this.onOkListeners.push(listener);break}}async open(sigObj,who,why,extraData,integrityType,documentHash){this.sigObj=sigObj;this.extraData=extraData;if(who){this.signatory=who}else{this.signatory=getLocateString("defaultName")}if(why){this.reason=why}else{this.reason=getLocateString("defaultReason")}if(integrityType){this.integrityType=integrityType}else{this.integrityType=Module["KeyType"].None}if(documentHash){this.documentHash=documentHash}else{this.documentHash=new Module["Hash"](Module["HashType"].None)}this.createWindow(parseInt(this.config.width),parseInt(this.config.height));this.drawingCtx=this.drawingCanvas.getContext("2d");this.drawingCtx.fillStyle=this.config.strokeColor;this.drawingCtx.strokeStyle=this.config.strokeColor;this.drawingCtx.lineJoin="round";const devicePixelRatio=window.devicePixelRatio||1;this.drawingCtx.scale(devicePixelRatio,devicePixelRatio);this.drawingPath=new Path2D;this.mBtns=new Array(this.config.buttons.size());if(this.config.buttons.size()>0){const y=this.canvas.height*6/7;const h=this.canvas.height-y;const w=this.canvas.width/this.config.buttons.size();for(var i=0;i<this.config.buttons.size();i++){this.mBtns[i]=new Button;this.mBtns[i].Bounds=new Rectangle(i*w,y,w,h);let buttonText;if(this.config.buttons.get(i).text.startsWith("*")){buttonText=getLocateString(this.config.buttons.get(i).text.substr(1))}else{buttonText=this.config.buttons.get(i).text}this.mBtns[i].Text=buttonText;this.mBtns[i].Click=this.config.buttons.get(i).onClick}}this.ctx.lineWidth=1;this.ctx.strokeStyle="black";this.ctx.font="30px Arial";this.ctx.fillStyle="white";this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);this.canvasBackgroundImage=this.createScreenImage(true);const outer=this;const image=new Image;image.onload=function(){outer.ctx.drawImage(image,0,0)};image.src=this.canvasBackgroundImage}onTouchStart(event){this.onDown(event)}onMouseDown(event){this.onDown(event)}onTouchMove(event){this.onMove(event)}onMouseMove(event){this.onMove(event)}onTouchEnd(event){this.onUp(event)}onMouseUp(event){this.onUp(event)}onTouchCancel(event){this.onUp(event)}onPointerDown(event){this.onDown(event)}onPointerMove(event){this.onMovePointer(event)}onPointerUp(event){this.onUp(event)}onPointerCancel(event){this.onUp(event)}onMouseLeaveEvent(event){this.onMouseLeave(event)}onMouseEnterEvent(event){this.onMouseEnter(event)}onContextMenu(event){event.preventDefault()}onPointerLeave(event){this.onUp(event)}onPointerEnter(event){this.onDown(event)}startCapture(){if(!this.isCapturing){const touch_capable="ontouchstart"in document.documentElement;if(touch_capable){this.touchStartID=this.onTouchStart.bind(this);this.mouseDownID=this.onMouseDown.bind(this);this.touchMoveID=this.onTouchMove.bind(this);this.mouseMoveID=this.onMouseMove.bind(this);this.touchEndID=this.onTouchEnd.bind(this);this.mouseUpID=this.onMouseUp.bind(this);this.touchCancelID=this.onTouchCancel.bind(this);this.drawingCanvas.addEventListener("touchstart",this.touchStartID);this.drawingCanvas.addEventListener("mousedown",this.mouseDownID);this.drawingCanvas.addEventListener("touchmove",this.touchMoveID);this.drawingCanvas.addEventListener("mousemove",this.mouseMoveID);this.drawingCanvas.addEventListener("touchend",this.touchEndID);this.drawingCanvas.addEventListener("mouseup",this.mouseUpID);this.drawingCanvas.addEventListener("touchcancel",this.touchCancelID)}else{this.pointerDownID=this.onPointerDown.bind(this);this.pointerMoveID=this.onPointerMove.bind(this);this.pointerUpID=this.onPointerUp.bind(this);this.pointerCancelID=this.onPointerCancel.bind(this);this.pointerLeaveID=this.onPointerLeave.bind(this);this.pointerEnterID=this.onPointerEnter.bind(this);this.drawingCanvas.addEventListener("pointerdown",this.pointerDownID);this.drawingCanvas.addEventListener("pointermove",this.pointerMoveID);this.drawingCanvas.addEventListener("pointerup",this.pointerUpID);this.drawingCanvas.addEventListener("pointercancel",this.pointerCancelID);this.drawingCanvas.addEventListener("pointerleave",this.pointerLeaveID);this.drawingCanvas.addEventListener("pointerenter",this.pointerEnterID)}this.mouseLeaveID=this.onMouseLeaveEvent.bind(this);this.mouseEnterID=this.onMouseEnterEvent.bind(this);this.contextMenuID=this.onContextMenu.bind(this);this.drawingCanvas.addEventListener("mouseleave",this.mouseLeaveID);this.drawingCanvas.addEventListener("mouseenter",this.mouseEnterID);document.addEventListener("contextmenu",this.contextMenuID);this.isCapturing=true;this.showLoadingScreen(false);this.startTimeOut()}}stopCapture(){const touch_capable="ontouchstart"in document.documentElement;if(touch_capable){this.drawingCanvas.removeEventListener("touchstart",this.touchStartID);this.drawingCanvas.removeEventListener("mousedown",this.mouseDownID);this.drawingCanvas.removeEventListener("touchmove",this.touchMoveID);this.drawingCanvas.removeEventListener("mousemove",this.mouseMoveID);this.drawingCanvas.removeEventListener("touchend",this.touchEndID);this.drawingCanvas.removeEventListener("mouseup",this.mouseUpID);this.drawingCanvas.removeEventListener("touchcancel",this.touchCancelID)}else{this.drawingCanvas.removeEventListener("pointerdown",this.pointerDownID);this.drawingCanvas.removeEventListener("pointermove",this.pointerMoveID);this.drawingCanvas.removeEventListener("pointerup",this.pointerUpID);this.drawingCanvas.removeEventListener("pointercancel",this.pointerCancelID);this.drawingCanvas.removeEventListener("pointerleave",this.pointerLeaveID);this.drawingCanvas.removeEventListener("pointerenter",this.pointerEnterID)}this.drawingCanvas.removeEventListener("mouseleave",this.mouseLeaveID);this.drawingCanvas.removeEventListener("mouseenter",this.mouseEnterID);document.removeEventListener("contextmenu",this.contextMenuID);this.isCapturing=false;this.showLoadingScreen(true);this.stopTimeOut()}async close(){await this.closeWindow()}getBackgroundScreen(){return this.canvasBackgroundImage}getButton(x,y){const point={x,y};for(var i=0;i<this.mBtns.length;++i){if(this.mBtns[i].Bounds.Contains(point)){return i}}return-1}clickButton(btnIndex){if(this.mBtns.length>btnIndex){this.mBtns[btnIndex].Click()}}showLoadingScreen(value){if(value){this.mLoadingImageDiv.style.display="table"}else{this.mLoadingImageDiv.style.display="none"}}showGeneratingSignatureScreen(value){if(value){this.mGeneratingSignatureDiv.style.display="table"}else{this.mGeneratingSignatureDiv.style.display="none"}}createWindow(width,height){if(this.config.modal){this.mModalBackground=document.createElement("div");this.mModalBackground.id="modal-background";this.mModalBackground.className="active";this.mModalBackground.style.width="100%";this.mModalBackground.style.height="100%";this.mModalBackground.style.position="fixed";document.getElementsByTagName("body")[0].appendChild(this.mModalBackground)}if(this.config.attachTo){const parent=document.getElementById(this.config.attachTo);const offsets=parent.getBoundingClientRect();this.mSignatureWindow=document.createElement("div");this.mSignatureWindow.setAttribute("style","touch-action: none;z-index: 1001;");this.mSignatureWindow.id="signatureWindow";this.mSignatureWindow.style.top=0;this.mSignatureWindow.style.left=0;this.mSignatureWindow.style.width="100%";this.mSignatureWindow.style.height="100%";parent.appendChild(this.mSignatureWindow);this.mFormDiv=document.createElement("div");this.mFormDiv.setAttribute("style","touch-action: none;z-index: 1001;");this.mFormDiv.style.position="absolute";this.mFormDiv.style.width=width+"px";this.mFormDiv.style.height=height+"px";this.mSignatureWindow.appendChild(this.mFormDiv);this.canvas=document.createElement("canvas");this.canvas.id="myCanvas";this.canvas.style.position="absolute";this.canvas.height=this.mFormDiv.offsetHeight;this.canvas.width=this.mFormDiv.offsetWidth;this.canvas.style.opacity=this.config.background.alpha;this.ctx=this.canvas.getContext("2d");this.mFormDiv.appendChild(this.canvas);this.drawingCanvas=document.createElement("canvas");this.drawingCanvas.id="drawingCanvas";this.drawingCanvas.style.position="absolute";this.drawingCanvas.style.top=this.canvas.style.top;this.drawingCanvas.style.left=this.canvas.style.left;const devicePixelRatio=window.devicePixelRatio||1;this.drawingCanvas.height=this.canvas.height*devicePixelRatio;this.drawingCanvas.width=this.canvas.width*devicePixelRatio;this.drawingCanvas.style.width=this.canvas.width+"px";this.drawingCanvas.style.height=this.canvas.height+"px";this.mFormDiv.appendChild(this.drawingCanvas)}else{let titleBarHeight=this.config.hasTitle?25:0;let margin=0;this.mSignatureWindow=document.createElement("div");this.mSignatureWindow.setAttribute("style","touch-action: none;z-index: 1001;");this.mSignatureWindow.id="signatureWindow";this.mSignatureWindow.style.position="absolute";this.mSignatureWindow.style.borderWidth=this.config.borderWidth+"px";this.mSignatureWindow.style.borderStyle="solid";this.mSignatureWindow.style.borderColor=this.config.borderColor;if(this.config.centered){this.mSignatureWindow.style.top=window.innerHeight/2-height/2+"px";this.mSignatureWindow.style.left=window.innerWidth/2-width/2+"px"}else{this.mSignatureWindow.style.top=this.config.top;this.mSignatureWindow.style.left=this.config.left}this.mSignatureWindow.style.width=width+margin+margin+"px";this.mSignatureWindow.style.height=height+titleBarHeight+margin+margin+"px";document.getElementsByTagName("body")[0].appendChild(this.mSignatureWindow);if(this.config.hasTitle){this.mTitleBar=document.createElement("div");this.mTitleBar.id="titleBar";this.mTitleBar.setAttribute("style","display:table;padding:0;margin:0");this.mTitleBar.style.width="100%";this.mTitleBar.style.height=titleBarHeight+"px";this.mTitleBar.style.backgroundColor=this.config.borderColor;this.mTitleBar.innerHTML='<div style="padding-left:5px;display: table-cell; vertical-align: middle;height:'+titleBarHeight+'px;">'+this.config.title+"</div>";this.mSignatureWindow.appendChild(this.mTitleBar)}this.mFormDiv=document.createElement("div");this.mFormDiv.style.position="absolute";this.mFormDiv.style.margin="0";this.mFormDiv.style.top=titleBarHeight;this.mFormDiv.style.width=width+"px";this.mFormDiv.style.height=height+"px";this.mSignatureWindow.appendChild(this.mFormDiv);this.canvas=document.createElement("canvas");this.canvas.id="myCanvas";this.canvas.style.position="absolute";this.canvas.height=this.mFormDiv.offsetHeight;this.canvas.width=this.mFormDiv.offsetWidth;this.canvas.style.opacity=this.config.background.alpha;this.ctx=this.canvas.getContext("2d");this.mFormDiv.appendChild(this.canvas);this.drawingCanvas=document.createElement("canvas");this.drawingCanvas.id="drawingCanvas";this.drawingCanvas.style.position="absolute";this.drawingCanvas.style.top=this.canvas.style.top;this.drawingCanvas.style.left=this.canvas.style.left;const devicePixelRatio=window.devicePixelRatio||1;this.drawingCanvas.height=this.canvas.height*devicePixelRatio;this.drawingCanvas.width=this.canvas.width*devicePixelRatio;this.drawingCanvas.style.width=this.canvas.width+"px";this.drawingCanvas.style.height=this.canvas.height+"px";this.mFormDiv.appendChild(this.drawingCanvas);if(this.config.draggable){this.setDraggable()}}this.mLoadingImageDiv=document.createElement("div");this.mLoadingImageDiv.style.display="table";this.mLoadingImageDiv.style.position="absolute";this.mLoadingImageDiv.style.backgroundColor="white";this.mLoadingImageDiv.style.width="100%";this.mLoadingImageDiv.style.height="100%";this.mLoadingImageDiv.innerHTML='<div id="loadingDiv" style="padding-left:10px;display:table-cell;vertical-align:middle;"><table><tr><td><div class="sigCaptDialogLoader"></div></td><td>Loading the image, this could take a few seconds...</td></tr></table></div>';this.mFormDiv.appendChild(this.mLoadingImageDiv);this.mGeneratingSignatureDiv=document.createElement("div");this.mGeneratingSignatureDiv.style.display="none";this.mGeneratingSignatureDiv.style.position="absolute";this.mGeneratingSignatureDiv.style.backgroundColor="white";this.mGeneratingSignatureDiv.style.width="100%";this.mGeneratingSignatureDiv.style.height="100%";this.mGeneratingSignatureDiv.style.zIndex="10";this.mGeneratingSignatureDiv.innerHTML='<div id="generatingDiv" style="padding-left:10px;display:table-cell;vertical-align:middle;z-index:9"><table><tr><td><div class="sigCaptDialogLoader"></div></td><td>Generating the signature, this could take a few seconds...</td></tr></table></div>';this.mFormDiv.appendChild(this.mGeneratingSignatureDiv)}createScreenImage(useColor){let canvas=document.createElement("canvas");canvas.width=this.canvas.width;canvas.height=this.canvas.height;let ctx=canvas.getContext("2d");ctx.lineWidth=1;ctx.strokeStyle="black";ctx.fillStyle=useColor?this.config.background.color:"#ffffff";ctx.fillRect(0,0,this.canvas.width,this.canvas.height);if(this.config.background.image){if(this.config.background.mode===Module["BackgroundImageMode"].NONE){ctx.drawImage(this.config.background.image,0,0)}else if(this.config.background.mode===Module["BackgroundImageMode"].FIT){ctx.drawImage(this.config.background.image,0,0,canvas.width,canvas.height)}else if(this.config.background.mode===Module["BackgroundImageMode"].CENTER){ctx.drawImage(this.config.background.image,canvas.width/2-this.config.background.image.width/2,canvas.height/2-this.config.background.image.height/2)}else if(this.config.background.mode===Module["BackgroundImageMode"].PATTERN){const pattern=ctx.createPattern(this.config.background.image,"repeat");ctx.fillStyle=pattern;ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}}let minFontSize=Number.MAX_SAFE_INTEGER;for(let i=0;i<this.mBtns.length;i++){let btn=this.mBtns[i];let bounds=this.mBtns[i].Bounds;let textSize=this.fitTextOnCanvas(ctx,btn.Text,bounds,this.config.buttonsFont);if(textSize<minFontSize){minFontSize=textSize}}ctx.font=minFontSize+"px "+this.config.buttonsFont;let buttonsTop=0;for(let i=0;i<this.mBtns.length;++i){let btn=this.mBtns[i];let bounds=this.mBtns[i].Bounds;ctx.fillStyle=useColor?this.config.buttons.get(i).borderColor:"#000000";ctx.rect(bounds.x,bounds.y,bounds.width,bounds.height);ctx.fillStyle=useColor?this.config.buttons.get(i).backgroundColor:"#ffffff";ctx.fillRect(bounds.x,bounds.y,bounds.width,bounds.height);let metrics=ctx.measureText(btn.Text);let actualHeight=metrics.actualBoundingBoxAscent+metrics.actualBoundingBoxDescent;let xPos=bounds.x+(bounds.width/2-ctx.measureText(btn.Text).width/2);let yOffset=bounds.height-(bounds.height/2-actualHeight/2);ctx.fillStyle=useColor?this.config.buttons.get(i).textColor:"#000000";ctx.fillText(btn.Text,xPos,bounds.y+yOffset);buttonsTop=bounds.height;const button=document.createElement("button");button.setAttribute("style","position:absolute;padding:0;margin:0;");button.innerHTML='<div style="line-height:'+yOffset+'px">'+btn.Text+"</div>";button.style.left=bounds.x+"px";button.style.top=bounds.y+"px";button.style.width=bounds.width+"px";button.style.height=bounds.height+"px";button.style.font=minFontSize+"px "+this.config.buttonsFont;button.style.color=this.config.buttons.get(i).textColor;button.style.backgroundColor=this.config.buttons.get(i).backgroundColor;button.style.border=this.config.buttons.get(i).borderWidth+"px solid "+this.config.buttons.get(i).borderColor;button.onclick=btn.Click;button.addEventListener("touchend",function(e){e.preventDefault();btn.Click();return false},false);this.mFormDiv.appendChild(button)}if(this.sigObj.isEvaluation()){this.drawEvaluationString(getLocateString("evaluation"),ctx,this.canvas.width,this.canvas.height-buttonsTop,useColor)}if(this.reason&&this.config.reason.visible){ctx.fillStyle=useColor?this.config.reason.color:"#000000";ctx.font=this.config.reason.fontSize+"px "+this.config.reason.fontFace;let metrics=ctx.measureText(this.reason);let actualHeight=metrics.actualBoundingBoxAscent+metrics.actualBoundingBoxDescent;ctx.fillText(this.reason,this.config.reason.offsetX,actualHeight+this.config.reason.offsetY)}let dateOffsetY=0;const date=new Date;const dateString=("0"+date.getHours()).slice(-2)+":"+("0"+date.getMinutes()).slice(-2)+":"+("0"+date.getSeconds()).slice(-2)+" "+date.toLocaleString("default",{day:"2-digit",month:"long",year:"numeric"});ctx.fillStyle=useColor?this.config.date.color:"#000000";ctx.font=this.config.date.fontSize+"px "+this.config.date.fontFace;let metrics=ctx.measureText(dateString);let actualHeight=metrics.actualBoundingBoxAscent+metrics.actualBoundingBoxDescent;dateOffsetY=this.canvas.height-buttonsTop-actualHeight-this.config.date.offsetY;if(this.config.date.visible){ctx.fillText(dateString,this.canvas.width-metrics.width-this.config.date.offsetX,dateOffsetY)}let signatoryOffsetY=0;if(this.signatory){ctx.fillStyle=useColor?this.config.signatory.color:"#000000";ctx.font=this.config.signatory.fontSize+"px "+this.config.signatory.fontFace;let metrics=ctx.measureText(this.signatory);let actualHeight=metrics.actualBoundingBoxAscent+metrics.actualBoundingBoxDescent;signatoryOffsetY=dateOffsetY-actualHeight*2-this.config.signatory.offsetY;if(this.config.signatory.visible){ctx.fillText(this.signatory,this.canvas.width-metrics.width-this.config.signatory.offsetX,dateOffsetY-actualHeight-this.config.signatory.offsetY)}}if(this.config.signingLine.width>0&&this.config.signingLine.visible){ctx.strokeStyle=useColor?this.config.signingLine.color:"#000000";ctx.lineWidth=this.config.signingLine.width;ctx.moveTo(this.config.signingLine.left,signatoryOffsetY-this.config.signingLine.width-this.config.signingLine.offsetY);ctx.lineTo(this.canvas.width-this.config.signingLine.right,signatoryOffsetY-this.config.signingLine.width-this.config.signingLine.offsetY)}ctx.stroke();return canvas.toDataURL("image/jpeg")}async clearScreen(){this.drawingPath=new Path2D;this.drawingCtx.clearRect(0,0,this.drawingCanvas.width,this.drawingCanvas.height);this.capturedPoints=new Array;this.clearTimeOnSurface()}async closeWindow(){this.stopCapture();this.mSignatureWindow.remove();if(this.willEngine){this.willEngine.delete();this.willEngine=null}if(this.mModalBackground){this.mModalBackground.remove()}}async clear(){this.btnClearClick()}async accept(){this.btnOkClick()}async cancel(){this.btnCancelClick()}async btnOkClick(){if(this.capturedPoints.length>0){let minTimeOnSurface=0;if(this.config.minTimeOnSurface){minTimeOnSurface=this.config.minTimeOnSurface}if(this.timeOnSurface>minTimeOnSurface){this.stopTimeOut();this.showGeneratingSignatureScreen(true);let promise;if(this.externalGetCaptureData){promise=this.externalGetCaptureData}else{promise=this.getCaptureData()}promise.then(async value=>{if(value){await this.close();this.onOkListeners.forEach(listener=>listener())}else{alert("Error")}this.showGeneratingSignatureScreen(false)});promise.catch(error=>{alert(error);this.showGeneratingSignatureScreen(false)})}}}async btnClearClick(){await this.clearScreen();for(const listener of this.onClearListeners){await listener()}return true}async btnCancelClick(){await this.close();this.onCancelListeners.forEach(listener=>listener())}fitTextOnCanvas(context,text,bounds,fontface){let fontsize=300;let metrics;do{fontsize--;context.font=fontsize+"px "+fontface;metrics=context.measureText(text)}while(metrics.width>bounds.width||metrics.actualBoundingBoxAscent+metrics.actualBoundingBoxDescent>bounds.height);return fontsize}onMouseEnter(ev){ev.preventDefault()}onMouseLeave(ev){ev.preventDefault()}onDown(ev){ev.preventDefault();if(this.mDown==="down")return false;let pressure=0;let x,y;this.hasPressure=false;let pointerType;if(ev instanceof PointerEvent){if(ev.buttons!=1)return false;if(typeof ev.pressure!=="undefined"&&(ev.pointerType==="pen"||ev.pointerType==="stu")){pressure=ev.pressure;this.hasPressure=true}x=ev.offsetX;y=ev.offsetY;pointerType=ev.pointerType;this.pointerId=ev.pointerId;if(!this.config.allowZeroPressure){if(ev.pointerType==="pen"&&!ev.pressure){return false}}}else{const bcr=ev.target.getBoundingClientRect();if(ev.touches&&ev.touches[0]){if(typeof ev.touches[0]["force"]!=="undefined"&&ev.touches[0]["force"]>0&&ev.touches[0]["force"]<1){pressure=ev.targetTouches[0]["force"];this.hasPressure=true;pointerType="pen"}else{pointerType="touch"}x=ev.targetTouches[0].clientX-bcr.x;y=ev.targetTouches[0].clientY-bcr.y;this.pointerId=ev.targetTouches[0].identifier}else{pointerType="mouse";x=ev.clientX-bcr.x;y=ev.clientY-bcr.y;this.pointerId="mouse"}}switch(pointerType){case"mouse":if(!this.config.source.mouse)return;break;case"touch":if(!this.config.source.touch)return;break;case"pen":if(!this.config.source.pen)return;break;case"stu":if(!this.config.source.stu)return;break}this.mDown="down";this.disableScroll();let time=Math.floor(ev.timeStamp);if(this.willEngine){this.willEngine.delete();this.willEngine=null}this.willEngine=new Module["WillEngine"](this.config.strokeSize,this.hasPressure);this.willEngine.addPointerData(Module["Phase"].BEGIN,x>0?x:0,y>0?y:0,pressure,time);this.currentPath=new Path2D;const orientation=getPenOrientation(ev);var point={type:"down",x:x>0?x:0,y:y>0?y:0,p:pressure,t:time,azimuth:orientation.azimuth,altitude:orientation.altitude,twist:orientation.twist,isDown:true,stroke_id:this.currentStrokeID};this.capturedPoints.push(point);this.stopTimeOut();this.startDown=Date.now();this.drawingPoints=new Array;if(!this.config.allowZeroPressure){this.pressureHistory=[];this.pressureHistory.push(pressure)}}onMovePointer(ev){ev.preventDefault();if(this.mDown===undefined||this.mDown==="up")return false;let lastEvent;if(typeof ev.getCoalescedEvents==="function"){const events=ev.getCoalescedEvents();for(const myEvent of events){if(!lastEvent||myEvent.offsetX!=lastEvent.offsetX||myEvent.offsetY!=lastEvent.offsetY||myEvent.timeStamp!=lastEvent.timeStamp){if(!this.onMove(myEvent)){return false}}lastEvent=myEvent}if(!lastEvent||event.offsetX!=lastEvent.offsetX||event.offsetY!=lastEvent.offsetY||event.timeStamp!=lastEvent.timeStamp){if(!this.onMove(event)){return false}}}else{this.onMove(event)}}onMove(ev){ev.preventDefault();if(this.mDown===undefined||this.mDown==="up")return false;let pressure=0;let x,y;if(ev instanceof PointerEvent){if(typeof ev.pressure!=="undefined"&&(ev.pointerType==="pen"||ev.pointerType==="stu")){pressure=ev.pressure}x=ev.offsetX;y=ev.offsetY;if(this.pointerId!=="mouse"&&this.pointerId!==ev.pointerId){return false}}else{const bcr=ev.target.getBoundingClientRect();if(ev.touches&&ev.touches[0]){if(typeof ev.touches[0]["force"]!=="undefined"&&ev.touches[0]["force"]>0){pressure=ev.touches[0]["force"]}x=ev.targetTouches[0].clientX-bcr.x;y=ev.targetTouches[0].clientY-bcr.y;if(this.pointerId!==ev.targetTouches[0].identifier){return false}}else{x=ev.clientX-bcr.x;y=ev.clientY-bcr.y;if(this.pointerId!=="mouse"){return false}}}if(x>this.drawingCanvas.width||y>this.drawingCanvas.height||x<0||y<0){if(this.mDown==="down"){this.onUp(ev);if(!this.config.onOutSide||!this.config.onOutSide()){this.mDown="out"}}return false}else if(this.mDown==="out"){this.onDown(ev);return false}let time=Math.floor(ev.timeStamp);const orientation=getPenOrientation(ev);var point={type:"move",x:x>0?x:0,y:y>0?y:0,p:pressure,t:time,azimuth:orientation.azimuth,altitude:orientation.altitude,twist:orientation.twist,isDown:true,stroke_id:this.currentStrokeID};this.capturedPoints.push(point);if(this.willEngine){this.willEngine.addPointerData(Module["Phase"].UPDATE,x>0?x:0,y>0?y:0,pressure,time);const polygon=this.willEngine.getLastPolygon();const polygonPoints=polygon.getPoints();if(polygonPoints.size()>0){for(let i=0;i<polygonPoints.size();i++){const polygonPoint=polygonPoints.get(i);if(polygonPoint.pointType==Module["PolygonPointType"].MOVE){this.currentPath.moveTo(polygonPoint.x,polygonPoint.y)}else{this.currentPath.lineTo(polygonPoint.x,polygonPoint.y)}}}this.currentPath.closePath();polygon.delete();this.repaintScreen()}if(!this.config.allowZeroPressure){this.pressureHistory.push(pressure);if(this.pressureHistory.length>=3){if(this.pressureHistory.every((val,i,arr)=>val===arr[0])){this.capturedPoints=this.capturedPoints.slice(0,-3);this.mDown="up"}}}return true}onUp(ev){ev.preventDefault();if(this.mDown===undefined||this.mDown!=="down")return false;let pressure=0;let x,y;if(ev instanceof PointerEvent){if(typeof ev.pressure!=="undefined"&&(ev.pointerType==="pen"||ev.pointerType==="stu")){pressure=ev.pressure}x=ev.offsetX;y=ev.offsetY}else{const bcr=ev.target.getBoundingClientRect();if(this.mDown==="out"){if(ev.touches&&ev.touches[0]){if(typeof ev.touches[0]["force"]!=="undefined"&&ev.touches[0]["force"]>0){pressure=ev.touches[0]["force"]}x=ev.targetTouches[0].clientX-bcr.x;y=ev.targetTouches[0].clientY-bcr.y}else{x=ev.clientX-bcr.x;y=ev.clientY-bcr.y}}else{if(ev.changedTouches&&ev.changedTouches[0]){if(ev.changedTouches[0]["force"]!=="undefined"&&ev.changedTouches[0]["force"]>0){pressure=ev.changedTouches[0]["force"]}x=ev.changedTouches[0].clientX-bcr.x;y=ev.changedTouches[0].clientY-bcr.y}else{x=ev.clientX-bcr.x;y=ev.clientY-bcr.y}}}let time=Math.floor(ev.timeStamp);const orientation=getPenOrientation(ev);var point={type:"up",x:x>0?x:0,y:y>0?y:0,p:0,t:time,azimuth:orientation.azimuth,altitude:orientation.altitude,twist:orientation.twist,isDown:false,stroke_id:this.currentStrokeID};this.capturedPoints.push(point);this.startTimeOut();this.addTimeOnSurface(Date.now()-this.startDown);this.enableScroll();if(this.willEngine){this.willEngine.addPointerData(Module["Phase"].END,x>0?x:0,y>0?y:0,0,time);this.willEngine.getLastPolygon().delete();this.currentPath=null;const polygon=this.willEngine.getStroke();const polygonPoints=polygon.getPoints();for(let i=0;i<polygonPoints.size();i++){const polygonPoint=polygonPoints.get(i);if(polygonPoint.pointType==Module["PolygonPointType"].MOVE){this.drawingPath.moveTo(polygonPoint.x,polygonPoint.y)}else{this.drawingPath.lineTo(polygonPoint.x,polygonPoint.y)}}this.repaintScreen(true);polygon.delete()}this.mDown="up"}getCaptureData(){let strokeVector=new Module["StrokeVector"];let currentStroke=new Module["PointVector"];let currentStrokeID=0;let isDown=true;let hasDown=false;for(let index=0;index<this.capturedPoints.length;index++){if(!this.capturedPoints[index].isDown&&!hasDown){continue}hasDown=true;if(isDown&&!this.capturedPoints[index].isDown||!isDown&&this.capturedPoints[index].isDown){isDown=this.capturedPoints[index].isDown;strokeVector.push_back({points:currentStroke});currentStroke.delete();currentStroke=new Module["PointVector"];currentStrokeID++}var point={x:Math.floor(this.capturedPoints[index].x),y:Math.floor(this.capturedPoints[index].y),p:Math.floor(this.capturedPoints[index].p*1e3),t:this.capturedPoints[index].t,azimuth:this.capturedPoints[index].azimuth,altitude:this.capturedPoints[index].altitude,twist:this.capturedPoints[index].twist,is_down:this.capturedPoints[index].type=="down"||this.capturedPoints[index].type=="move",stroke_id:currentStrokeID};currentStroke.push_back(point)}const dimensions=this.mmToPx(1e3,1e3);var device={device_max_X:this.canvas.width,device_max_Y:this.canvas.height,device_max_P:1e3,device_pixels_per_m_x:dimensions.width,device_pixels_per_m_y:dimensions.height,device_origin_X:0,device_origin_Y:1,device_unit_pixels:true};const timeResolution=1e3;const where="";const myPromise=new Promise((resolve,reject)=>{try{const promise=this.sigObj.generateSignature(this.signatory,this.reason,where,this.integrityType,this.documentHash,strokeVector,device,this.config.osInfo,this.config.digitizerInfo,this.config.nicInfo,timeResolution);promise.then(value=>{if(value){if(this.extraData){var mapKeys=this.extraData.keys();for(let i=0;i<mapKeys.size();i++){const key=mapKeys.get(i);this.sigObj.setExtraData(key,this.extraData.get(key))}}}strokeVector.delete();currentStroke.delete();resolve(value)});promise.catch(error=>{strokeVector.delete();currentStroke.delete();reject(error)})}catch(exception){strokeVector.delete();currentStroke.delete();reject(exception)}});return myPromise}mmToPx(width,height){const el=document.createElement("div");el.style="width: "+width+"mm; height:"+height+"mm;";document.body.appendChild(el);const pxWidth=el.offsetWidth;const pxHeight=el.offsetHeight;document.body.removeChild(el);return{width:pxWidth,height:pxHeight}}drawEvaluationString(evaluationString,context,width,height,useColor){evaluationString=" "+evaluationString+" ";const hypotenuse=Math.sqrt(width*width+height*height);let testTextSize=300;context.font="300px verdana";let textMetrics=context.measureText(evaluationString);let desiredTextSize=testTextSize*hypotenuse/textMetrics.width;context.font=desiredTextSize+"px verdana";textMetrics=context.measureText(evaluationString);const angle=Math.atan(height/width);const newWidth=hypotenuse-(textMetrics.actualBoundingBoxAscent+textMetrics.actualBoundingBoxDescent)*Math.cos(-angle);desiredTextSize=desiredTextSize*newWidth/textMetrics.width;context.font=desiredTextSize+"px verdana";textMetrics=context.measureText(evaluationString);context.save();context.fillStyle=useColor?"LightGray":"#000000";context.translate(width/2,height/2);context.rotate(-angle);context.fillText(evaluationString,-textMetrics.width/2,(textMetrics.actualBoundingBoxAscent+textMetrics.actualBoundingBoxDescent)/2);context.restore()}startTimeOut(){if(this.config.timeOut&&this.config.timeOut.enabled&&this.config.timeOut.onTimeOut){this.stopTimeOut();this.timeOutInterval=setInterval(this.timeOutCallback.bind(this),this.config.timeOut.time)}}stopTimeOut(){if(this.timeOutInterval){clearInterval(this.timeOutInterval);this.timeOutInterval=null}}timeOutCallback(){if(this.timeOutInterval){clearInterval(this.timeOutInterval);this.timeOutInterval=null;this.config.timeOut.onTimeOut(this.timeOnSurface)}}addTimeOnSurface(time){this.timeOnSurface+=time}clearTimeOnSurface(){this.timeOnSurface=0}setDraggable(){const self=this;const titleBar=document.getElementById("titleBar");if(titleBar){titleBar.style.cursor="move";const signatureWindow=document.getElementById("signatureWindow");titleBar.addEventListener("pointerdown",function(e){e.preventDefault();this.initX=signatureWindow.offsetLeft;this.initY=signatureWindow.offsetTop;this.firstX=e.pageX;this.firstY=e.pageY;titleBar.addEventListener("pointermove",self.dragIt,false);window.addEventListener("pointerup",function(){titleBar.removeEventListener("pointermove",self.dragIt,false)},false)},false)}}dragIt(e){const signatureWindow=document.getElementById("signatureWindow");signatureWindow.style.left=this.initX+e.pageX-this.firstX+"px";signatureWindow.style.top=this.initY+e.pageY-this.firstY+"px"}disableScroll(){if(navigator.userAgent.indexOf("Firefox")!==-1){document.body.style.overflowY="hidden"}}enableScroll(){if(navigator.userAgent.indexOf("Firefox")!==-1){document.body.style.overflowY="auto"}}repaintScreen(force){if(!this.requestedDrawing||force){this.requestedDrawing=true;this.drawingCtx.clearRect(0,0,this.drawingCanvas.width,this.drawingCanvas.height);this.drawingCtx.fill(this.drawingPath);if(this.currentPath){this.drawingCtx.fill(this.currentPath)}requestAnimationFrame(()=>this.requestedDrawing=false)}}setGetCaptureData(funct){this.externalGetCaptureData=funct}}return Emval.toHandle(new SigCaptDialog(Emval.toValue(configPtr)))}function StuCaptDialog_new(stuDevicePtr,configPtr){class StuCaptDialog{constructor(stuDevice,config){this.stuDevice=stuDevice;this.config=config;this.mPenData=Array();this.onClearListeners=new Array;this.onCancelListeners=new Array;this.onOkListeners=new Array;this.stuDevice.addPenDataListener(Module["PenDataType"].PEN_DATA,this.onPenData.bind(this));this.stuDevice.addPenDataListener(Module["PenDataType"].PEN_DATA_OPTION,this.onPenDataOption.bind(this));this.stuDevice.addPenDataListener(Module["PenDataType"].PEN_DATA_TIME_COUNT_SEQUENCE,this.onPenDataTimeCountSequence.bind(this));this.stuDevice.addPenDataListener(Module["PenDataType"].PEN_DATA_ENCRYPTED,this.onPenDataEncrypted.bind(this));this.stuDevice.addPenDataListener(Module["PenDataType"].PEN_DATA_ENCRYPTED_OPTION,this.onPenDataEncryptedOption.bind(this));this.stuDevice.addPenDataListener(Module["PenDataType"].PEN_DATA_TIME_COUNT_SEQUENCE_ENCRYPTED,this.onPenDataTimeCountSequenceEncrypted.bind(this))}async open(sigObj,who,why,extraData,integrityType,documentHash){await this.stuDevice.connect(this.config.encryptSTU);this.mCapability=await this.stuDevice.getCapability();this.mInformation=await this.stuDevice.getInformation();this.mInkThreshold=await this.stuDevice.getInkThreshold();try{this.uid=await this.stuDevice.getUid()}catch(e){this.uid=0}try{this.uid2=await this.stuDevice.getUid2()}catch(e){this.uid2=0}let canvasWidth=0;let canvasHeight=0;if(this.config.fitMode===Module["FIT_MODE"].FIXED&&this.config.width&&this.config.height){canvasWidth=parseInt(this.config.width);canvasHeight=parseInt(this.config.height)}else if(this.config.attachTo){const parentWidth=document.getElementById(this.config.attachTo).offsetWidth;const parentHeight=document.getElementById(this.config.attachTo).offsetHeight;const pixelWidth=96*this.mCapability.tabletMaxX*.01/25.4;const pixelHeight=96*this.mCapability.tabletMaxY*.01/25.4;if(this.config.fitMode==Module["FIT_MODE"].FIT){canvasWidth=parentWidth;canvasHeight=parentHeight}else if(this.config.fitMode==Module["FIT_MODE"].STRECH){if(pixelWidth>pixelHeight){canvasWidth=parentWidth;canvasHeight=pixelHeight/pixelWidth*canvasWidth}else{canvasHeight=parentHeight;canvasWidth=pixelWidth/pixelHeight*canvasHeight}}else{canvasWidth=pixelWidth;canvasHeight=pixelHeight}}else{canvasWidth=96*this.mCapability.tabletMaxX*.01/25.4;canvasHeight=96*this.mCapability.tabletMaxY*.01/25.4}this.mScaleX=canvasWidth/this.mCapability.tabletMaxX;this.mScaleY=canvasHeight/this.mCapability.tabletMaxY;let useColor=true;let encodingFlag=Module["ProtocolHelper"].simulateEncodingFlag(this.stuDevice.getProductId(),this.mCapability.encodingFlag);if((encodingFlag&Module["EncodingFlag"].EncodingFlag_24bit.value)!=0){this.mEncodingMode=Module["EncodingMode"].EncodingMode_24bit}else if((encodingFlag&Module["EncodingFlag"].EncodingFlag_16bit.value)!=0){this.mEncodingMode=Module["EncodingMode"].EncodingMode_16bit}else{this.mEncodingMode=Module["EncodingMode"].EncodingMode_1bit;useColor=false}this.config.width=canvasWidth;this.config.height=canvasHeight;this.config.source.mouse=false;this.config.source.touch=false;this.config.source.pen=false;this.config.source.stu=true;this.sigCaptDialog=new Module["SigCaptDialog"](this.config);this.sigCaptDialog.setGetCaptureData=this.getCaptureData.bind(this);this.sigCaptDialog.addEventListener(Module["EventType"].CLEAR,this.onClearBtn.bind(this));this.sigCaptDialog.addEventListener(Module["EventType"].CANCEL,this.onCancelBtn.bind(this));this.sigCaptDialog.addEventListener(Module["EventType"].OK,this.onOkBtn.bind(this));await this.sigCaptDialog.open(sigObj,who,why,extraData,integrityType,documentHash);let canvas=await this.drawImageToCanvas(this.sigCaptDialog.createScreenImage(useColor));this.mDeviceBackgroundImage=Module["ProtocolHelper"].resizeAndFlatten(canvas,0,0,canvasWidth,canvasHeight,this.mCapability.screenWidth,this.mCapability.screenHeight,this.mEncodingMode,Module["Scale"].Scale_Stretch,"white",false,false);if(this.mInformation.modelName=="STU-300"||this.mInformation.modelName=="STU-520A"){await new Promise(resolve=>setTimeout(resolve,1e3))}await this.clearScreen();if(useColor){let htc=await this.stuDevice.getHandwritingThicknessColor();let components=this.hexToRgb(this.config.strokeColor);htc.penColor=this.rgb3216(components.r,components.g,components.b);htc.penThickness=this.config.strokeSize;await this.stuDevice.setHandwritingThicknessColor(htc)}const reportCountLengths=this.stuDevice.getReportCountLengths();if(reportCountLengths[Module["ReportId"].RenderingMode]){await this.stuDevice.setRenderingMode(Module["RenderingMode"].WILL)}await this.stuDevice.setInkingMode(Module["InkingMode"].On);try{await this.stuDevice.setPenDataOptionMode(Module["PenDataOptionMode"].TimeCountSequence)}catch(e){}if(this.config.encryptSTU){if(await this.stuDevice.supportsEncryption()){await this.stuDevice.startCapture(this.config.sessionID);this.mIsEncrypted=true}}return true}rgb3216(r,g,b){return(r&248)<<8|(g&252)<<3|(b&248)>>3}hexToRgb(hex){var result=new RegExp("^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$","i").exec(hex);return result?{r:parseInt(result[1],16),g:parseInt(result[2],16),b:parseInt(result[3],16)}:null}addEventListener(eventType,listener){switch(eventType){case Module["EventType"].CLEAR:this.onClearListeners.push(listener);break;case Module["EventType"].CANCEL:this.onCancelListeners.push(listener);break;case Module["EventType"].OK:this.onOkListeners.push(listener);break}}async drawWait(){const canvas=document.createElement("canvas");canvas.width=this.mCapability.screenWidth;canvas.height=this.mCapability.screenHeight;const ctx=canvas.getContext("2d");ctx.font="60pt Wingdings";const hourglass=String.fromCharCode(54);const metrics=ctx.measureText(hourglass);const width=metrics.width;const height=metrics.fontBoundingBoxAscent+metrics.fontBoundingBoxDescent;const size=Math.max(width,height);const lineWidth=3;canvas.width=size;canvas.height=size;ctx.fillStyle="white";ctx.fillRect(0,0,canvas.width,canvas.height);ctx.fillStyle="black";ctx.font="60pt Wingdings";ctx.fillText(hourglass,width/2-lineWidth,(height+metrics.fontBoundingBoxAscent)/2-lineWidth);ctx.strokeStyle="black";ctx.lineWidth=lineWidth;ctx.beginPath();ctx.arc(size/2,size/2,(size-lineWidth*2)/2,0,2*Math.PI);ctx.stroke();const x=Math.floor(this.mCapability.screenWidth/2-size/2);const y=Math.floor(this.mCapability.screenHeight/2-size/2);const image=Module["ProtocolHelper"].resizeAndFlatten(canvas,0,0,canvas.width,canvas.height,canvas.width,canvas.height,this.mEncodingMode,0,"white",false,false);const rect=new Module["Rectangle"](x,y,x+canvas.width-1,y+canvas.height-1);await this.stuDevice.writeImageArea(this.mEncodingMode,rect,image)}async clearScreen(){this.sigCaptDialog.stopCapture();this.stuDevice.stopEventHandler();await this.stuDevice.setClearScreen();if(this.config.showWait&&this.stuDevice.isSupported(Module["ReportId"].StartImageDataArea)){await this.drawWait()}await this.stuDevice.writeImage(this.mEncodingMode,this.mDeviceBackgroundImage);this.stuDevice.startEventHandler();this.sigCaptDialog.startCapture()}async disconnect(){if(this.stuDevice){this.stuDevice.stopEventHandler();if(this.mIsEncrypted){await this.stuDevice.endCapture();this.mIsEncrypted=false}await this.stuDevice.setInkingMode(Module["InkingMode"].Off);await this.stuDevice.setClearScreen();await this.stuDevice.disconnect()}}tabletToScreen(penData){return{x:penData.x*this.mScaleX,y:penData.y*this.mScaleY}}async clear(){if(this.sigCaptDialog){this.sigCaptDialog.clear()}}cancel(){if(this.sigCaptDialog){this.sigCaptDialog.cancel()}}accept(){if(this.sigCaptDialog){this.sigCaptDialog.accept()}}async onClearBtn(){if(this.mPenData.length>0){this.mPenData=new Array;await this.clearScreen()}this.sigCaptDialog.clearTimeOnSurface();for(const listener of this.onClearListeners){await listener()}}async onCancelBtn(){await this.disconnect();for(const listener of this.onCancelListeners){await listener()}}async onOkBtn(){await this.disconnect();for(const listener of this.onOkListeners){await listener()}}onPenDataOption(penData){penData.timeCount=penData.option;this.onPenData(penData)}onPenDataTimeCountSequence(penData){this.onPenData(penData)}onPenDataTimeCountSequenceEncrypted(penData){this.onPenDataTimeCountSequence(penData)}onPenDataEncryptedOption(penData){penData.penData1.sessionId=penData.sessionId;penData.penData2.sessionId=penData.sessionId;penData.penData1.timeCount=penData.option1;penData.penData2.timeCount=penData.option2;this.onPenData(penData.penData1);this.onPenData(penData.penData2)}onPenDataEncrypted(penData){penData.penData1.sessionId=penData.sessionId;penData.penData2.sessionId=penData.sessionId;this.onPenData(penData.penData1);this.onPenData(penData.penData2)}onPenData(penData){if(penData.sessionId&&penData.sessionId!==this.config.sessionID){return}if(!penData.timeCount){penData.timeCount=Date.now()}const pt=this.tabletToScreen(penData);const btnIndex=this.sigCaptDialog?.getButton(pt.x,pt.y);const isDown=penData.pressure>this.mInkThreshold?.onPressureMark;if(!this.mIsDown){if(isDown){this.mBtnIndex=btnIndex;if(this.mBtnIndex==-1){this.mPenData.push(penData);var downEvent=new PointerEvent("pointerdown",{pointerId:1,pointerType:"stu",isPrimary:true,clientX:pt.x,clientY:pt.y,pressure:penData.pressure/this.mCapability.tabletMaxPressure,buttons:1});this.sigCaptDialog.onDown(downEvent)}}else{this.mPenData.push(penData)}}else{if(!isDown){if(this.mBtnIndex>-1){if(btnIndex==this.mBtnIndex){this.sigCaptDialog.clickButton(this.mBtnIndex)}}else{var upEvent=new PointerEvent("pointerup",{pointerId:1,pointerType:"stu",isPrimary:true,clientX:pt.x,clientY:pt.y,pressure:penData.pressure/this.mCapability.tabletMaxPressure,buttons:1});this.sigCaptDialog.onUp(upEvent);this.mPenData.push(penData)}}else{if(this.mBtnIndex==-1){var moveEvent=new PointerEvent("pointermove",{pointerId:1,pointerType:"stu",isPrimary:true,clientX:pt.x,clientY:pt.y,pressure:penData.pressure/this.mCapability.tabletMaxPressure,buttons:1});this.sigCaptDialog.onMove(moveEvent);this.mPenData.push(penData)}}}this.mIsDown=isDown}getCaptureData(){let strokeVector=new Module["StrokeVector"];let currentStroke=new Module["PointVector"];let currentStrokeID=0;let isDown=true;let hasDown=false;for(let index=0;index<this.mPenData.length;index++){if(this.mPenData[index].sw==0&&!hasDown){continue}hasDown=true;if(isDown&&this.mPenData[index].sw==0||!isDown&&this.mPenData[index].sw==1){isDown=this.mPenData[index].sw==1;strokeVector.push_back({points:currentStroke});currentStroke.delete();currentStroke=new Module["PointVector"];currentStrokeID++}var point={x:this.mPenData[index].x,y:this.mPenData[index].y,p:this.mPenData[index].pressure,t:this.mPenData[index].timeCount,azimuth:0,altitude:0,twist:0,is_down:this.mPenData[index].sw,stroke_id:currentStrokeID};currentStroke.push_back(point)}var device={device_max_X:this.mCapability.tabletMaxX,device_max_Y:this.mCapability.tabletMaxY,device_max_P:this.mCapability.tabletMaxPressure,device_pixels_per_m_x:1e5,device_pixels_per_m_y:1e5,device_origin_X:0,device_origin_Y:1,device_unit_pixels:false};const osInfo="test";const digitizerInfo="STU;'"+this.mInformation.modelName+"';"+this.mInformation.firmwareMajorVersion+"."+(parseInt(this.mInformation.firmwareMinorVersion)>>4&15)+"."+(parseInt(this.mInformation.firmwareMinorVersion)&15)+";"+this.uid+";"+this.uid2;const nicInfo="";const timeResolution=1e3;const who=this.who;const why=this.why;const where="";const myPromise=new Promise((resolve,reject)=>{try{const promise=this.sigObj.generateSignature(who,why,where,this.integrityType,this.documentHash,strokeVector,device,osInfo,digitizerInfo,nicInfo,timeResolution);promise.then(value=>{if(value){if(this.extraData){for(const data of this.extraData){this.sigObj.setExtraData(data.name,data.value)}}}strokeVector.delete();currentStroke.delete();resolve(value)});promise.catch(error=>{strokeVector.delete();currentStroke.delete();reject(error)})}catch(exception){strokeVector.delete();currentStroke.delete();reject(exception)}});return myPromise}drawImageToCanvas(src){return new Promise((resolve,reject)=>{let img=new Image;img.onload=()=>{let canvas=document.createElement("canvas");canvas.height=img.height;canvas.width=img.width;let ctx=canvas.getContext("2d");ctx.drawImage(img,0,0);resolve(canvas)};img.onerror=reject;img.src=src})}}return Emval.toHandle(new StuCaptDialog(Emval.toValue(stuDevicePtr),Emval.toValue(configPtr)))}function Wizard_new(){class WizCtl{constructor(sigSDK){this.sigSDK=sigSDK;this.reset(false);this.useColor=true}static ObjectType={ObjectText:"OBJECT_TEXT",ObjectButton:"OBJECT_BUTTON",ObjectCheckbox:"OBJECT_CHECK_BOX",ObjectRadioButton:"OBJECT_RADIO_BUTTON",ObjectSignature:"OBJECT_SIGNATURE",ObjectInput:"OBJECT_INPUT",ObjectInputEcho:"OBJECT_INPUT_ECHO",ObjectImage:"OBJECT_IMAGE",ObjectDisplayAtShutdown:"OBJECT_DISPLAY_AT_SHUTDOWN",ObjectInking:"OBJECT_INKING",ObjectPrimitive:"OBJECT_PRIMITIVE"};static PadMode={PadIndeterminate:0,PadInteractive:1,PadSigning:2,PadInking:3,PadInput:4,PadShutdown:5};static ButtonOptions={BtnAlignCentre:0,BtnAlignMiddle:0,BtnAlignLeft:1,BtnAlignRight:2,BtnAlignTop:4,BtnAlignBottom:8,BtnInvert:16,BtnGreyed:32,BtnHiLiteClick:64};static CheckboxOptions={CheckboxUnchecked:0,CheckboxChecked:1,CheckboxDisplayTick:2,CheckboxDisplayCross:4};static InputEchoOptions={EchoNoSpacing:0,EchoHalfSpacing:1,EchoSingleSpacing:2,EchoDoubleSpacing:4,EchoUnderline:8};static PrimitiveType={Line:0,Rectangle:1,Ellipse:2};static PrimitiveOptions={LineSolid:1,LineDashed:2,Outline:4,Fill:8,FillXOR:16};IdRules={OBJECT_TEXT:{bReqd:false,reserved:{who:this.setWho.bind(this),why:this.setWhy.bind(this),when:this.setWhen.bind(this)}},OBJECT_BUTTON:{bReqd:true,reserved:{ok:this.onOk.bind(this),clear:this.onClear.bind(this),cancel:this.onCancel.bind(this),delete:this.onDelete.bind(this)}},OBJECT_IMAGE:{bReqd:true,reserved:{ok:this.onOk.bind(this),clear:this.onClear.bind(this),cancel:this.onCancel.bind(this),delete:this.onDelete.bind(this)}},OBJECT_CHECK_BOX:{bReqd:true,reserved:{}},OBJECT_RADIO_BUTTON:{bReqd:true,reserved:{}},OBJECT_SIGNATURE:{bReqd:false,reserved:{}},OBJECT_INPUT:{bReqd:false,reserved:{}},OBJECT_INPUT_ECHO:{bReqd:false,reserved:{}},OBJECT_HASH:{bReqd:false,reserved:{}},OBJECT_DISPLAY_AT_SHUTDOWN:{bReqd:false,reserved:{}},OBJECT_INKING:{bReqd:false,reserved:{}}};addObject(type,id,x,y,data,options){switch(type){case WizCtl.ObjectType.ObjectButton:return this.addObjectButton(id,x,y,data,options);case WizCtl.ObjectType.ObjectCheckbox:return this.addObjectCheckBox(id,x,y,data,options);case WizCtl.ObjectType.ObjectDisplayAtShutdown:return this.addObjectDisplayAtShutdown(id);case WizCtl.ObjectType.ObjectImage:return this.addObjectImage(id,x,y,data,options);case WizCtl.ObjectType.ObjectInking:return this.addObjectInking(id);case WizCtl.ObjectType.ObjectInput:return this.addObjectInput(id,data);case WizCtl.ObjectType.ObjectInputEcho:return this.addObjectInputEcho(id,x,y,data,options);case WizCtl.ObjectType.ObjectRadioButton:return this.addObjectRadioButton(id,x,y,data,options);case WizCtl.ObjectType.ObjectSignature:return this.addObjectSignature(id,data,options);case WizCtl.ObjectType.ObjectText:return this.addObjectText(id,x,y,data)}return null}addObjectButton(id,x,y,text,options){if(this.mPadMode==WizCtl.PadMode.PadShutdown){throw"Display already set as shutdown screen: interactive elements not allowed"}else if(!this.idOK(id,WizCtl.ObjectType.ObjectButton)){throw"Invalid Id"}else if(text===""){throw"Empty test"}else{let badOptions=false;let btnWdth=-1;let btnHght=-1;let flags=WizCtl.ButtonOptions.BtnAlignCentre|WizCtl.ButtonOptions.BtnAlignMiddle;if(typeof options==="object"){btnWdth=options.width;if(!btnWdth||btnWdth<=0){badOptions=true}btnHght=options.height;if(!btnHght||btnHght<=0){badOptions=true}if(options.flags&&!this.btnAlignOption(options.flags)){badOptions=true}else{flags=options.flags}}else if(typeof options==="number"){if(options<=0){badOptions=true}else{btnWdth=options}}else{badOptions=true}if(badOptions){throw"Invalid options"}else{const metrics=this.ctx.measureText(text);const width=metrics.width;const height=metrics.fontBoundingBoxAscent+metrics.fontBoundingBoxDescent;if(width>btnWdth){btnWdth=width}if(height>btnHght){btnHght=height}const canvas=document.createElement("canvas");canvas.width=btnWdth;canvas.height=btnHght;const ctx=canvas.getContext("2d");ctx.font=this.ctx.font;ctx.fillStyle=this.useColor?this.config.backColor:"white";ctx.fillRect(0,0,canvas.width,canvas.height);if(this.config.border.size){ctx.lineWidth=this.config.border.size;ctx.strokeStyle=this.useColor?this.config.border.color:"black";ctx.strokeRect(0,0,canvas.width,canvas.height)}let offsetX=0;if(flags&WizCtl.ButtonOptions.BtnAlignLeft){offsetX=0}else if(flags&WizCtl.ButtonOptions.BtnAlignRight){offsetX=canvas.width-width}else{offsetX=Math.floor(canvas.width/2-width/2)}let offsetY=0;if(flags&WizCtl.ButtonOptions.BtnAlignTop){offsetY=0}else if(flags&WizCtl.ButtonOptions.BtnAlignBottom){offsetY=0}else{offsetY=0}ctx.fillStyle=this.useColor?this.config.font.color:"black";ctx.fillText(text,offsetX,metrics.fontBoundingBoxAscent);const rect=new this.sigSDK.Rectangle(position.x,position.y,position.x+canvas.width-1,position.y+canvas.height-1);const position=this.getPosition(x,y,canvas.width,canvas.height);const buttonObject={id,type:WizCtl.ObjectType.ObjectButton,rect:new this.sigSDK.Rectangle(position.x,position.y,position.x+canvas.width-1,position.y+canvas.height-1),image:canvas,painted:false,font:ctx.font,backColor:this.mObjectBackgroundColor,foreColor:this.mObjectForegroundColor,text,flags,config:JSON.parse(JSON.stringify(this.config))};this.objects.push(buttonObject);if(this.mPadMode==WizCtl.PadMode.PadIndeterminate){this.mPadMode=WizCtl.PadMode.PadInteractive}return buttonObject}}return null}addObjectCheckBox(id,x,y,text,options){let option=WizCtl.CheckboxOptions.CheckboxUnchecked;if(options){if(!this.checkboxOption(options)){throw"Invalid options"}else{option=options}}if(this.mPadMode==WizCtl.PadMode.PadShutdown){throw"Display already set as shutdown screen: interactive elements not allowed"}else if(this.mPadMode==WizCtl.PadMode.PadInking){throw"Incompatible mode"}else if(!this.idOK(id,WizCtl.ObjectType.ObjectCheckbox)){throw"Invalid id"}else if(text===""){throw"Empty test"}else if(!this.ctx){throw"Not drawing context"}else{let checkboxFont;if(this.config.checkbox&&this.config.checkbox.size){this.ctx.font=this.getFont({size:this.config.checkbox.size})}checkboxFont=this.ctx.font;let metrics=this.ctx.measureText("☐ ");const offsetX=metrics.width;const width=metrics.width;const height=metrics.fontBoundingBoxAscent+metrics.fontBoundingBoxDescent;metrics=this.ctx.measureText("☐");const checkBoxWidth=metrics.width;const checkBoxHeight=metrics.fontBoundingBoxAscent+metrics.fontBoundingBoxDescent;const position=this.getPosition(x,y,width,height);if(this.config.checkbox&&this.config.checkbox.size){this.ctx.font=this.getFont({size:this.config.font.size})}const textObject=this.addObjectText("",Math.floor(x+offsetX),Math.floor(y),text);const textObjectHeight=textObject.rect.lowerRightYpixel-textObject.rect.upperLeftYpixel;const checkObject={id,type:WizCtl.ObjectType.ObjectCheckbox,checked:option&WizCtl.CheckboxOptions.CheckboxChecked,style:option&~WizCtl.CheckboxOptions.CheckboxChecked,font:checkboxFont,rect:new this.sigSDK.Rectangle(position.x,Math.floor(position.y-Math.trunc((checkBoxHeight-textObjectHeight)/2)),Math.floor(position.x+checkBoxWidth),Math.floor(position.y-(checkBoxHeight-textObjectHeight)/2+checkBoxHeight)),backColor:this.mObjectBackgroundColor,foreColor:this.mObjectForegroundColor,text};this.objects.push(checkObject);this.drawState(checkObject);return checkObject}return null}addObjectDisplayAtShutdown(id){if(this.mPadMode!=WizCtl.PadMode.PadIndeterminate&&this.mPadMode!=WizCtl.PadMode.PadShutdown){throw"Objects already set include interactive elements (not allowed on shutdown screen)"}else if(!this.idOK(id,WizCtl.ObjectType.ObjectDisplayAtShutdown)){throw"Invalid Id"}else{this.mPadMode=WizCtl.PadMode.PadShutdown}return{id,type:WizCtl.ObjectType.ObjectDisplayAtShutdown}}addObjectImage(id,x,y,img,options){if(this.mPadMode==WizCtl.PadMode.PadShutdown){throw"Display already set as shutdown screen: interactive elements not allowed"}else if(!this.idOK(id,WizCtl.ObjectType.ObjectImage)){throw"Invalid Id"}else if(!img){throw"Empty image"}else{const canvas=document.createElement("canvas");canvas.width=options&&options.width?options.width:img.width;canvas.height=options&&options.height?options.height:img.height;const ctx=canvas.getContext("2d");ctx.fillStyle=this.config.backColor;ctx.fillRect(0,0,canvas.width,canvas.height);ctx.drawImage(img,0,0,canvas.width,canvas.height);const position=this.getPosition(x,y,canvas.width,canvas.height);const imageObject={type:WizCtl.ObjectType.ObjectImage,rect:new this.sigSDK.Rectangle(position.x,position.y,position.x+canvas.width-1,position.y+canvas.height-1),image:canvas,painted:false};if(id){imageObject.id=id}this.objects.push(imageObject);if(this.mPadMode==WizCtl.PadMode.PadIndeterminate){this.mPadMode=WizCtl.PadMode.PadInteractive}return imageObject}return null}addObjectInking(id){if(this.mPadMode==WizCtl.PadMode.PadSigning||this.mPadMode==WizCtl.PadMode.PadShutdown||this.mPadMode==WizCtl.PadMode.PadInking){throw"Already setted incompabitle objects"}else if(!this.idOK(id,WizCtl.ObjectType.ObjectInking)){throw"Invalid Id"}else{this.mPadMode=WizCtl.PadMode.PadInking;this.inkingCanvas=document.createElement("canvas");this.inkingCanvas.width=this.mCapability.screenWidth;this.inkingCanvas.height=this.mCapability.screenHeight;const inkingObject={id,type:WizCtl.ObjectType.ObjectInking};this.objects.push(inkingObject);return inkingObject}return null}addObjectInput(id,data){if(this.mInput){throw"Multiple inputs"}else if(this.mSig){throw"Input is incompatible with signature object"}else if(this.mPadMode==WizCtl.PadMode.PadShutdown){throw"Display already set as shutdown screen: interactive elements not allowed"}else if(!this.idOK(id,WizCtl.ObjectType.ObjectInput)){throw"Invalid Id"}else if(!data instanceof Object){throw"Invalid input object"}else{this.mInput=data;if(!data.maxLength){data.maxLength=4}if(!data.minLength){data.minLength=0}this.mInput.input="";this.mPadMode=WizCtl.PadMode.PadInput;const inputObject={id,type:WizCtl.ObjectType.ObjectInput,minLength:data.minLength,maxLength:data.maxLength};this.objects.push(inputObject);return inputObject}}addObjectInputEcho(id,x,y,data,options){if(!this.mInput){throw"There is no input object"}else if(data&&data.length!=1){throw"data parameter should be either empty or a single char"}else{let spacing=0;const spacingMask=WizCtl.InputEchoOptions.EchoNoSpacing|WizCtl.InputEchoOptions.EchoHalfSpacing|WizCtl.InputEchoOptions.EchoSingleSpacing|WizCtl.InputEchoOptions.EchoDoubleSpacing;switch(options&spacingMask){case WizCtl.InputEchoOptions.EchoNoSpacing:spacing=0;break;case WizCtl.InputEchoOptions.EchoHalfSpacing:spacing=.5;break;case WizCtl.InputEchoOptions.EchoSingleSpacing:spacing=1;break;case WizCtl.InputEchoOptions.EchoDoubleSpacing:spacing=2;break}const putUnderline=options&WizCtl.InputEchoOptions.EchoUnderline;let metrics=this.ctx.measureText("_");for(var i=0;i<this.mInput.maxLength;i++){const canvas=document.createElement("canvas");canvas.width=metrics.width+1;canvas.height=metrics.fontBoundingBoxAscent+metrics.fontBoundingBoxDescent+1;const ctx=canvas.getContext("2d");ctx.font=this.ctx.font;ctx.fillStyle=this.useColor?this.config.backColor:"white";ctx.fillRect(0,0,canvas.width,canvas.height);ctx.fillStyle=this.useColor?this.config.borderColor:"black";ctx.fillText(i==0||putUnderline?"_":" ",0,metrics.fontBoundingBoxAscent);const position=this.getPosition(x,y,canvas.width,canvas.height);const newX=position.x+i*metrics.width+i*spacing*metrics.width;const inputEchoObject={id,type:WizCtl.ObjectType.ObjectInputEcho,rect:new this.sigSDK.Rectangle(newX,position.y,newX+canvas.width-1,position.y+canvas.height-1),image:canvas,painted:false,index:i,font:ctx.font,backColor:this.config.backColor,foreColor:this.config.borderColor,putUnderline,data};this.objects.push(inputEchoObject)}}}addObjectRadioButton(id,x,y,text,options){if(this.mPadMode==WizCtl.PadMode.PadShutdown){throw"Display already set as shutdown screen: interactive elements not allowed"}else if(this.mPadMode==WizCtl.PadMode.PadInking){throw"Incompatible mode"}else if(!this.idOK(id,WizCtl.ObjectType.ObjectRadioButton)){throw"Invalid id"}else if(text===""){throw"Empty test"}else if(!options||!options.Group){throw"Invalid group"}else{let radioFont;if(this.config.radiobutton&&this.config.radiobutton.size){this.ctx.font=this.getFont({size:this.config.radiobutton.size})}radioFont=this.ctx.font;let metrics=this.ctx.measureText("◯ ");const offsetX=metrics.width;const width=metrics.width;const height=metrics.fontBoundingBoxAscent+metrics.fontBoundingBoxDescent;metrics=this.ctx.measureText("◯");const radioButtonWidth=metrics.width;const radioButtonHeight=metrics.fontBoundingBoxAscent+metrics.fontBoundingBoxDescent;const position=this.getPosition(x,y,width,height);if(this.config.radiobutton&&this.config.radiobutton.size){this.ctx.font=this.getFont({size:this.config.font.size})}const textObject=this.addObjectText("",Math.floor(position.x+offsetX),position.y,text);const textObjectHeight=textObject.rect.lowerRightYpixel-textObject.rect.upperLeftYpixel;const radioObject={id,type:WizCtl.ObjectType.ObjectRadioButton,group:options.Group,checked:options.Checked,font:radioFont,rect:new this.sigSDK.Rectangle(position.x,Math.floor(position.y-Math.trunc((radioButtonHeight-textObjectHeight)/2)),Math.floor(position.x+radioButtonWidth),Math.floor(position.y-(radioButtonHeight-textObjectHeight)/2+radioButtonHeight)),backColor:this.mObjectBackgroundColor,foreColor:this.mObjectForegroundColor,text};this.objects.push(radioObject);if(radioObject.checked){radioObject.checked=false;this.selectRadioButton(radioObject)}else{this.drawState(radioObject)}return radioObject}return null}addObjectSignature(id,sigSDK,signature,options){if(this.mPadMode!=WizCtl.PadMode.PadIndeterminate&&this.mPadMode!=WizCtl.PadMode.PadSigning){throw"Already setted incompabitle objects"}else if(!this.idOK(id,WizCtl.ObjectType.ObjectSignature)){throw"Invalid Id"}else if(!signature){throw"Invalid signature object"}else{this.mPadMode=WizCtl.PadMode.PadSigning;this.sigSDK=sigSDK;this.mSigObj=signature;this.mSigOptions=options}const signatureObject={id,type:WizCtl.ObjectType.ObjectSignature};this.objects.push(signatureObject);return signatureObject}addObjectText(id,x,y,text){if(text===""){throw"Empty text"}if(!this.idOK(id,WizCtl.ObjectType.ObjectText)){throw"Invalid Id"}if(!this.ctx){throw"Not drawing context"}let lines=[];let maxLine=0;let maxLineIndex=0;let offsetX=0;if(typeof x=="number"){offsetX=x}const texts=text.split("\n");for(var i=0;i<texts.length;i++){let newText=texts[i];let textSize=newText.length;let acumulate=0;do{const lineWidth=this.getFirstLineWidth(newText,this.mCapability.screenWidth-offsetX);const line=newText.substring(0,lineWidth).trim();if(line.length>maxLine){maxLineIndex=lines.length;maxLine=line.length}lines.push(line);newText=newText.substring(lineWidth);acumulate+=lineWidth}while(acumulate<textSize)}const metrics=this.ctx.measureText(lines[maxLineIndex]);const lineHeight=metrics.fontBoundingBoxAscent+metrics.fontBoundingBoxDescent;const width=metrics.width;const height=lineHeight*lines.length;const position=this.getPosition(x,y,width,height);for(var i=0;i<lines.length;i++){const line=lines[i];let metrics=this.ctx.measureText(line);let borderWidth=0;if(this.config.border.size){borderWidth=this.config.border.size}let canvas=document.createElement("canvas");canvas.width=metrics.width+borderWidth*2+1;canvas.height=metrics.fontBoundingBoxAscent+metrics.fontBoundingBoxDescent+borderWidth*2+1;let ctx=canvas.getContext("2d");ctx.imageSmoothingEnabled=false;ctx.fontSmooth="never";ctx.font=this.ctx.font;ctx.fillStyle=this.useColor?this.config.backColor:"white";ctx.fillRect(0,0,canvas.width,canvas.height);ctx.fillStyle=this.useColor?this.config.font.color:"black";ctx.fillText(line,borderWidth,metrics.fontBoundingBoxAscent+borderWidth);if(this.config.border.size){ctx.lineWidth=this.config.border.size;ctx.strokeStyle=this.useColor?this.config.border.color:"black";ctx.strokeRect(0,0,canvas.width,canvas.height)}const textObject={id,type:WizCtl.ObjectType.ObjectText,rect:new this.sigSDK.Rectangle(position.x,position.y+lineHeight*i,position.x+canvas.width-1,position.y+canvas.height-1+lineHeight*i),image:canvas,painted:false};this.objects.push(textObject);let reserved=this.IdRules[WizCtl.ObjectType.ObjectText].reserved[id];if(reserved){reserved(text)}return textObject}return null}addPrimitive(type,x1,y1,x2,y2,lineWidth=1,options){if(x1=="left"){x1=0}else if(x1=="centre"){x1=this.mCapability.screenWidth/2}else if(x1=="right"){x1=this.mCapability.screenWidth}x1=Math.floor(x1);if(y1=="top"){y1=0}else if(y1=="middle"){y1=this.mCapability.screenHeight/2}else if(y1=="bottom"){y1=this.mCapability.screenHeight}y1=Math.floor(y1);if(x2=="left"){x2=0}else if(x2=="centre"){x2=this.mCapability.screenWidth/2}else if(x2=="right"){x2=this.mCapability.screenWidth}x2=Math.floor(x2);if(y2=="top"){y2=0}else if(y2=="middle"){y2=this.mCapability.screenHeight/2}else if(y2=="bottom"){y2=this.mCapability.screenHeight}y2=Math.floor(y2);switch(type){case WizCtl.PrimitiveType.Line:if(options){if(!this.lineOption(options)){throw"Parameter options invalid"}}else{options=WizCtl.PrimitiveOptions.LineSolid}break;case WizCtl.PrimitiveType.Rectangle:case WizCtl.PrimitiveType.Ellipse:if(options){if(!this.shapeOption(options)){throw"Parameter options invalid"}}else{options=WizCtl.PrimitiveOptions.LineSolid|WizCtl.PrimitiveOptions.Outline}break}const canvas=document.createElement("canvas");canvas.width=x2-x1>lineWidth?x2-x1:lineWidth;canvas.height=y2-y1>lineWidth?y2-y1:lineWidth;const ctx=canvas.getContext("2d");ctx.fillStyle=this.config.backColor;ctx.fillRect(0,0,canvas.width,canvas.height);ctx.lineWidth=lineWidth;ctx.strokeStyle=this.useColor?this.config.borderColor:"black";ctx.fillStyle=this.useColor?this.config.fillColor:"black";if(options&WizCtl.PrimitiveOptions.LineDashed){ctx.setLineDash([lineWidth])}switch(type){case WizCtl.PrimitiveType.Line:ctx.beginPath();ctx.moveTo(0,0);ctx.lineTo(x2-x1,y2-y1);ctx.stroke();break;case WizCtl.PrimitiveType.Rectangle:if(options&WizCtl.PrimitiveOptions.Fill){if(options&WizCtl.PrimitiveOptions.LineDashed){ctx.fillRect(lineWidth/2,lineWidth/2,x2-x1-lineWidth,y2-y1-lineWidth)}else{ctx.fillRect(0,0,x2-x1,y2-y1)}}if(options&WizCtl.PrimitiveOptions.LineSolid||options&WizCtl.PrimitiveOptions.LineDashed){ctx.strokeRect(0,0,x2-x1,y2-y1)}break;case WizCtl.PrimitiveType.Ellipse:if(options&WizCtl.PrimitiveOptions.Fill){if(options&WizCtl.PrimitiveOptions.LineSolid||options&WizCtl.PrimitiveOptions.LineDashed){ctx.beginPath();ctx.ellipse((x2-x1)/2,(y2-y1)/2,(x2-x1)/2-lineWidth,(y2-y1)/2-lineWidth,Math.PI/4,0,2*Math.PI);ctx.fill();ctx.beginPath();ctx.ellipse((x2-x1)/2,(y2-y1)/2,(x2-x1-lineWidth)/2,(y2-y1-lineWidth)/2,Math.PI/4,0,2*Math.PI);ctx.stroke()}else{ctx.beginPath();ctx.ellipse((x2-x1)/2,(y2-y1)/2,(x2-x1)/2,(y2-y1)/2,Math.PI/4,0,2*Math.PI);ctx.fill()}}else{ctx.beginPath();ctx.ellipse((x2-x1)/2,(y2-y1)/2,(x2-x1-lineWidth)/2,(y2-y1-lineWidth)/2,Math.PI/4,0,2*Math.PI);ctx.stroke()}break}const primitiveObject={type:WizCtl.ObjectType.ObjectPrimitive,rect:new this.sigSDK.Rectangle(x1,y1,x2-x1>lineWidth?x2-1:x1+lineWidth-1,y2-y1>lineWidth?y2-1:y1+lineWidth-1),image:canvas,painted:false};this.objects.push(primitiveObject);return primitiveObject}async display(showWait){if(showWait){showWait=this.supportsArea}if(this.config.forceMonochrome){this.mEncodingMode=this.sigSDK.EncodingMode.EncodingMode_1bit;this.useColor=false}if(showWait){await this.drawWait()}await this.draw(showWait);for(var i=0;i<this.objects.length;i++){if(this.mInput){if(this.objects[i].id&&this.objects[i].id.length==1){this.objects[i].handleInput=true}}}if(this.mPadMode==WizCtl.PadMode.PadSigning||this.mPadMode==WizCtl.PadMode.PadInking){await this.stuDevice.setInkingMode(this.sigSDK.InkingMode.On)}else{await this.stuDevice.setInkingMode(this.sigSDK.InkingMode.Off)}}async fireClick(id){for(var i=0;i<this.objects.length;i++){if(this.objects[i].id==id){const object=this.objects[i];if(object.type==WizCtl.ObjectType.ObjectCheckbox){if(object.checked==0){object.checked=1}else{object.checked=0}this.drawState(object);await this.draw()}else if(object.type==WizCtl.ObjectType.ObjectRadioButton){this.selectRadioButton(object);await this.draw()}else{const reserved=this.IdRules[this.objects[i].type].reserved[id];if(reserved){if(!await reserved()){if(this.objects[i].onClick){this.objects[i].onClick(this.objects[i])}}}else{if(this.objects[i].onClick){this.objects[i].onClick(this.objects[i])}}}}}}async padConnect(stuDevice){this.stuDevice=stuDevice;try{this.stuDevice.addPenDataListener(this.sigSDK.PenDataType.PEN_DATA,this.onPenData.bind(this));this.stuDevice.addPenDataListener(this.sigSDK.PenDataType.PEN_DATA_OPTION,this.onPenDataOption.bind(this));this.stuDevice.addPenDataListener(this.sigSDK.PenDataType.PEN_DATA_TIME_COUNT_SEQUENCE,this.onPenDataTimeCountSequence.bind(this));this.stuDevice.addPenDataListener(this.sigSDK.PenDataType.PEN_DATA_ENCRYPTED,this.onPenDataEncrypted.bind(this));this.stuDevice.addPenDataListener(this.sigSDK.PenDataType.PEN_DATA_ENCRYPTED_OPTION,this.onPenDataEncryptedOption.bind(this));this.stuDevice.addPenDataListener(this.sigSDK.PenDataType.PEN_DATA_TIME_COUNT_SEQUENCE_ENCRYPTED,this.onPenDataTimeCountSequenceEncrypted.bind(this));await this.stuDevice.connect(true);this.mCapability=await this.stuDevice.getCapability();this.mInformation=await this.stuDevice.getInformation();this.mInkThreshold=await this.stuDevice.getInkThreshold();this.setEncoding();try{await this.stuDevice.setPenDataOptionMode(this.sigSDK.PenDataOptionMode.TimeCountSequence)}catch(e){}await this.stuDevice.setClearScreen();await this.stuDevice.setInkingMode(this.sigSDK.InkingMode.Off)}catch(e){console.log(e);return false}this.canvas=document.createElement("canvas");this.canvas.width=this.mCapability.screenWidth;this.canvas.height=this.mCapability.screenHeight;this.ctx=this.canvas.getContext("2d");this.ctx.font=this.getFont();this.mScaleX=this.mCapability.screenWidth/this.mCapability.tabletMaxX;this.mScaleY=this.mCapability.screenHeight/this.mCapability.tabletMaxY;this.supportsArea=this.supportsWriteImageArea();this.connected=true;return true}async padDisconnect(){this.connected=false;if(this.stuDevice!=null){if(this.mIsEncrypted){await this.stuDevice.endCapture();this.mIsEncrypted=false}await this.stuDevice.setInkingMode(this.sigSDK.InkingMode.Off);if(this.mPadMode!=WizCtl.PadMode.PadShutdown){await this.stuDevice.setClearScreen()}await this.stuDevice.disconnect();delete this.stuDevice;this.stuDevice=null}}padModelName(){if(this.mInformation){return this.mInformation.modelName}return""}padHeight(){if(this.mCapability){return this.mCapability.screenHeight}return 0}padWidth(){if(this.mCapability){return this.mCapability.screenWidth}return 0}async reset(clear=true){this.objects=[];this.mPadMode=WizCtl.PadMode.PadIndeterminate;this.mObjectForegroundColor="black";this.mObjectBackgroundColor="white";this.mFont={};this.mInput=null;this.mPenEvents=[];this.mResolvers=[];this.mPromises=[];this.penDatas=[];this.mPenData=[];this.mObject=null;this.mSigObj=null;this.mSigOptions=null;this.emptyWaitCanvas=null;this.emptyWaitRect=null;this.inkingCanvas=null;if(this.mirrorCanvas){const div=document.getElementById(this.config.mirrorDiv.id);div.removeChild(this.mirrorCanvas);this.mirrorCanvas=null}if(clear){if(this.stuDevice){await new Promise(resolve=>setTimeout(resolve,100));await this.stuDevice.setClearScreen()}if(this.config.mirrorDiv){this.ctx.fillStyle="white";this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);this.ctx.drawImage(this.canvas,0,0)}}this.config={font:{name:"Verdana",size:"10px",color:"black"},border:{color:"black",style:"none"},backColor:"white",borderColor:"black",fillColor:"white",pushed:{font:{color:"white"},border:{color:"white"},backColor:"black",borderColor:"white",fillColor:"white"}};this.setEncoding()}async setProperty(config){this.mapConfig(config,this.config);if(config.pushed){if(!this.config.pushed){this.config.pushed={}}this.mapConfig(config.pushed,this.config.pushed)}if(this.ctx){this.ctx.font=this.getFont()}if(this.config.encrypted!=undefined){if(this.config.encrypted){if(!this.mIsEncrypted){await this.startEncryption()}}else{if(this.mIsEncrypted){await this.stopEncryption()}}}}mapConfig(src,dst){if(src.font){if(!dst.font){dst.font={}}if(src.font.name){dst.font.name=src.font.name}if(src.font.size){dst.font.size=src.font.size}if(src.font.style){dst.font.style=src.font.style}if(src.font.color){dst.font.color=src.font.color}}if(src.border){if(!dst.border){dst.border={}}if(src.border.size){dst.border.size=src.border.size}if(src.border.color){dst.border.color=src.border.color}if(src.border.style){dst.border.style=dst.border.style}}if(src.checkbox){if(!dst.checkbox){dst.checkbox={}}if(src.checkbox.size){dst.checkbox.size=src.checkbox.size}}if(src.radiobutton){if(!dst.radiobutton){dst.radiobutton={}}if(src.radiobutton.size){dst.radiobutton.size=src.radiobutton.size}}if(src.backColor){dst.backColor=src.backColor}if(src.borderColor){dst.borderColor=src.borderColor}if(src.fillColor){dst.fillColor=src.fillColor}if(src.mirrorDiv){if(!dst.mirrorDiv){dst.mirrorDiv={}}if(src.mirrorDiv.id){dst.mirrorDiv.id=src.mirrorDiv.id}if(src.mirrorDiv.width){dst.mirrorDiv.width=src.mirrorDiv.width}if(src.mirrorDiv.height){dst.mirrorDiv.height=src.mirrorDiv.height}if(src.mirrorDiv.enable!==undefined){dst.mirrorDiv.enable=src.mirrorDiv.enable}}if(src.encrypted!==undefined){dst.encrypted=src.encrypted}if(src.sessionId){dst.sessionId=src.sessionId}if(src.forceMonochrome!==undefined){dst.forceMonochrome=src.forceMonochrome;this.setEncoding()}if(src.invert!==undefined){dst.invert=src.invert}}async startEncryption(){if(this.connected){if(this.stuDevice.isSupported(this.sigSDK.ReportId.EncryptionStatus)||await this.sigSDK.ProtocolHelper.supportsEncryption(this.stuDevice.getProtocol())){await this.stuDevice.startCapture(this.config.sessionId);this.mIsEncrypted=true}}}async stopEncryption(){if(this.mIsEncrypted){await this.stuDevice.endCapture();this.mIsEncrypted=false}}tabletToScreen(penData){return new WizCtl.Point(penData.x*this.mScaleX,penData.y*this.mScaleY)}screenToTablet(x,y){return new WizCtl.Point(x/this.mScaleX,y/this.mScaleY)}contains(rect,pt){if(pt.x>=rect.upperLeftXpixel&&pt.x<=rect.lowerRightXpixel&&(pt.y<=rect.lowerRightYpixel&&pt.y>=rect.upperLeftYpixel)){return true}else{return false}}getObject(point){for(var i=this.objects.length-1;i>-1;i--){if(this.objects[i].rect&&this.contains(this.objects[i].rect,point)){return this.objects[i]}}return null}onPenDataOption(penData){this.onPenData(penData)}onPenDataTimeCountSequence(penData){this.onPenData(penData)}onPenDataTimeCountSequenceEncrypted(penData){this.onPenDataTimeCountSequence(penData)}onPenDataEncryptedOption(penData){this.onPenData(penData.penData1);this.onPenData(penData.penData2)}onPenDataEncrypted(penData){this.onPenData(penData.penData1);this.onPenData(penData.penData2)}onPenData(penData){if(penData.sessionId&&penData.sessionId!==this.config.sessionId){return}this.mPromises.push(new Promise(resolve=>{this.mResolvers.push(resolve);this.mPenEvents.push(penData);if(this.mPenEvents.length===1){this.onPenDataInternal(penData)}}))}async onPenDataInternal(){if(!this.connected){return}const penData=this.mPenEvents[0];let redraw=false;const pt=this.tabletToScreen(penData);const object=this.getObject(pt);if(this.mObject!=null&&object==null){if(this.mObject.type==WizCtl.ObjectType.ObjectButton&&this.mObject.pushed){this.mObject.pushed=false;this.drawState(this.mObject)}}const isDown=penData.pressure>this.mInkThreshold?.onPressureMark;if(!this.mIsDown){if(isDown){this.mIsDown=true;this.mObject=object;if(this.mObject==null){if(!penData.fromMouse){if(this.mPadMode==WizCtl.PadMode.PadSigning||this.mPadMode==WizCtl.PadMode.PadInking){this.mPenData.push(penData);var downEvent=new PointerEvent("pointerdown",{pointerId:1,pointerType:"pen",isPrimary:true,clientX:pt.x,clientY:pt.y,pressure:penData.pressure/this.mCapability.tabletMaxPressure});if(this.mirrorCanvas){this.inkToMirror(downEvent)}if(this.mPadMode==WizCtl.PadMode.PadInking){this.inkToCanvas(downEvent)}}}}else{if(this.mObject.type==WizCtl.ObjectType.ObjectButton){this.mObject.pushed=true;this.drawState(this.mObject)}}}else{if(this.mPadMode==WizCtl.PadMode.PadSigning||this.mPadMode==WizCtl.PadMode.PadInking){if(!penData.fromMouse){this.mPenData.push(penData)}}}}else{if(!isDown){if(this.mObject!=null){if(object!=null&&object.id==this.mObject.id){if(object.type==WizCtl.ObjectType.ObjectCheckbox){if(object.checked==0){object.checked=1}else{object.checked=0}this.drawState(object);redraw=true}else if(object.type==WizCtl.ObjectType.ObjectRadioButton){this.selectRadioButton(object);redraw=true}else if(object.type==WizCtl.ObjectType.ObjectButton){if(object.pushed){object.pushed=false;this.drawState(object);redraw=true;let reserved=this.IdRules[WizCtl.ObjectType.ObjectButton].reserved[object.id];if(reserved){if(object.id=="delete"){if(reserved()){redraw=true}}else if(await reserved()){return}}}}if(object.handleInput&&this.handleInput(object)){this.onInput(object);redraw=true}if(object.onClick&&await object.onClick(object)){this.mPenEvents=[];this.mPromises=[];this.mResolvers.forEach(value=>{value()});this.mResolvers=[];return}}}else{if(!penData.fromMouse&&(this.mObject==null||this.mObject.type!=WizCtl.ObjectType.ObjectButton&&this.mObject.type!=WizCtl.ObjectType.ObjectImage)){if(this.mPadMode==WizCtl.PadMode.PadSigning||this.mPadMode==WizCtl.PadMode.PadInking){this.mPenData.push(penData);var upEvent=new PointerEvent("pointerup",{pointerId:1,pointerType:"pen",isPrimary:true,clientX:pt.x,clientY:pt.y,pressure:penData.pressure/this.mCapability.tabletMaxPressure});if(this.mirrorCanvas){this.inkToMirror(upEvent)}if(this.mPadMode==WizCtl.PadMode.PadInking){this.inkToCanvas(upEvent)}}}}this.mObject=null;this.mIsDown=false}else{if(!penData.fromMouse&&(this.mObject==null||this.mObject.type!=WizCtl.ObjectType.ObjectButton&&this.mObject.type!=WizCtl.ObjectType.ObjectImage)){if(this.mPadMode==WizCtl.PadMode.PadSigning||this.mPadMode==WizCtl.PadMode.PadInking){this.mPenData.push(penData);var moveEvent=new PointerEvent("pointermove",{pointerId:1,pointerType:"pen",isPrimary:true,clientX:pt.x,clientY:pt.y,pressure:penData.pressure/this.mCapability.tabletMaxPressure});if(this.mirrorCanvas){this.inkToMirror(moveEvent)}if(this.mPadMode==WizCtl.PadMode.PadInking){this.inkToCanvas(moveEvent)}}}}}if(redraw){await new Promise(resolve=>setTimeout(resolve,100));await this.draw()}this.mPenEvents.shift();this.mPromises.shift();this.mResolvers.shift()();if(this.mPenEvents.length>0){await this.onPenDataInternal()}}setEncoding(){if(this.config.forceMonochrome){this.mEncodingMode=this.sigSDK.EncodingMode.EncodingMode_1bit;this.useColor=false}else if(this.stuDevice){let encodingFlag=this.sigSDK.ProtocolHelper.simulateEncodingFlag(this.stuDevice.getProductId(),this.mCapability.encodingFlag);if((encodingFlag&this.sigSDK.EncodingFlag.EncodingFlag_24bit.value)!=0){this.mEncodingMode=this.sigSDK.EncodingMode.EncodingMode_24bit;this.useColor=true}else if((encodingFlag&this.sigSDK.EncodingFlag.EncodingFlag_16bit.value)!=0){this.mEncodingMode=this.sigSDK.EncodingMode.EncodingMode_16bit;this.useColor=true}else{this.mEncodingMode=this.sigSDK.EncodingMode.EncodingMode_1bit;this.useColor=false}}}supportsWriteImageArea(){return this.stuDevice.isSupported(this.sigSDK.ReportId.StartImageDataArea)}getFont(data){let font="";if(data&&data.style){font+=this.data.style+" "}else if(this.config.font.style){font+=this.config.font.style+" "}if(data&&data.size){font+=data.size+" "}else if(this.config.font.size){font+=this.config.font.size+" "}if(data&&data.name){font+=data.name+" "}else if(this.config.font.name){font+=this.config.font.name+" "}return font}getPosition(x,y,width,height){if(x=="left"){x=0}else if(x=="centre"){x=this.mCapability.screenWidth/2-width/2}else if(x=="right"){x=this.mCapability.screenWidth-width}if(y=="top"){y=0}else if(y=="middle"){y=this.mCapability.screenHeight/2-height/2}else if(y=="bottom"){y=this.mCapability.screenHeight-height}return{x:Math.floor(x),y:Math.floor(y)}}async draw(oneBlock){if(!this.supportsArea||oneBlock){let x1,x2,y1,y2;if(!this.supportsArea){x1=0;x2=this.mCapability.screenWidth;y1=0;y2=this.mCapability.screenHeight}else{x1=this.mCapability.screenWidth;x2=0;y1=this.mCapability.screenHeight;y2=0;for(var i=0;i<this.objects.length;i++){if(this.objects[i].painted!==undefined&&!this.objects[i].painted){x1=Math.min(x1,this.objects[i].rect.upperLeftXpixel);y1=Math.min(y1,this.objects[i].rect.upperLeftYpixel);x2=Math.max(x2,this.objects[i].rect.lowerRightXpixel);y2=Math.max(y2,this.objects[i].rect.lowerRightYpixel)}}if(this.emptyWaitRect){x1=Math.min(x1,this.emptyWaitRect.upperLeftXpixel);y1=Math.min(y1,this.emptyWaitRect.upperLeftYpixel);x2=Math.max(x2,this.emptyWaitRect.lowerRightXpixel);y2=Math.max(y2,this.emptyWaitRect.lowerRightYpixel)}}const canvas=document.createElement("canvas");canvas.width=x2-x1;canvas.height=y2-y1;const ctx=canvas.getContext("2d");ctx.fillStyle="white";ctx.fillRect(0,0,canvas.width,canvas.height);if(this.emptyWaitCanvas){this.ctx.drawImage(this.emptyWaitCanvas,this.emptyWaitRect.upperLeftXpixel,this.emptyWaitRect.upperLeftYpixel)}for(var i=0;i<this.objects.length;i++){if(this.objects[i].painted!==undefined&&!this.objects[i].painted){ctx.drawImage(this.objects[i].image,this.objects[i].rect.upperLeftXpixel-x1,this.objects[i].rect.upperLeftYpixel-y1);this.objects[i].painted=true}}const rect=new this.sigSDK.Rectangle(x1,y1,x2-1,y2-1);const image=this.sigSDK.ProtocolHelper.resizeAndFlatten(canvas,0,0,canvas.width,canvas.height,canvas.width,canvas.height,this.mEncodingMode,0,"white",false,false);if(this.supportsArea){await this.stuDevice.writeImageArea(this.mEncodingMode,rect,image)}else{await this.stuDevice.writeImage(this.mEncodingMode,image)}if(this.config.mirrorDiv){this.ctx.drawImage(canvas,x1,y1);this.drawToMirror()}}else{for(var i=0;i<this.objects.length;i++){if(this.objects[i].painted!==undefined&&!this.objects[i].painted){const canvas=this.objects[i].image;const image=this.sigSDK.ProtocolHelper.resizeAndFlatten(canvas,0,0,canvas.width,canvas.height,canvas.width,canvas.height,this.mEncodingMode,0,"white",false,false);await this.stuDevice.writeImageArea(this.mEncodingMode,this.objects[i].rect,image);this.objects[i].painted=true;if(this.config.mirrorDiv){this.ctx.drawImage(canvas,this.objects[i].rect.upperLeftXpixel,this.objects[i].rect.upperLeftYpixel);this.drawToMirror()}}}}}async drawWait(){this.ctx.font="60pt Wingdings";const hourglass=String.fromCharCode(54);const metrics=this.ctx.measureText(hourglass);const width=metrics.width;const height=metrics.fontBoundingBoxAscent+metrics.fontBoundingBoxDescent;const size=Math.max(width,height);const lineWidth=3;const canvas=document.createElement("canvas");canvas.width=size;canvas.height=size;const ctx=canvas.getContext("2d");ctx.font=this.ctx.font;ctx.fillStyle="white";ctx.fillRect(0,0,canvas.width,canvas.height);ctx.fillStyle="black";ctx.fillText(hourglass,width/2-lineWidth,(height+metrics.fontBoundingBoxAscent)/2-lineWidth);ctx.strokeStyle="black";ctx.lineWidth=lineWidth;ctx.beginPath();ctx.arc(size/2,size/2,(size-lineWidth*2)/2,0,2*Math.PI);ctx.stroke();const x=Math.floor(this.mCapability.screenWidth/2-size/2);const y=Math.floor(this.mCapability.screenHeight/2-size/2);const image=this.sigSDK.ProtocolHelper.resizeAndFlatten(canvas,0,0,canvas.width,canvas.height,canvas.width,canvas.height,this.mEncodingMode,0,"white",false,false);const rect=new this.sigSDK.Rectangle(x,y,x+canvas.width-1,y+canvas.height-1);await this.stuDevice.writeImageArea(this.mEncodingMode,rect,image);if(this.config.mirrorDiv){this.ctx.drawImage(canvas,x,y);this.drawToMirror()}ctx.fillStyle="white";ctx.fillRect(0,0,canvas.width,canvas.height);this.emptyWaitCanvas=canvas;this.emptyWaitRect=rect}drawToMirror(){if(this.config.mirrorDiv){const div=document.getElementById(this.config.mirrorDiv.id);let canvasWidth=this.canvas.width;let canvasHeight=this.canvas.height;if(this.config.mirrorDiv.width){canvasWidth=this.config.mirrorDiv.width;if(this.config.mirrorDiv.height){canvasHeight=this.config.mirrorDiv.height}else{canvasHeight=canvasWidth/this.canvas.width*canvasHeight}}else{if(this.config.mirrorDiv.height){canvasHeight=this.config.mirrorDiv.height;canvasWidth=canvasHeight/this.canvas.height*canvasWidth}}if(div){if(this.mirrorCanvas){div.removeChild(this.mirrorCanvas)}const canvas=document.createElement("canvas");canvas.addEventListener("pointermove",this.mirrorEvent.bind(this));canvas.addEventListener("pointerdown",this.mirrorEvent.bind(this));canvas.addEventListener("pointerup",this.mirrorEvent.bind(this));canvas.width=canvasWidth;canvas.height=canvasHeight;const ctx=canvas.getContext("2d");ctx.imageSmoothingEnabled=true;ctx.drawImage(this.canvas,0,0,canvasWidth,canvasHeight);this.mirrorCanvas=div.appendChild(canvas)}}}inkToMirror(event){const x=this.mirrorCanvas.width/this.canvas.width*event.clientX;const y=this.mirrorCanvas.height/this.canvas.height*event.clientY;if(event.type=="pointermove"&&this.lastX){const ctx=this.mirrorCanvas.getContext("2d");ctx.beginPath();ctx.moveTo(this.lastX,this.lastY);ctx.lineTo(x,y);ctx.strokeStyle="black";ctx.lineWidth=1;ctx.stroke();ctx.closePath()}if(event.type!="pointerup"){this.lastX=x;this.lastY=y}else{this.lastX=null;this.lastY=null}}inkToCanvas(event){if(event.type=="pointermove"&&this.lastInkingX){const ctx=this.inkingCanvas.getContext("2d");ctx.beginPath();ctx.moveTo(this.lastInkingX,this.lastInkingY);ctx.lineTo(event.clientX,event.clientY);ctx.strokeStyle="black";ctx.lineWidth=1;ctx.stroke();ctx.closePath()}if(event.type!="pointerup"){this.lastInkingX=event.clientX;this.lastInkingY=event.clientY}else{this.lastInkingX=null;this.lastInkingY=null}}mirrorEvent(event){if(this.config.mirrorDiv.enable){const x=this.canvas.width/this.mirrorCanvas.width*event.offsetX;const y=this.canvas.height/this.mirrorCanvas.height*event.offsetY;const pt=this.screenToTablet(x,y);this.onPenData({x:pt.x,y:pt.y,pressure:event.buttons==1?this.mInkThreshold?.onPressureMark+1:0,rdy:1,sw:event.buttons==1,timeCount:event.timeStamp,fromMouse:true},event.timeStamp)}}idOK(id,objType){if(!id){if(this.IdRules[objType].bReqd){return false}else{return true}}if(this.objectIndex(id)>=0){return false}if(!this.IdRules[objType].reserved[id]){for(var object in this.IdRules){if(object!=objType){if(this.IdRules[object].reserved[id]){return false}}}}return true}objectIndex(id){this.objects.forEach(function(object,index){if(object.id==id){return index}});return-1}setWho(text){this.who=text}setWhy(text){this.why=text}setWhen(text){this.when=text}hasPenData(){for(let index=0;index<this.mPenData.length;index++){if(this.mPenData[index].sw!=0){return true}}return false}async onOk(){if(this.mPadMode==WizCtl.PadMode.PadSigning){if(this.hasPenData()){const value=await this.generateSignature();if(value){this.onCancel();let signObject;for(var i=this.objects.length-1;i>-1;i--){if(this.objects[i].type==WizCtl.ObjectType.ObjectSignature){signObject=this.objects[i]}}if(signObject&&signObject.onSignatureCaptured){return signObject.onSignatureCaptured(this.mSigObj)}}}}else if(this.mPadMode==WizCtl.PadMode.PadInking){if(this.hasPenData()>0){let inkingObject;for(var i=this.objects.length-1;i>-1;i--){if(this.objects[i].type==WizCtl.ObjectType.ObjectInking){inkingObject=this.objects[i]}}if(inkingObject&&inkingObject.onInkingCaptured){return inkingObject.onInkingCaptured(this.inkingCanvas.toDataURL("image/png"))}}}return false}async onClear(){if(this.mPadMode==WizCtl.PadMode.PadInput&&this.mInput){for(var i=0;i<this.objects.length;i++){if(this.objects[i].type==WizCtl.ObjectType.ObjectInputEcho){this.updateInputEcho(this.objects[i],this.objects[i].index==0||this.objects[i].putUnderline?"_":" ")}}this.mInput.input="";await this.draw()}else if(this.mPadMode==WizCtl.PadMode.PadSigning||this.mPadMode==WizCtl.PadMode.PadInking){if(this.mPadMode==WizCtl.PadMode.PadInking){const ctx=this.inkingCanvas.getContext("2d");ctx.fillStyle="white";ctx.fillRect(0,0,this.inkingCanvas.width,this.inkingCanvas.height)}this.mPenData=[];await this.stuDevice.setClearScreen();for(var i=0;i<this.objects.length;i++){if(this.objects[i].painted!==undefined){this.objects[i].painted=false}}await this.display(this.emptyWaitCanvas)}this.mPenEvents=[];return true}onCancel(){}async onDelete(){let handle=false;if(this.mInput){const textSize=this.mInput.input.length;if(textSize>0){for(var i=0;i<this.objects.length;i++){if(this.objects[i].type==WizCtl.ObjectType.ObjectInputEcho){if(this.objects[i].index==textSize-1){this.updateInputEcho(this.objects[i],"_");this.mInput.input=this.mInput.input.slice(0,textSize-1);this.onInput(this.objects[i]);if(this.objects[i].putUnderline){return true}else{handle=true}}else if(!this.objects[i].putUnderline&&this.objects[i].index>=textSize){this.updateInputEcho(this.objects[i]," ")}}}}}return handle}onInput(object){for(var i=0;i<this.objects.length;i++){if(this.objects[i].type==WizCtl.ObjectType.ObjectInput){if(this.objects[i].onInput){this.objects[i].onInput(this.mInput.input,object.id,this.objects[i].minLength,this.objects[i].maxLength)}}}}btnAlignOption(align){if(align){const xAlign=WizCtl.ButtonOptions.BtnAlignCentre|WizCtl.ButtonOptions.BtnAlignLeft|WizCtl.ButtonOptions.BtnAlignRight;const yAlign=WizCtl.ButtonOptions.BtnAlignMiddle|WizCtl.ButtonOptions.BtnAlignTop|WizCtl.ButtonOptions.BtnAlignBottom;const allAlign=xAlign|yAlign;if((align&~allAlign)!=0||(align&xAlign)==xAlign||(align&yAlign)==yAlign){return false}}return true}drawState(object){if(object.type==WizCtl.ObjectType.ObjectCheckbox){this.drawStateCheckbox(object)}else if(object.type==WizCtl.ObjectType.ObjectRadioButton){this.drawStateRadioButton(object)}else if(object.type==WizCtl.ObjectType.ObjectButton){this.drawStateButton(object)}}drawStateCheckbox(object){const canvas=document.createElement("canvas");canvas.width=object.rect.lowerRightXpixel-object.rect.upperLeftXpixel+1;canvas.height=object.rect.lowerRightYpixel-object.rect.upperLeftYpixel+1;const ctx=canvas.getContext("2d");ctx.font=object.font;ctx.fillStyle=object.backColor;ctx.fillRect(0,0,canvas.width,canvas.height);ctx.fillStyle=object.foreColor;if(object.checked==0){const metrics=ctx.measureText("☐");ctx.fillText("☐",0,metrics.fontBoundingBoxAscent)}else{if(object.style==WizCtl.CheckboxOptions.CheckboxDisplayCross){const metrics=ctx.measureText("☒");ctx.fillText("☒",0,metrics.fontBoundingBoxAscent)}else{const metrics=ctx.measureText("☑");ctx.fillText("☑",0,metrics.fontBoundingBoxAscent)}}object.image=canvas;object.painted=false}drawStateRadioButton(object){const canvas=document.createElement("canvas");canvas.width=object.rect.lowerRightXpixel-object.rect.upperLeftXpixel+1;canvas.height=object.rect.lowerRightYpixel-object.rect.upperLeftYpixel+1;const ctx=canvas.getContext("2d");ctx.font=object.font;ctx.fillStyle=object.backColor;ctx.fillRect(0,0,canvas.width,canvas.height);ctx.fillStyle=object.foreColor;const metrics=ctx.measureText("◯");ctx.fillText("◯",0,metrics.fontBoundingBoxAscent);if(object.checked){const metrics=ctx.measureText("●");ctx.fillText("●",Math.floor((canvas.width-metrics.width)/2),Math.floor((canvas.height+metrics.actualBoundingBoxAscent-metrics.actualBoundingBoxDescent)/2))}object.image=canvas;object.painted=false}drawStateButton(object){const canvas=document.createElement("canvas");canvas.width=object.rect.lowerRightXpixel-object.rect.upperLeftXpixel+1;canvas.height=object.rect.lowerRightYpixel-object.rect.upperLeftYpixel+1;const ctx=canvas.getContext("2d");ctx.font=object.font;const metrics=ctx.measureText(object.text);const width=metrics.width;const height=metrics.fontBoundingBoxAscent+metrics.fontBoundingBoxDescent;if(object.pushed&&object.config.pushed){if(this.useColor){ctx.fillStyle=object.config.pushed.backColor?object.config.pushed.backColor:object.config.backColor}else{ctx.fillStyle=object.config.pushed.invert?"black":"white"}ctx.fillRect(0,0,canvas.width,canvas.height);if(object.config.pushed.border&&object.config.pushed.border.size){ctx.lineWidth=object.config.pushed.border.size;if(this.useColor){ctx.strokeStyle=object.config.pushed.border.color}else{ctx.fillStyle=object.config.pushed.invert?"white":"color"}ctx.strokeRect(0,0,canvas.width,canvas.height)}}else{if(this.useColor){ctx.fillStyle=object.config.backColor}else{ctx.fillStyle=object.config.invert?"black":"white"}ctx.fillRect(0,0,canvas.width,canvas.height);if(object.config.border&&object.config.border.size){ctx.lineWidth=object.config.border.size;if(this.useColor){ctx.strokeStyle=object.config.border.color}else{ctx.fillStyle=object.config.invert?"white":"color"}ctx.strokeRect(0,0,canvas.width,canvas.height)}}let offsetX=0;if(object.flags&WizCtl.ButtonOptions.BtnAlignLeft){offsetX=0}else if(object.flags&WizCtl.ButtonOptions.BtnAlignRight){offsetX=canvas.width-width}else{offsetX=Math.floor(canvas.width/2-width/2)}let offsetY=0;if(object.flags&WizCtl.ButtonOptions.BtnAlignTop){offsetY=0}else if(object.flags&WizCtl.ButtonOptions.BtnAlignBottom){offsetY=0}else{offsetY=0}if(object.pushed&&object.config.pushed&&object.config.pushed.font){if(this.useColor){ctx.fillStyle=object.config.pushed.font.color?object.config.pushed.font.color:object.config.font.color}else{ctx.fillStyle=object.config.pushed.invert?"white":"black"}}else{if(this.useColor){ctx.fillStyle=object.config.font.color}else{ctx.fillStyle=object.config.invert?"white":"black"}}ctx.fillText(object.text,offsetX,metrics.fontBoundingBoxAscent);object.image=canvas;object.painted=false}async selectRadioButton(object){if(!object.checked){for(var i=0;i<this.objects.length;i++){if(object.group==this.objects[i].group){if(this.objects[i].checked){this.objects[i].checked=false;this.drawStateRadioButton(this.objects[i])}}}object.checked=true;this.drawStateRadioButton(object)}}checkboxOption(option){if(typeof option==="number"){const checkOptions=WizCtl.CheckboxOptions.CheckboxUnchecked|WizCtl.CheckboxOptions.CheckboxChecked;const displayOptions=WizCtl.CheckboxOptions.CheckboxDisplayTick|WizCtl.CheckboxOptions.CheckboxDisplayCross;const allOptions=checkOptions|displayOptions;if((option&displayOptions)!=displayOptions&&(option&~allOptions)==0){return true}}return false}lineOption(option){const lineStyles=WizCtl.PrimitiveOptions.LineSolid|WizCtl.PrimitiveOptions.LineDashed;if((option&lineStyles)!=lineStyles&&(option&~lineStyles)==0){return true}return false}shapeOption(option){const lineStyles=WizCtl.PrimitiveOptions.LineSolid|WizCtl.PrimitiveOptions.LineDashed;const fillStyles=WizCtl.PrimitiveOptions.Fill|WizCtl.PrimitiveOptions.FillXOR;const outlineOrFill=WizCtl.PrimitiveOptions.Outline|fillStyles;const allOptions=lineStyles|fillStyles|WizCtl.PrimitiveOptions.Outline;if((option&lineStyles)!=lineStyles&&(option&fillStyles)!=fillStyles&&(option&~allOptions)==0){if((option&outlineOrFill)==0){option|=WizCtl.PrimitiveOptions.Outline}return true}return false}handleInput(object){let handle=false;const textSize=this.mInput.input.length;for(var i=0;i<this.objects.length;i++){if(this.objects[i].type==WizCtl.ObjectType.ObjectInputEcho){if(this.objects[i].index==textSize){this.updateInputEcho(this.objects[i],this.objects[i].data?this.objects[i].data:object.id);this.mInput.input+=object.id;handle=true}else if(this.objects[i].index==textSize+1){this.updateInputEcho(this.objects[i],"_")}}}return handle}async updateInputEcho(object,value){const canvas=document.createElement("canvas");canvas.width=object.rect.lowerRightXpixel-object.rect.upperLeftXpixel+1;canvas.height=object.rect.lowerRightYpixel-object.rect.upperLeftYpixel+1;const ctx=canvas.getContext("2d");ctx.font=object.font;const metrics=ctx.measureText(value);ctx.fillStyle=object.backColor;ctx.fillRect(0,0,canvas.width,canvas.height);ctx.fillStyle=object.foreColor;ctx.fillText(value,0,metrics.fontBoundingBoxAscent);if(object.putUnderline){ctx.fillText("_",0,metrics.fontBoundingBoxAscent)}object.image=canvas;object.painted=false}async getSystemInfo(){let browserInfo="";let osInfo="";const navigatorUAData=window.navigator.userAgentData;if(navigatorUAData){const values=await navigatorUAData.getHighEntropyValues(["platformVersion"]);const brandList=["chrome","opera","safari","edge","firefox"];let found=false;for(const agentBrand of values.brands){const agentBrandEntry=agentBrand.brand.toLowerCase();const foundBrand=brandList.find(brand=>agentBrandEntry.includes(brand));if(foundBrand){browserInfo=agentBrand.brand+" "+agentBrand.version;found=true;break}}if(!found){browserInfo=values.brands[0].brand+" "+values.brands[0].version}osInfo=values.platform+" "+values.platformVersion}else{browserInfo=navigator.userAgent;osInfo="Unkwon OS"}return[browserInfo,osInfo]}async generateSignature(){let strokeVector=new this.sigSDK.StrokeVector;let currentStroke=new this.sigSDK.PointVector;let currentStrokeID=0;let isDown=true;let hasDown=false;for(let index=0;index<this.mPenData.length;index++){if(this.mPenData[index].sw==0&&!hasDown){continue}hasDown=true;if(isDown&&this.mPenData[index].sw==0||!isDown&&this.mPenData[index].sw==1){isDown=this.mPenData[index].sw==1;strokeVector.push_back({points:currentStroke});currentStroke.delete();currentStroke=new this.sigSDK.PointVector;currentStrokeID++}var point={x:this.mPenData[index].x,y:this.mPenData[index].y,p:this.mPenData[index].pressure,t:this.mPenData[index].timeCount,azimuth:0,altitude:0,twist:0,is_down:this.mPenData[index].sw,stroke_id:currentStrokeID};currentStroke.push_back(point)}var device={device_max_X:this.mCapability.tabletMaxX,device_max_Y:this.mCapability.tabletMaxY,device_max_P:this.mCapability.tabletMaxPressure,device_pixels_per_m_x:1e5,device_pixels_per_m_y:1e5,device_origin_X:0,device_origin_Y:1,device_unit_pixels:false};var uid2;try{uid2=await stuDevice.getUid2()}catch(e){}if(!uid2){uid2=0}const[browserInfo,osInfo]=await this.getSystemInfo();const nicInfo="";const digitizerInfo="STU;'"+this.mInformation.modelName+"';"+this.mInformation.firmwareMajorVersion+"."+(parseInt(this.mInformation.firmwareMinorVersion)>>4&15)+"."+(parseInt(this.mInformation.firmwareMinorVersion)&15)+";"+uid2;const timeResolution=1e3;const who=this.who;const why=this.why;const where="";let integrityKey=this.sigSDK.KeyType.SHA512;let documentHash;if(this.mSigOptions){if(this.mSigOptions.integrityKey){integrityKey=this.mSigOptions.integrityKey}if(this.mSigOptions.documentHash){documentHash=this.mSigOptions.documentHash}}let deleteHash=false;if(!documentHash){documentHash=new this.sigSDK.Hash(this.sigSDK.HashType.None);deleteHash=true}const myPromise=new Promise((resolve,reject)=>{try{const promise=this.mSigObj.generateSignature(this.who?this.who:"",this.why?this.why:"",where,integrityKey,documentHash,strokeVector,device,osInfo,digitizerInfo,nicInfo,timeResolution);promise.then(value=>{if(deleteHash){documentHash.delete()}strokeVector.delete();currentStroke.delete();resolve(value)});promise.catch(error=>{if(deleteHash){documentHash.delete()}strokeVector.delete();currentStroke.delete();reject(error)})}catch(exception){if(deleteHash){documentHash.delete()}strokeVector.delete();currentStroke.delete();reject(exception)}});return myPromise}getFirstLineWidth(text,width){let metrics=this.ctx.measureText(text);let pos=text.length-1;while(metrics.width>width){for(;pos>0;pos--){if(text[pos]==" "){break}}metrics=this.ctx.measureText(text.substring(0,pos--))}return pos+1}}WizCtl.Point=class{constructor(x,y){this.x=x;this.y=y}};return Emval.toHandle(new WizCtl)}function __asyncjs__stuInternalGet(usbDevicePtr,reportId){return Asyncify.handleAsync(async()=>{const usbDevice=Emval.toValue(usbDevicePtr);try{const jsData=await usbDevice.receiveFeatureReport(reportId);return Emval.toHandle(jsData)}catch(e){return Emval.toHandle(new DataView(new ArrayBuffer(0)))}})}function __asyncjs__stuInternalSet(usbDevicePtr,reportId,data){return Asyncify.handleAsync(async()=>{const usbDevice=Emval.toValue(usbDevicePtr);try{await usbDevice.sendFeatureReport(reportId,Emval.toValue(data))}catch(e){}})}class ExitStatus{name="ExitStatus";constructor(status){this.message=`Program terminated with exit(${status})`;this.status=status}}var callRuntimeCallbacks=callbacks=>{while(callbacks.length>0){callbacks.shift()(Module)}};var noExitRuntime=Module["noExitRuntime"]||true;var stackRestore=val=>__emscripten_stack_restore(val);var stackSave=()=>_emscripten_stack_get_current();class ExceptionInfo{constructor(excPtr){this.excPtr=excPtr;this.ptr=excPtr-24}set_type(type){HEAPU32[this.ptr+4>>2]=type}get_type(){return HEAPU32[this.ptr+4>>2]}set_destructor(destructor){HEAPU32[this.ptr+8>>2]=destructor}get_destructor(){return HEAPU32[this.ptr+8>>2]}set_caught(caught){caught=caught?1:0;HEAP8[this.ptr+12]=caught}get_caught(){return HEAP8[this.ptr+12]!=0}set_rethrown(rethrown){rethrown=rethrown?1:0;HEAP8[this.ptr+13]=rethrown}get_rethrown(){return HEAP8[this.ptr+13]!=0}init(type,destructor){this.set_adjusted_ptr(0);this.set_type(type);this.set_destructor(destructor)}set_adjusted_ptr(adjustedPtr){HEAPU32[this.ptr+16>>2]=adjustedPtr}get_adjusted_ptr(){return HEAPU32[this.ptr+16>>2]}}var exceptionLast=0;var uncaughtExceptionCount=0;var ___cxa_throw=(ptr,type,destructor)=>{var info=new ExceptionInfo(ptr);info.init(type,destructor);exceptionLast=ptr;uncaughtExceptionCount++;throw exceptionLast};var syscallGetVarargI=()=>{var ret=HEAP32[+SYSCALLS.varargs>>2];SYSCALLS.varargs+=4;return ret};var syscallGetVarargP=syscallGetVarargI;var PATH={isAbs:path=>path.charAt(0)==="/",splitPath:filename=>{var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return splitPathRe.exec(filename).slice(1)},normalizeArray:(parts,allowAboveRoot)=>{var up=0;for(var i=parts.length-1;i>=0;i--){var last=parts[i];if(last==="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up;up--){parts.unshift("..")}}return parts},normalize:path=>{var isAbsolute=PATH.isAbs(path),trailingSlash=path.substr(-1)==="/";path=PATH.normalizeArray(path.split("/").filter(p=>!!p),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path},dirname:path=>{var result=PATH.splitPath(path),root=result[0],dir=result[1];if(!root&&!dir){return"."}if(dir){dir=dir.substr(0,dir.length-1)}return root+dir},basename:path=>{if(path==="/")return"/";path=PATH.normalize(path);path=path.replace(/\/$/,"");var lastSlash=path.lastIndexOf("/");if(lastSlash===-1)return path;return path.substr(lastSlash+1)},join:(...paths)=>PATH.normalize(paths.join("/")),join2:(l,r)=>PATH.normalize(l+"/"+r)};var initRandomFill=()=>{if(typeof crypto=="object"&&typeof crypto["getRandomValues"]=="function"){return view=>crypto.getRandomValues(view)}else abort("initRandomDevice")};var randomFill=view=>(randomFill=initRandomFill())(view);var PATH_FS={resolve:(...args)=>{var resolvedPath="",resolvedAbsolute=false;for(var i=args.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?args[i]:FS.cwd();if(typeof path!="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!path){return""}resolvedPath=path+"/"+resolvedPath;resolvedAbsolute=PATH.isAbs(path)}resolvedPath=PATH.normalizeArray(resolvedPath.split("/").filter(p=>!!p),!resolvedAbsolute).join("/");return(resolvedAbsolute?"/":"")+resolvedPath||"."},relative:(from,to)=>{from=PATH_FS.resolve(from).substr(1);to=PATH_FS.resolve(to).substr(1);function trim(arr){var start=0;for(;start<arr.length;start++){if(arr[start]!=="")break}var end=arr.length-1;for(;end>=0;end--){if(arr[end]!=="")break}if(start>end)return[];return arr.slice(start,end-start+1)}var fromParts=trim(from.split("/"));var toParts=trim(to.split("/"));var length=Math.min(fromParts.length,toParts.length);var samePartsLength=length;for(var i=0;i<length;i++){if(fromParts[i]!==toParts[i]){samePartsLength=i;break}}var outputParts=[];for(var i=samePartsLength;i<fromParts.length;i++){outputParts.push("..")}outputParts=outputParts.concat(toParts.slice(samePartsLength));return outputParts.join("/")}};var UTF8Decoder=typeof TextDecoder!="undefined"?new TextDecoder:undefined;var UTF8ArrayToString=(heapOrArray,idx=0,maxBytesToRead=NaN)=>{var endIdx=idx+maxBytesToRead;var endPtr=idx;while(heapOrArray[endPtr]&&!(endPtr>=endIdx))++endPtr;if(endPtr-idx>16&&heapOrArray.buffer&&UTF8Decoder){return UTF8Decoder.decode(heapOrArray.subarray(idx,endPtr))}var str="";while(idx<endPtr){var u0=heapOrArray[idx++];if(!(u0&128)){str+=String.fromCharCode(u0);continue}var u1=heapOrArray[idx++]&63;if((u0&224)==192){str+=String.fromCharCode((u0&31)<<6|u1);continue}var u2=heapOrArray[idx++]&63;if((u0&240)==224){u0=(u0&15)<<12|u1<<6|u2}else{u0=(u0&7)<<18|u1<<12|u2<<6|heapOrArray[idx++]&63}if(u0<65536){str+=String.fromCharCode(u0)}else{var ch=u0-65536;str+=String.fromCharCode(55296|ch>>10,56320|ch&1023)}}return str};var FS_stdin_getChar_buffer=[];var lengthBytesUTF8=str=>{var len=0;for(var i=0;i<str.length;++i){var c=str.charCodeAt(i);if(c<=127){len++}else if(c<=2047){len+=2}else if(c>=55296&&c<=57343){len+=4;++i}else{len+=3}}return len};var stringToUTF8Array=(str,heap,outIdx,maxBytesToWrite)=>{if(!(maxBytesToWrite>0))return 0;var startIdx=outIdx;var endIdx=outIdx+maxBytesToWrite-1;for(var i=0;i<str.length;++i){var u=str.charCodeAt(i);if(u>=55296&&u<=57343){var u1=str.charCodeAt(++i);u=65536+((u&1023)<<10)|u1&1023}if(u<=127){if(outIdx>=endIdx)break;heap[outIdx++]=u}else if(u<=2047){if(outIdx+1>=endIdx)break;heap[outIdx++]=192|u>>6;heap[outIdx++]=128|u&63}else if(u<=65535){if(outIdx+2>=endIdx)break;heap[outIdx++]=224|u>>12;heap[outIdx++]=128|u>>6&63;heap[outIdx++]=128|u&63}else{if(outIdx+3>=endIdx)break;heap[outIdx++]=240|u>>18;heap[outIdx++]=128|u>>12&63;heap[outIdx++]=128|u>>6&63;heap[outIdx++]=128|u&63}}heap[outIdx]=0;return outIdx-startIdx};function intArrayFromString(stringy,dontAddNull,length){var len=length>0?length:lengthBytesUTF8(stringy)+1;var u8array=new Array(len);var numBytesWritten=stringToUTF8Array(stringy,u8array,0,u8array.length);if(dontAddNull)u8array.length=numBytesWritten;return u8array}var FS_stdin_getChar=()=>{if(!FS_stdin_getChar_buffer.length){var result=null;if(typeof window!="undefined"&&typeof window.prompt=="function"){result=window.prompt("Input: ");if(result!==null){result+="\n"}}else{}if(!result){return null}FS_stdin_getChar_buffer=intArrayFromString(result,true)}return FS_stdin_getChar_buffer.shift()};var TTY={ttys:[],init(){},shutdown(){},register(dev,ops){TTY.ttys[dev]={input:[],output:[],ops};FS.registerDevice(dev,TTY.stream_ops)},stream_ops:{open(stream){var tty=TTY.ttys[stream.node.rdev];if(!tty){throw new FS.ErrnoError(43)}stream.tty=tty;stream.seekable=false},close(stream){stream.tty.ops.fsync(stream.tty)},fsync(stream){stream.tty.ops.fsync(stream.tty)},read(stream,buffer,offset,length,pos){if(!stream.tty||!stream.tty.ops.get_char){throw new FS.ErrnoError(60)}var bytesRead=0;for(var i=0;i<length;i++){var result;try{result=stream.tty.ops.get_char(stream.tty)}catch(e){throw new FS.ErrnoError(29)}if(result===undefined&&bytesRead===0){throw new FS.ErrnoError(6)}if(result===null||result===undefined)break;bytesRead++;buffer[offset+i]=result}if(bytesRead){stream.node.timestamp=Date.now()}return bytesRead},write(stream,buffer,offset,length,pos){if(!stream.tty||!stream.tty.ops.put_char){throw new FS.ErrnoError(60)}try{for(var i=0;i<length;i++){stream.tty.ops.put_char(stream.tty,buffer[offset+i])}}catch(e){throw new FS.ErrnoError(29)}if(length){stream.node.timestamp=Date.now()}return i}},default_tty_ops:{get_char(tty){return FS_stdin_getChar()},put_char(tty,val){if(val===null||val===10){out(UTF8ArrayToString(tty.output));tty.output=[]}else{if(val!=0)tty.output.push(val)}},fsync(tty){if(tty.output&&tty.output.length>0){out(UTF8ArrayToString(tty.output));tty.output=[]}},ioctl_tcgets(tty){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(tty,optional_actions,data){return 0},ioctl_tiocgwinsz(tty){return[24,80]}},default_tty1_ops:{put_char(tty,val){if(val===null||val===10){err(UTF8ArrayToString(tty.output));tty.output=[]}else{if(val!=0)tty.output.push(val)}},fsync(tty){if(tty.output&&tty.output.length>0){err(UTF8ArrayToString(tty.output));tty.output=[]}}}};var zeroMemory=(address,size)=>{HEAPU8.fill(0,address,address+size)};var alignMemory=(size,alignment)=>Math.ceil(size/alignment)*alignment;var mmapAlloc=size=>{size=alignMemory(size,65536);var ptr=_emscripten_builtin_memalign(65536,size);if(ptr)zeroMemory(ptr,size);return ptr};var MEMFS={ops_table:null,mount(mount){return MEMFS.createNode(null,"/",16384|511,0)},createNode(parent,name,mode,dev){if(FS.isBlkdev(mode)||FS.isFIFO(mode)){throw new FS.ErrnoError(63)}MEMFS.ops_table||={dir:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr,lookup:MEMFS.node_ops.lookup,mknod:MEMFS.node_ops.mknod,rename:MEMFS.node_ops.rename,unlink:MEMFS.node_ops.unlink,rmdir:MEMFS.node_ops.rmdir,readdir:MEMFS.node_ops.readdir,symlink:MEMFS.node_ops.symlink},stream:{llseek:MEMFS.stream_ops.llseek}},file:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr},stream:{llseek:MEMFS.stream_ops.llseek,read:MEMFS.stream_ops.read,write:MEMFS.stream_ops.write,allocate:MEMFS.stream_ops.allocate,mmap:MEMFS.stream_ops.mmap,msync:MEMFS.stream_ops.msync}},link:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr,readlink:MEMFS.node_ops.readlink},stream:{}},chrdev:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr},stream:FS.chrdev_stream_ops}};var node=FS.createNode(parent,name,mode,dev);if(FS.isDir(node.mode)){node.node_ops=MEMFS.ops_table.dir.node;node.stream_ops=MEMFS.ops_table.dir.stream;node.contents={}}else if(FS.isFile(node.mode)){node.node_ops=MEMFS.ops_table.file.node;node.stream_ops=MEMFS.ops_table.file.stream;node.usedBytes=0;node.contents=null}else if(FS.isLink(node.mode)){node.node_ops=MEMFS.ops_table.link.node;node.stream_ops=MEMFS.ops_table.link.stream}else if(FS.isChrdev(node.mode)){node.node_ops=MEMFS.ops_table.chrdev.node;node.stream_ops=MEMFS.ops_table.chrdev.stream}node.timestamp=Date.now();if(parent){parent.contents[name]=node;parent.timestamp=node.timestamp}return node},getFileDataAsTypedArray(node){if(!node.contents)return new Uint8Array(0);if(node.contents.subarray)return node.contents.subarray(0,node.usedBytes);return new Uint8Array(node.contents)},expandFileStorage(node,newCapacity){var prevCapacity=node.contents?node.contents.length:0;if(prevCapacity>=newCapacity)return;var CAPACITY_DOUBLING_MAX=1024*1024;newCapacity=Math.max(newCapacity,prevCapacity*(prevCapacity<CAPACITY_DOUBLING_MAX?2:1.125)>>>0);if(prevCapacity!=0)newCapacity=Math.max(newCapacity,256);var oldContents=node.contents;node.contents=new Uint8Array(newCapacity);if(node.usedBytes>0)node.contents.set(oldContents.subarray(0,node.usedBytes),0)},resizeFileStorage(node,newSize){if(node.usedBytes==newSize)return;if(newSize==0){node.contents=null;node.usedBytes=0}else{var oldContents=node.contents;node.contents=new Uint8Array(newSize);if(oldContents){node.contents.set(oldContents.subarray(0,Math.min(newSize,node.usedBytes)))}node.usedBytes=newSize}},node_ops:{getattr(node){var attr={};attr.dev=FS.isChrdev(node.mode)?node.id:1;attr.ino=node.id;attr.mode=node.mode;attr.nlink=1;attr.uid=0;attr.gid=0;attr.rdev=node.rdev;if(FS.isDir(node.mode)){attr.size=4096}else if(FS.isFile(node.mode)){attr.size=node.usedBytes}else if(FS.isLink(node.mode)){attr.size=node.link.length}else{attr.size=0}attr.atime=new Date(node.timestamp);attr.mtime=new Date(node.timestamp);attr.ctime=new Date(node.timestamp);attr.blksize=4096;attr.blocks=Math.ceil(attr.size/attr.blksize);return attr},setattr(node,attr){if(attr.mode!==undefined){node.mode=attr.mode}if(attr.timestamp!==undefined){node.timestamp=attr.timestamp}if(attr.size!==undefined){MEMFS.resizeFileStorage(node,attr.size)}},lookup(parent,name){throw FS.genericErrors[44]},mknod(parent,name,mode,dev){return MEMFS.createNode(parent,name,mode,dev)},rename(old_node,new_dir,new_name){if(FS.isDir(old_node.mode)){var new_node;try{new_node=FS.lookupNode(new_dir,new_name)}catch(e){}if(new_node){for(var i in new_node.contents){throw new FS.ErrnoError(55)}}}delete old_node.parent.contents[old_node.name];old_node.parent.timestamp=Date.now();old_node.name=new_name;new_dir.contents[new_name]=old_node;new_dir.timestamp=old_node.parent.timestamp},unlink(parent,name){delete parent.contents[name];parent.timestamp=Date.now()},rmdir(parent,name){var node=FS.lookupNode(parent,name);for(var i in node.contents){throw new FS.ErrnoError(55)}delete parent.contents[name];parent.timestamp=Date.now()},readdir(node){var entries=[".",".."];for(var key of Object.keys(node.contents)){entries.push(key)}return entries},symlink(parent,newname,oldpath){var node=MEMFS.createNode(parent,newname,511|40960,0);node.link=oldpath;return node},readlink(node){if(!FS.isLink(node.mode)){throw new FS.ErrnoError(28)}return node.link}},stream_ops:{read(stream,buffer,offset,length,position){var contents=stream.node.contents;if(position>=stream.node.usedBytes)return 0;var size=Math.min(stream.node.usedBytes-position,length);if(size>8&&contents.subarray){buffer.set(contents.subarray(position,position+size),offset)}else{for(var i=0;i<size;i++)buffer[offset+i]=contents[position+i]}return size},write(stream,buffer,offset,length,position,canOwn){if(buffer.buffer===HEAP8.buffer){canOwn=false}if(!length)return 0;var node=stream.node;node.timestamp=Date.now();if(buffer.subarray&&(!node.contents||node.contents.subarray)){if(canOwn){node.contents=buffer.subarray(offset,offset+length);node.usedBytes=length;return length}else if(node.usedBytes===0&&position===0){node.contents=buffer.slice(offset,offset+length);node.usedBytes=length;return length}else if(position+length<=node.usedBytes){node.contents.set(buffer.subarray(offset,offset+length),position);return length}}MEMFS.expandFileStorage(node,position+length);if(node.contents.subarray&&buffer.subarray){node.contents.set(buffer.subarray(offset,offset+length),position)}else{for(var i=0;i<length;i++){node.contents[position+i]=buffer[offset+i]}}node.usedBytes=Math.max(node.usedBytes,position+length);return length},llseek(stream,offset,whence){var position=offset;if(whence===1){position+=stream.position}else if(whence===2){if(FS.isFile(stream.node.mode)){position+=stream.node.usedBytes}}if(position<0){throw new FS.ErrnoError(28)}return position},allocate(stream,offset,length){MEMFS.expandFileStorage(stream.node,offset+length);stream.node.usedBytes=Math.max(stream.node.usedBytes,offset+length)},mmap(stream,length,position,prot,flags){if(!FS.isFile(stream.node.mode)){throw new FS.ErrnoError(43)}var ptr;var allocated;var contents=stream.node.contents;if(!(flags&2)&&contents&&contents.buffer===HEAP8.buffer){allocated=false;ptr=contents.byteOffset}else{allocated=true;ptr=mmapAlloc(length);if(!ptr){throw new FS.ErrnoError(48)}if(contents){if(position>0||position+length<contents.length){if(contents.subarray){contents=contents.subarray(position,position+length)}else{contents=Array.prototype.slice.call(contents,position,position+length)}}HEAP8.set(contents,ptr)}}return{ptr,allocated}},msync(stream,buffer,offset,length,mmapFlags){MEMFS.stream_ops.write(stream,buffer,0,length,offset,false);return 0}}};var asyncLoad=(url,onload,onerror,noRunDep)=>{var dep=!noRunDep?getUniqueRunDependency(`al ${url}`):"";readAsync(url).then(arrayBuffer=>{onload(new Uint8Array(arrayBuffer));if(dep)removeRunDependency(dep)},err=>{if(onerror){onerror()}else{throw`Loading data file "${url}" failed.`}});if(dep)addRunDependency(dep)};var FS_createDataFile=(parent,name,fileData,canRead,canWrite,canOwn)=>{FS.createDataFile(parent,name,fileData,canRead,canWrite,canOwn)};var preloadPlugins=Module["preloadPlugins"]||[];var FS_handledByPreloadPlugin=(byteArray,fullname,finish,onerror)=>{if(typeof Browser!="undefined")Browser.init();var handled=false;preloadPlugins.forEach(plugin=>{if(handled)return;if(plugin["canHandle"](fullname)){plugin["handle"](byteArray,fullname,finish,onerror);handled=true}});return handled};var FS_createPreloadedFile=(parent,name,url,canRead,canWrite,onload,onerror,dontCreateFile,canOwn,preFinish)=>{var fullname=name?PATH_FS.resolve(PATH.join2(parent,name)):parent;var dep=getUniqueRunDependency(`cp ${fullname}`);function processData(byteArray){function finish(byteArray){preFinish?.();if(!dontCreateFile){FS_createDataFile(parent,name,byteArray,canRead,canWrite,canOwn)}onload?.();removeRunDependency(dep)}if(FS_handledByPreloadPlugin(byteArray,fullname,finish,()=>{onerror?.();removeRunDependency(dep)})){return}finish(byteArray)}addRunDependency(dep);if(typeof url=="string"){asyncLoad(url,processData,onerror)}else{processData(url)}};var FS_modeStringToFlags=str=>{var flagModes={r:0,"r+":2,w:512|64|1,"w+":512|64|2,a:1024|64|1,"a+":1024|64|2};var flags=flagModes[str];if(typeof flags=="undefined"){throw new Error(`Unknown file open mode: ${str}`)}return flags};var FS_getMode=(canRead,canWrite)=>{var mode=0;if(canRead)mode|=292|73;if(canWrite)mode|=146;return mode};var IDBFS={dbs:{},indexedDB:()=>{if(typeof indexedDB!="undefined")return indexedDB;var ret=null;if(typeof window=="object")ret=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;return ret},DB_VERSION:21,DB_STORE_NAME:"FILE_DATA",queuePersist:mount=>{function onPersistComplete(){if(mount.idbPersistState==="again")startPersist();else mount.idbPersistState=0}function startPersist(){mount.idbPersistState="idb";IDBFS.syncfs(mount,false,onPersistComplete)}if(!mount.idbPersistState){mount.idbPersistState=setTimeout(startPersist,0)}else if(mount.idbPersistState==="idb"){mount.idbPersistState="again"}},mount:mount=>{var mnt=MEMFS.mount(mount);if(mount?.opts?.autoPersist){mnt.idbPersistState=0;var memfs_node_ops=mnt.node_ops;mnt.node_ops=Object.assign({},mnt.node_ops);mnt.node_ops.mknod=(parent,name,mode,dev)=>{var node=memfs_node_ops.mknod(parent,name,mode,dev);node.node_ops=mnt.node_ops;node.idbfs_mount=mnt.mount;node.memfs_stream_ops=node.stream_ops;node.stream_ops=Object.assign({},node.stream_ops);node.stream_ops.write=(stream,buffer,offset,length,position,canOwn)=>{stream.node.isModified=true;return node.memfs_stream_ops.write(stream,buffer,offset,length,position,canOwn)};node.stream_ops.close=stream=>{var n=stream.node;if(n.isModified){IDBFS.queuePersist(n.idbfs_mount);n.isModified=false}if(n.memfs_stream_ops.close)return n.memfs_stream_ops.close(stream)};return node};mnt.node_ops.mkdir=(...args)=>(IDBFS.queuePersist(mnt.mount),memfs_node_ops.mkdir(...args));mnt.node_ops.rmdir=(...args)=>(IDBFS.queuePersist(mnt.mount),memfs_node_ops.rmdir(...args));mnt.node_ops.symlink=(...args)=>(IDBFS.queuePersist(mnt.mount),memfs_node_ops.symlink(...args));mnt.node_ops.unlink=(...args)=>(IDBFS.queuePersist(mnt.mount),memfs_node_ops.unlink(...args));mnt.node_ops.rename=(...args)=>(IDBFS.queuePersist(mnt.mount),memfs_node_ops.rename(...args))}return mnt},syncfs:(mount,populate,callback)=>{IDBFS.getLocalSet(mount,(err,local)=>{if(err)return callback(err);IDBFS.getRemoteSet(mount,(err,remote)=>{if(err)return callback(err);var src=populate?remote:local;var dst=populate?local:remote;IDBFS.reconcile(src,dst,callback)})})},quit:()=>{Object.values(IDBFS.dbs).forEach(value=>value.close());IDBFS.dbs={}},getDB:(name,callback)=>{var db=IDBFS.dbs[name];if(db){return callback(null,db)}var req;try{req=IDBFS.indexedDB().open(name,IDBFS.DB_VERSION)}catch(e){return callback(e)}if(!req){return callback("Unable to connect to IndexedDB")}req.onupgradeneeded=e=>{var db=e.target.result;var transaction=e.target.transaction;var fileStore;if(db.objectStoreNames.contains(IDBFS.DB_STORE_NAME)){fileStore=transaction.objectStore(IDBFS.DB_STORE_NAME)}else{fileStore=db.createObjectStore(IDBFS.DB_STORE_NAME)}if(!fileStore.indexNames.contains("timestamp")){fileStore.createIndex("timestamp","timestamp",{unique:false})}};req.onsuccess=()=>{db=req.result;IDBFS.dbs[name]=db;callback(null,db)};req.onerror=e=>{callback(e.target.error);e.preventDefault()}},getLocalSet:(mount,callback)=>{var entries={};function isRealDir(p){return p!=="."&&p!==".."}function toAbsolute(root){return p=>PATH.join2(root,p)}var check=FS.readdir(mount.mountpoint).filter(isRealDir).map(toAbsolute(mount.mountpoint));while(check.length){var path=check.pop();var stat;try{stat=FS.stat(path)}catch(e){return callback(e)}if(FS.isDir(stat.mode)){check.push(...FS.readdir(path).filter(isRealDir).map(toAbsolute(path)))}entries[path]={timestamp:stat.mtime}}return callback(null,{type:"local",entries})},getRemoteSet:(mount,callback)=>{var entries={};IDBFS.getDB(mount.mountpoint,(err,db)=>{if(err)return callback(err);try{var transaction=db.transaction([IDBFS.DB_STORE_NAME],"readonly");transaction.onerror=e=>{callback(e.target.error);e.preventDefault()};var store=transaction.objectStore(IDBFS.DB_STORE_NAME);var index=store.index("timestamp");index.openKeyCursor().onsuccess=event=>{var cursor=event.target.result;if(!cursor){return callback(null,{type:"remote",db,entries})}entries[cursor.primaryKey]={timestamp:cursor.key};cursor.continue()}}catch(e){return callback(e)}})},loadLocalEntry:(path,callback)=>{var stat,node;try{var lookup=FS.lookupPath(path);node=lookup.node;stat=FS.stat(path)}catch(e){return callback(e)}if(FS.isDir(stat.mode)){return callback(null,{timestamp:stat.mtime,mode:stat.mode})}else if(FS.isFile(stat.mode)){node.contents=MEMFS.getFileDataAsTypedArray(node);return callback(null,{timestamp:stat.mtime,mode:stat.mode,contents:node.contents})}else{return callback(new Error("node type not supported"))}},storeLocalEntry:(path,entry,callback)=>{try{if(FS.isDir(entry["mode"])){FS.mkdirTree(path,entry["mode"])}else if(FS.isFile(entry["mode"])){FS.writeFile(path,entry["contents"],{canOwn:true})}else{return callback(new Error("node type not supported"))}FS.chmod(path,entry["mode"]);FS.utime(path,entry["timestamp"],entry["timestamp"])}catch(e){return callback(e)}callback(null)},removeLocalEntry:(path,callback)=>{try{var stat=FS.stat(path);if(FS.isDir(stat.mode)){FS.rmdir(path)}else if(FS.isFile(stat.mode)){FS.unlink(path)}}catch(e){return callback(e)}callback(null)},loadRemoteEntry:(store,path,callback)=>{var req=store.get(path);req.onsuccess=event=>callback(null,event.target.result);req.onerror=e=>{callback(e.target.error);e.preventDefault()}},storeRemoteEntry:(store,path,entry,callback)=>{try{var req=store.put(entry,path)}catch(e){callback(e);return}req.onsuccess=event=>callback();req.onerror=e=>{callback(e.target.error);e.preventDefault()}},removeRemoteEntry:(store,path,callback)=>{var req=store.delete(path);req.onsuccess=event=>callback();req.onerror=e=>{callback(e.target.error);e.preventDefault()}},reconcile:(src,dst,callback)=>{var total=0;var create=[];Object.keys(src.entries).forEach(key=>{var e=src.entries[key];var e2=dst.entries[key];if(!e2||e["timestamp"].getTime()!=e2["timestamp"].getTime()){create.push(key);total++}});var remove=[];Object.keys(dst.entries).forEach(key=>{if(!src.entries[key]){remove.push(key);total++}});if(!total){return callback(null)}var errored=false;var db=src.type==="remote"?src.db:dst.db;var transaction=db.transaction([IDBFS.DB_STORE_NAME],"readwrite");var store=transaction.objectStore(IDBFS.DB_STORE_NAME);function done(err){if(err&&!errored){errored=true;return callback(err)}}transaction.onerror=transaction.onabort=e=>{done(e.target.error);e.preventDefault()};transaction.oncomplete=e=>{if(!errored){callback(null)}};create.sort().forEach(path=>{if(dst.type==="local"){IDBFS.loadRemoteEntry(store,path,(err,entry)=>{if(err)return done(err);IDBFS.storeLocalEntry(path,entry,done)})}else{IDBFS.loadLocalEntry(path,(err,entry)=>{if(err)return done(err);IDBFS.storeRemoteEntry(store,path,entry,done)})}});remove.sort().reverse().forEach(path=>{if(dst.type==="local"){IDBFS.removeLocalEntry(path,done)}else{IDBFS.removeRemoteEntry(store,path,done)}})}};var FS={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:false,ignorePermissions:true,ErrnoError:class{name="ErrnoError";constructor(errno){this.errno=errno}},genericErrors:{},filesystems:null,syncFSRequests:0,readFiles:{},FSStream:class{shared={};get object(){return this.node}set object(val){this.node=val}get isRead(){return(this.flags&2097155)!==1}get isWrite(){return(this.flags&2097155)!==0}get isAppend(){return this.flags&1024}get flags(){return this.shared.flags}set flags(val){this.shared.flags=val}get position(){return this.shared.position}set position(val){this.shared.position=val}},FSNode:class{node_ops={};stream_ops={};readMode=292|73;writeMode=146;mounted=null;constructor(parent,name,mode,rdev){if(!parent){parent=this}this.parent=parent;this.mount=parent.mount;this.id=FS.nextInode++;this.name=name;this.mode=mode;this.rdev=rdev}get read(){return(this.mode&this.readMode)===this.readMode}set read(val){val?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(val){val?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return FS.isDir(this.mode)}get isDevice(){return FS.isChrdev(this.mode)}},lookupPath(path,opts={}){path=PATH_FS.resolve(path);if(!path)return{path:"",node:null};var defaults={follow_mount:true,recurse_count:0};opts=Object.assign(defaults,opts);if(opts.recurse_count>8){throw new FS.ErrnoError(32)}var parts=path.split("/").filter(p=>!!p);var current=FS.root;var current_path="/";for(var i=0;i<parts.length;i++){var islast=i===parts.length-1;if(islast&&opts.parent){break}current=FS.lookupNode(current,parts[i]);current_path=PATH.join2(current_path,parts[i]);if(FS.isMountpoint(current)){if(!islast||islast&&opts.follow_mount){current=current.mounted.root}}if(!islast||opts.follow){var count=0;while(FS.isLink(current.mode)){var link=FS.readlink(current_path);current_path=PATH_FS.resolve(PATH.dirname(current_path),link);var lookup=FS.lookupPath(current_path,{recurse_count:opts.recurse_count+1});current=lookup.node;if(count++>40){throw new FS.ErrnoError(32)}}}}return{path:current_path,node:current}},getPath(node){var path;while(true){if(FS.isRoot(node)){var mount=node.mount.mountpoint;if(!path)return mount;return mount[mount.length-1]!=="/"?`${mount}/${path}`:mount+path}path=path?`${node.name}/${path}`:node.name;node=node.parent}},hashName(parentid,name){var hash=0;for(var i=0;i<name.length;i++){hash=(hash<<5)-hash+name.charCodeAt(i)|0}return(parentid+hash>>>0)%FS.nameTable.length},hashAddNode(node){var hash=FS.hashName(node.parent.id,node.name);node.name_next=FS.nameTable[hash];FS.nameTable[hash]=node},hashRemoveNode(node){var hash=FS.hashName(node.parent.id,node.name);if(FS.nameTable[hash]===node){FS.nameTable[hash]=node.name_next}else{var current=FS.nameTable[hash];while(current){if(current.name_next===node){current.name_next=node.name_next;break}current=current.name_next}}},lookupNode(parent,name){var errCode=FS.mayLookup(parent);if(errCode){throw new FS.ErrnoError(errCode)}var hash=FS.hashName(parent.id,name);for(var node=FS.nameTable[hash];node;node=node.name_next){var nodeName=node.name;if(node.parent.id===parent.id&&nodeName===name){return node}}return FS.lookup(parent,name)},createNode(parent,name,mode,rdev){var node=new FS.FSNode(parent,name,mode,rdev);FS.hashAddNode(node);return node},destroyNode(node){FS.hashRemoveNode(node)},isRoot(node){return node===node.parent},isMountpoint(node){return!!node.mounted},isFile(mode){return(mode&61440)===32768},isDir(mode){return(mode&61440)===16384},isLink(mode){return(mode&61440)===40960},isChrdev(mode){return(mode&61440)===8192},isBlkdev(mode){return(mode&61440)===24576},isFIFO(mode){return(mode&61440)===4096},isSocket(mode){return(mode&49152)===49152},flagsToPermissionString(flag){var perms=["r","w","rw"][flag&3];if(flag&512){perms+="w"}return perms},nodePermissions(node,perms){if(FS.ignorePermissions){return 0}if(perms.includes("r")&&!(node.mode&292)){return 2}else if(perms.includes("w")&&!(node.mode&146)){return 2}else if(perms.includes("x")&&!(node.mode&73)){return 2}return 0},mayLookup(dir){if(!FS.isDir(dir.mode))return 54;var errCode=FS.nodePermissions(dir,"x");if(errCode)return errCode;if(!dir.node_ops.lookup)return 2;return 0},mayCreate(dir,name){try{var node=FS.lookupNode(dir,name);return 20}catch(e){}return FS.nodePermissions(dir,"wx")},mayDelete(dir,name,isdir){var node;try{node=FS.lookupNode(dir,name)}catch(e){return e.errno}var errCode=FS.nodePermissions(dir,"wx");if(errCode){return errCode}if(isdir){if(!FS.isDir(node.mode)){return 54}if(FS.isRoot(node)||FS.getPath(node)===FS.cwd()){return 10}}else{if(FS.isDir(node.mode)){return 31}}return 0},mayOpen(node,flags){if(!node){return 44}if(FS.isLink(node.mode)){return 32}else if(FS.isDir(node.mode)){if(FS.flagsToPermissionString(flags)!=="r"||flags&512){return 31}}return FS.nodePermissions(node,FS.flagsToPermissionString(flags))},MAX_OPEN_FDS:4096,nextfd(){for(var fd=0;fd<=FS.MAX_OPEN_FDS;fd++){if(!FS.streams[fd]){return fd}}throw new FS.ErrnoError(33)},getStreamChecked(fd){var stream=FS.getStream(fd);if(!stream){throw new FS.ErrnoError(8)}return stream},getStream:fd=>FS.streams[fd],createStream(stream,fd=-1){stream=Object.assign(new FS.FSStream,stream);if(fd==-1){fd=FS.nextfd()}stream.fd=fd;FS.streams[fd]=stream;return stream},closeStream(fd){FS.streams[fd]=null},dupStream(origStream,fd=-1){var stream=FS.createStream(origStream,fd);stream.stream_ops?.dup?.(stream);return stream},chrdev_stream_ops:{open(stream){var device=FS.getDevice(stream.node.rdev);stream.stream_ops=device.stream_ops;stream.stream_ops.open?.(stream)},llseek(){throw new FS.ErrnoError(70)}},major:dev=>dev>>8,minor:dev=>dev&255,makedev:(ma,mi)=>ma<<8|mi,registerDevice(dev,ops){FS.devices[dev]={stream_ops:ops}},getDevice:dev=>FS.devices[dev],getMounts(mount){var mounts=[];var check=[mount];while(check.length){var m=check.pop();mounts.push(m);check.push(...m.mounts)}return mounts},syncfs(populate,callback){if(typeof populate=="function"){callback=populate;populate=false}FS.syncFSRequests++;if(FS.syncFSRequests>1){err(`warning: ${FS.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`)}var mounts=FS.getMounts(FS.root.mount);var completed=0;function doCallback(errCode){FS.syncFSRequests--;return callback(errCode)}function done(errCode){if(errCode){if(!done.errored){done.errored=true;return doCallback(errCode)}return}if(++completed>=mounts.length){doCallback(null)}}mounts.forEach(mount=>{if(!mount.type.syncfs){return done(null)}mount.type.syncfs(mount,populate,done)})},mount(type,opts,mountpoint){var root=mountpoint==="/";var pseudo=!mountpoint;var node;if(root&&FS.root){throw new FS.ErrnoError(10)}else if(!root&&!pseudo){var lookup=FS.lookupPath(mountpoint,{follow_mount:false});mountpoint=lookup.path;node=lookup.node;if(FS.isMountpoint(node)){throw new FS.ErrnoError(10)}if(!FS.isDir(node.mode)){throw new FS.ErrnoError(54)}}var mount={type,opts,mountpoint,mounts:[]};var mountRoot=type.mount(mount);mountRoot.mount=mount;mount.root=mountRoot;if(root){FS.root=mountRoot}else if(node){node.mounted=mount;if(node.mount){node.mount.mounts.push(mount)}}return mountRoot},unmount(mountpoint){var lookup=FS.lookupPath(mountpoint,{follow_mount:false});if(!FS.isMountpoint(lookup.node)){throw new FS.ErrnoError(28)}var node=lookup.node;var mount=node.mounted;var mounts=FS.getMounts(mount);Object.keys(FS.nameTable).forEach(hash=>{var current=FS.nameTable[hash];while(current){var next=current.name_next;if(mounts.includes(current.mount)){FS.destroyNode(current)}current=next}});node.mounted=null;var idx=node.mount.mounts.indexOf(mount);node.mount.mounts.splice(idx,1)},lookup(parent,name){return parent.node_ops.lookup(parent,name)},mknod(path,mode,dev){var lookup=FS.lookupPath(path,{parent:true});var parent=lookup.node;var name=PATH.basename(path);if(!name||name==="."||name===".."){throw new FS.ErrnoError(28)}var errCode=FS.mayCreate(parent,name);if(errCode){throw new FS.ErrnoError(errCode)}if(!parent.node_ops.mknod){throw new FS.ErrnoError(63)}return parent.node_ops.mknod(parent,name,mode,dev)},create(path,mode){mode=mode!==undefined?mode:438;mode&=4095;mode|=32768;return FS.mknod(path,mode,0)},mkdir(path,mode){mode=mode!==undefined?mode:511;mode&=511|512;mode|=16384;return FS.mknod(path,mode,0)},mkdirTree(path,mode){var dirs=path.split("/");var d="";for(var i=0;i<dirs.length;++i){if(!dirs[i])continue;d+="/"+dirs[i];try{FS.mkdir(d,mode)}catch(e){if(e.errno!=20)throw e}}},mkdev(path,mode,dev){if(typeof dev=="undefined"){dev=mode;mode=438}mode|=8192;return FS.mknod(path,mode,dev)},symlink(oldpath,newpath){if(!PATH_FS.resolve(oldpath)){throw new FS.ErrnoError(44)}var lookup=FS.lookupPath(newpath,{parent:true});var parent=lookup.node;if(!parent){throw new FS.ErrnoError(44)}var newname=PATH.basename(newpath);var errCode=FS.mayCreate(parent,newname);if(errCode){throw new FS.ErrnoError(errCode)}if(!parent.node_ops.symlink){throw new FS.ErrnoError(63)}return parent.node_ops.symlink(parent,newname,oldpath)},rename(old_path,new_path){var old_dirname=PATH.dirname(old_path);var new_dirname=PATH.dirname(new_path);var old_name=PATH.basename(old_path);var new_name=PATH.basename(new_path);var lookup,old_dir,new_dir;lookup=FS.lookupPath(old_path,{parent:true});old_dir=lookup.node;lookup=FS.lookupPath(new_path,{parent:true});new_dir=lookup.node;if(!old_dir||!new_dir)throw new FS.ErrnoError(44);if(old_dir.mount!==new_dir.mount){throw new FS.ErrnoError(75)}var old_node=FS.lookupNode(old_dir,old_name);var relative=PATH_FS.relative(old_path,new_dirname);if(relative.charAt(0)!=="."){throw new FS.ErrnoError(28)}relative=PATH_FS.relative(new_path,old_dirname);if(relative.charAt(0)!=="."){throw new FS.ErrnoError(55)}var new_node;try{new_node=FS.lookupNode(new_dir,new_name)}catch(e){}if(old_node===new_node){return}var isdir=FS.isDir(old_node.mode);var errCode=FS.mayDelete(old_dir,old_name,isdir);if(errCode){throw new FS.ErrnoError(errCode)}errCode=new_node?FS.mayDelete(new_dir,new_name,isdir):FS.mayCreate(new_dir,new_name);if(errCode){throw new FS.ErrnoError(errCode)}if(!old_dir.node_ops.rename){throw new FS.ErrnoError(63)}if(FS.isMountpoint(old_node)||new_node&&FS.isMountpoint(new_node)){throw new FS.ErrnoError(10)}if(new_dir!==old_dir){errCode=FS.nodePermissions(old_dir,"w");if(errCode){throw new FS.ErrnoError(errCode)}}FS.hashRemoveNode(old_node);try{old_dir.node_ops.rename(old_node,new_dir,new_name);old_node.parent=new_dir}catch(e){throw e}finally{FS.hashAddNode(old_node)}},rmdir(path){var lookup=FS.lookupPath(path,{parent:true});var parent=lookup.node;var name=PATH.basename(path);var node=FS.lookupNode(parent,name);var errCode=FS.mayDelete(parent,name,true);if(errCode){throw new FS.ErrnoError(errCode)}if(!parent.node_ops.rmdir){throw new FS.ErrnoError(63)}if(FS.isMountpoint(node)){throw new FS.ErrnoError(10)}parent.node_ops.rmdir(parent,name);FS.destroyNode(node)},readdir(path){var lookup=FS.lookupPath(path,{follow:true});var node=lookup.node;if(!node.node_ops.readdir){throw new FS.ErrnoError(54)}return node.node_ops.readdir(node)},unlink(path){var lookup=FS.lookupPath(path,{parent:true});var parent=lookup.node;if(!parent){throw new FS.ErrnoError(44)}var name=PATH.basename(path);var node=FS.lookupNode(parent,name);var errCode=FS.mayDelete(parent,name,false);if(errCode){throw new FS.ErrnoError(errCode)}if(!parent.node_ops.unlink){throw new FS.ErrnoError(63)}if(FS.isMountpoint(node)){throw new FS.ErrnoError(10)}parent.node_ops.unlink(parent,name);FS.destroyNode(node)},readlink(path){var lookup=FS.lookupPath(path);var link=lookup.node;if(!link){throw new FS.ErrnoError(44)}if(!link.node_ops.readlink){throw new FS.ErrnoError(28)}return PATH_FS.resolve(FS.getPath(link.parent),link.node_ops.readlink(link))},stat(path,dontFollow){var lookup=FS.lookupPath(path,{follow:!dontFollow});var node=lookup.node;if(!node){throw new FS.ErrnoError(44)}if(!node.node_ops.getattr){throw new FS.ErrnoError(63)}return node.node_ops.getattr(node)},lstat(path){return FS.stat(path,true)},chmod(path,mode,dontFollow){var node;if(typeof path=="string"){var lookup=FS.lookupPath(path,{follow:!dontFollow});node=lookup.node}else{node=path}if(!node.node_ops.setattr){throw new FS.ErrnoError(63)}node.node_ops.setattr(node,{mode:mode&4095|node.mode&~4095,timestamp:Date.now()})},lchmod(path,mode){FS.chmod(path,mode,true)},fchmod(fd,mode){var stream=FS.getStreamChecked(fd);FS.chmod(stream.node,mode)},chown(path,uid,gid,dontFollow){var node;if(typeof path=="string"){var lookup=FS.lookupPath(path,{follow:!dontFollow});node=lookup.node}else{node=path}if(!node.node_ops.setattr){throw new FS.ErrnoError(63)}node.node_ops.setattr(node,{timestamp:Date.now()})},lchown(path,uid,gid){FS.chown(path,uid,gid,true)},fchown(fd,uid,gid){var stream=FS.getStreamChecked(fd);FS.chown(stream.node,uid,gid)},truncate(path,len){if(len<0){throw new FS.ErrnoError(28)}var node;if(typeof path=="string"){var lookup=FS.lookupPath(path,{follow:true});node=lookup.node}else{node=path}if(!node.node_ops.setattr){throw new FS.ErrnoError(63)}if(FS.isDir(node.mode)){throw new FS.ErrnoError(31)}if(!FS.isFile(node.mode)){throw new FS.ErrnoError(28)}var errCode=FS.nodePermissions(node,"w");if(errCode){throw new FS.ErrnoError(errCode)}node.node_ops.setattr(node,{size:len,timestamp:Date.now()})},ftruncate(fd,len){var stream=FS.getStreamChecked(fd);if((stream.flags&2097155)===0){throw new FS.ErrnoError(28)}FS.truncate(stream.node,len)},utime(path,atime,mtime){var lookup=FS.lookupPath(path,{follow:true});var node=lookup.node;node.node_ops.setattr(node,{timestamp:Math.max(atime,mtime)})},open(path,flags,mode){if(path===""){throw new FS.ErrnoError(44)}flags=typeof flags=="string"?FS_modeStringToFlags(flags):flags;if(flags&64){mode=typeof mode=="undefined"?438:mode;mode=mode&4095|32768}else{mode=0}var node;if(typeof path=="object"){node=path}else{path=PATH.normalize(path);try{var lookup=FS.lookupPath(path,{follow:!(flags&131072)});node=lookup.node}catch(e){}}var created=false;if(flags&64){if(node){if(flags&128){throw new FS.ErrnoError(20)}}else{node=FS.mknod(path,mode,0);created=true}}if(!node){throw new FS.ErrnoError(44)}if(FS.isChrdev(node.mode)){flags&=~512}if(flags&65536&&!FS.isDir(node.mode)){throw new FS.ErrnoError(54)}if(!created){var errCode=FS.mayOpen(node,flags);if(errCode){throw new FS.ErrnoError(errCode)}}if(flags&512&&!created){FS.truncate(node,0)}flags&=~(128|512|131072);var stream=FS.createStream({node,path:FS.getPath(node),flags,seekable:true,position:0,stream_ops:node.stream_ops,ungotten:[],error:false});if(stream.stream_ops.open){stream.stream_ops.open(stream)}if(Module["logReadFiles"]&&!(flags&1)){if(!(path in FS.readFiles)){FS.readFiles[path]=1}}return stream},close(stream){if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if(stream.getdents)stream.getdents=null;try{if(stream.stream_ops.close){stream.stream_ops.close(stream)}}catch(e){throw e}finally{FS.closeStream(stream.fd)}stream.fd=null},isClosed(stream){return stream.fd===null},llseek(stream,offset,whence){if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if(!stream.seekable||!stream.stream_ops.llseek){throw new FS.ErrnoError(70)}if(whence!=0&&whence!=1&&whence!=2){throw new FS.ErrnoError(28)}stream.position=stream.stream_ops.llseek(stream,offset,whence);stream.ungotten=[];return stream.position},read(stream,buffer,offset,length,position){if(length<0||position<0){throw new FS.ErrnoError(28)}if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if((stream.flags&2097155)===1){throw new FS.ErrnoError(8)}if(FS.isDir(stream.node.mode)){throw new FS.ErrnoError(31)}if(!stream.stream_ops.read){throw new FS.ErrnoError(28)}var seeking=typeof position!="undefined";if(!seeking){position=stream.position}else if(!stream.seekable){throw new FS.ErrnoError(70)}var bytesRead=stream.stream_ops.read(stream,buffer,offset,length,position);if(!seeking)stream.position+=bytesRead;return bytesRead},write(stream,buffer,offset,length,position,canOwn){if(length<0||position<0){throw new FS.ErrnoError(28)}if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if((stream.flags&2097155)===0){throw new FS.ErrnoError(8)}if(FS.isDir(stream.node.mode)){throw new FS.ErrnoError(31)}if(!stream.stream_ops.write){throw new FS.ErrnoError(28)}if(stream.seekable&&stream.flags&1024){FS.llseek(stream,0,2)}var seeking=typeof position!="undefined";if(!seeking){position=stream.position}else if(!stream.seekable){throw new FS.ErrnoError(70)}var bytesWritten=stream.stream_ops.write(stream,buffer,offset,length,position,canOwn);if(!seeking)stream.position+=bytesWritten;return bytesWritten},allocate(stream,offset,length){if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if(offset<0||length<=0){throw new FS.ErrnoError(28)}if((stream.flags&2097155)===0){throw new FS.ErrnoError(8)}if(!FS.isFile(stream.node.mode)&&!FS.isDir(stream.node.mode)){throw new FS.ErrnoError(43)}if(!stream.stream_ops.allocate){throw new FS.ErrnoError(138)}stream.stream_ops.allocate(stream,offset,length)},mmap(stream,length,position,prot,flags){if((prot&2)!==0&&(flags&2)===0&&(stream.flags&2097155)!==2){throw new FS.ErrnoError(2)}if((stream.flags&2097155)===1){throw new FS.ErrnoError(2)}if(!stream.stream_ops.mmap){throw new FS.ErrnoError(43)}if(!length){throw new FS.ErrnoError(28)}return stream.stream_ops.mmap(stream,length,position,prot,flags)},msync(stream,buffer,offset,length,mmapFlags){if(!stream.stream_ops.msync){return 0}return stream.stream_ops.msync(stream,buffer,offset,length,mmapFlags)},ioctl(stream,cmd,arg){if(!stream.stream_ops.ioctl){throw new FS.ErrnoError(59)}return stream.stream_ops.ioctl(stream,cmd,arg)},readFile(path,opts={}){opts.flags=opts.flags||0;opts.encoding=opts.encoding||"binary";if(opts.encoding!=="utf8"&&opts.encoding!=="binary"){throw new Error(`Invalid encoding type "${opts.encoding}"`)}var ret;var stream=FS.open(path,opts.flags);var stat=FS.stat(path);var length=stat.size;var buf=new Uint8Array(length);FS.read(stream,buf,0,length,0);if(opts.encoding==="utf8"){ret=UTF8ArrayToString(buf)}else if(opts.encoding==="binary"){ret=buf}FS.close(stream);return ret},writeFile(path,data,opts={}){opts.flags=opts.flags||577;var stream=FS.open(path,opts.flags,opts.mode);if(typeof data=="string"){var buf=new Uint8Array(lengthBytesUTF8(data)+1);var actualNumBytes=stringToUTF8Array(data,buf,0,buf.length);FS.write(stream,buf,0,actualNumBytes,undefined,opts.canOwn)}else if(ArrayBuffer.isView(data)){FS.write(stream,data,0,data.byteLength,undefined,opts.canOwn)}else{throw new Error("Unsupported data type")}FS.close(stream)},cwd:()=>FS.currentPath,chdir(path){var lookup=FS.lookupPath(path,{follow:true});if(lookup.node===null){throw new FS.ErrnoError(44)}if(!FS.isDir(lookup.node.mode)){throw new FS.ErrnoError(54)}var errCode=FS.nodePermissions(lookup.node,"x");if(errCode){throw new FS.ErrnoError(errCode)}FS.currentPath=lookup.path},createDefaultDirectories(){FS.mkdir("/tmp");FS.mkdir("/home");FS.mkdir("/home/web_user")},createDefaultDevices(){FS.mkdir("/dev");FS.registerDevice(FS.makedev(1,3),{read:()=>0,write:(stream,buffer,offset,length,pos)=>length});FS.mkdev("/dev/null",FS.makedev(1,3));TTY.register(FS.makedev(5,0),TTY.default_tty_ops);TTY.register(FS.makedev(6,0),TTY.default_tty1_ops);FS.mkdev("/dev/tty",FS.makedev(5,0));FS.mkdev("/dev/tty1",FS.makedev(6,0));var randomBuffer=new Uint8Array(1024),randomLeft=0;var randomByte=()=>{if(randomLeft===0){randomLeft=randomFill(randomBuffer).byteLength}return randomBuffer[--randomLeft]};FS.createDevice("/dev","random",randomByte);FS.createDevice("/dev","urandom",randomByte);FS.mkdir("/dev/shm");FS.mkdir("/dev/shm/tmp")},createSpecialDirectories(){FS.mkdir("/proc");var proc_self=FS.mkdir("/proc/self");FS.mkdir("/proc/self/fd");FS.mount({mount(){var node=FS.createNode(proc_self,"fd",16384|511,73);node.node_ops={lookup(parent,name){var fd=+name;var stream=FS.getStreamChecked(fd);var ret={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>stream.path}};ret.parent=ret;return ret}};return node}},{},"/proc/self/fd")},createStandardStreams(input,output,error){if(input){FS.createDevice("/dev","stdin",input)}else{FS.symlink("/dev/tty","/dev/stdin")}if(output){FS.createDevice("/dev","stdout",null,output)}else{FS.symlink("/dev/tty","/dev/stdout")}if(error){FS.createDevice("/dev","stderr",null,error)}else{FS.symlink("/dev/tty1","/dev/stderr")}var stdin=FS.open("/dev/stdin",0);var stdout=FS.open("/dev/stdout",1);var stderr=FS.open("/dev/stderr",1)},staticInit(){[44].forEach(code=>{FS.genericErrors[code]=new FS.ErrnoError(code);FS.genericErrors[code].stack="<generic error, no stack>"});FS.nameTable=new Array(4096);FS.mount(MEMFS,{},"/");FS.createDefaultDirectories();FS.createDefaultDevices();FS.createSpecialDirectories();FS.filesystems={MEMFS,IDBFS}},init(input,output,error){FS.initialized=true;input??=Module["stdin"];output??=Module["stdout"];error??=Module["stderr"];FS.createStandardStreams(input,output,error)},quit(){FS.initialized=false;for(var i=0;i<FS.streams.length;i++){var stream=FS.streams[i];if(!stream){continue}FS.close(stream)}},findObject(path,dontResolveLastLink){var ret=FS.analyzePath(path,dontResolveLastLink);if(!ret.exists){return null}return ret.object},analyzePath(path,dontResolveLastLink){try{var lookup=FS.lookupPath(path,{follow:!dontResolveLastLink});path=lookup.path}catch(e){}var ret={isRoot:false,exists:false,error:0,name:null,path:null,object:null,parentExists:false,parentPath:null,parentObject:null};try{var lookup=FS.lookupPath(path,{parent:true});ret.parentExists=true;ret.parentPath=lookup.path;ret.parentObject=lookup.node;ret.name=PATH.basename(path);lookup=FS.lookupPath(path,{follow:!dontResolveLastLink});ret.exists=true;ret.path=lookup.path;ret.object=lookup.node;ret.name=lookup.node.name;ret.isRoot=lookup.path==="/"}catch(e){ret.error=e.errno}return ret},createPath(parent,path,canRead,canWrite){parent=typeof parent=="string"?parent:FS.getPath(parent);var parts=path.split("/").reverse();while(parts.length){var part=parts.pop();if(!part)continue;var current=PATH.join2(parent,part);try{FS.mkdir(current)}catch(e){}parent=current}return current},createFile(parent,name,properties,canRead,canWrite){var path=PATH.join2(typeof parent=="string"?parent:FS.getPath(parent),name);var mode=FS_getMode(canRead,canWrite);return FS.create(path,mode)},createDataFile(parent,name,data,canRead,canWrite,canOwn){var path=name;if(parent){parent=typeof parent=="string"?parent:FS.getPath(parent);path=name?PATH.join2(parent,name):parent}var mode=FS_getMode(canRead,canWrite);var node=FS.create(path,mode);if(data){if(typeof data=="string"){var arr=new Array(data.length);for(var i=0,len=data.length;i<len;++i)arr[i]=data.charCodeAt(i);data=arr}FS.chmod(node,mode|146);var stream=FS.open(node,577);FS.write(stream,data,0,data.length,0,canOwn);FS.close(stream);FS.chmod(node,mode)}},createDevice(parent,name,input,output){var path=PATH.join2(typeof parent=="string"?parent:FS.getPath(parent),name);var mode=FS_getMode(!!input,!!output);FS.createDevice.major??=64;var dev=FS.makedev(FS.createDevice.major++,0);FS.registerDevice(dev,{open(stream){stream.seekable=false},close(stream){if(output?.buffer?.length){output(10)}},read(stream,buffer,offset,length,pos){var bytesRead=0;for(var i=0;i<length;i++){var result;try{result=input()}catch(e){throw new FS.ErrnoError(29)}if(result===undefined&&bytesRead===0){throw new FS.ErrnoError(6)}if(result===null||result===undefined)break;bytesRead++;buffer[offset+i]=result}if(bytesRead){stream.node.timestamp=Date.now()}return bytesRead},write(stream,buffer,offset,length,pos){for(var i=0;i<length;i++){try{output(buffer[offset+i])}catch(e){throw new FS.ErrnoError(29)}}if(length){stream.node.timestamp=Date.now()}return i}});return FS.mkdev(path,mode,dev)},forceLoadFile(obj){if(obj.isDevice||obj.isFolder||obj.link||obj.contents)return true;if(typeof XMLHttpRequest!="undefined"){throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.")}else{try{obj.contents=readBinary(obj.url);obj.usedBytes=obj.contents.length}catch(e){throw new FS.ErrnoError(29)}}},createLazyFile(parent,name,url,canRead,canWrite){class LazyUint8Array{lengthKnown=false;chunks=[];get(idx){if(idx>this.length-1||idx<0){return undefined}var chunkOffset=idx%this.chunkSize;var chunkNum=idx/this.chunkSize|0;return this.getter(chunkNum)[chunkOffset]}setDataGetter(getter){this.getter=getter}cacheLength(){var xhr=new XMLHttpRequest;xhr.open("HEAD",url,false);xhr.send(null);if(!(xhr.status>=200&&xhr.status<300||xhr.status===304))throw new Error("Couldn't load "+url+". Status: "+xhr.status);var datalength=Number(xhr.getResponseHeader("Content-length"));var header;var hasByteServing=(header=xhr.getResponseHeader("Accept-Ranges"))&&header==="bytes";var usesGzip=(header=xhr.getResponseHeader("Content-Encoding"))&&header==="gzip";var chunkSize=1024*1024;if(!hasByteServing)chunkSize=datalength;var doXHR=(from,to)=>{if(from>to)throw new Error("invalid range ("+from+", "+to+") or no bytes requested!");if(to>datalength-1)throw new Error("only "+datalength+" bytes available! programmer error!");var xhr=new XMLHttpRequest;xhr.open("GET",url,false);if(datalength!==chunkSize)xhr.setRequestHeader("Range","bytes="+from+"-"+to);xhr.responseType="arraybuffer";if(xhr.overrideMimeType){xhr.overrideMimeType("text/plain; charset=x-user-defined")}xhr.send(null);if(!(xhr.status>=200&&xhr.status<300||xhr.status===304))throw new Error("Couldn't load "+url+". Status: "+xhr.status);if(xhr.response!==undefined){return new Uint8Array(xhr.response||[])}return intArrayFromString(xhr.responseText||"",true)};var lazyArray=this;lazyArray.setDataGetter(chunkNum=>{var start=chunkNum*chunkSize;var end=(chunkNum+1)*chunkSize-1;end=Math.min(end,datalength-1);if(typeof lazyArray.chunks[chunkNum]=="undefined"){lazyArray.chunks[chunkNum]=doXHR(start,end)}if(typeof lazyArray.chunks[chunkNum]=="undefined")throw new Error("doXHR failed!");return lazyArray.chunks[chunkNum]});if(usesGzip||!datalength){chunkSize=datalength=1;datalength=this.getter(0).length;chunkSize=datalength;out("LazyFiles on gzip forces download of the whole file when length is accessed")}this._length=datalength;this._chunkSize=chunkSize;this.lengthKnown=true}get length(){if(!this.lengthKnown){this.cacheLength()}return this._length}get chunkSize(){if(!this.lengthKnown){this.cacheLength()}return this._chunkSize}}if(typeof XMLHttpRequest!="undefined"){if(!ENVIRONMENT_IS_WORKER)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var lazyArray=new LazyUint8Array;var properties={isDevice:false,contents:lazyArray}}else{var properties={isDevice:false,url}}var node=FS.createFile(parent,name,properties,canRead,canWrite);if(properties.contents){node.contents=properties.contents}else if(properties.url){node.contents=null;node.url=properties.url}Object.defineProperties(node,{usedBytes:{get:function(){return this.contents.length}}});var stream_ops={};var keys=Object.keys(node.stream_ops);keys.forEach(key=>{var fn=node.stream_ops[key];stream_ops[key]=(...args)=>{FS.forceLoadFile(node);return fn(...args)}});function writeChunks(stream,buffer,offset,length,position){var contents=stream.node.contents;if(position>=contents.length)return 0;var size=Math.min(contents.length-position,length);if(contents.slice){for(var i=0;i<size;i++){buffer[offset+i]=contents[position+i]}}else{for(var i=0;i<size;i++){buffer[offset+i]=contents.get(position+i)}}return size}stream_ops.read=(stream,buffer,offset,length,position)=>{FS.forceLoadFile(node);return writeChunks(stream,buffer,offset,length,position)};stream_ops.mmap=(stream,length,position,prot,flags)=>{FS.forceLoadFile(node);var ptr=mmapAlloc(length);if(!ptr){throw new FS.ErrnoError(48)}writeChunks(stream,HEAP8,ptr,length,position);return{ptr,allocated:true}};node.stream_ops=stream_ops;return node}};var UTF8ToString=(ptr,maxBytesToRead)=>ptr?UTF8ArrayToString(HEAPU8,ptr,maxBytesToRead):"";var SYSCALLS={DEFAULT_POLLMASK:5,calculateAt(dirfd,path,allowEmpty){if(PATH.isAbs(path)){return path}var dir;if(dirfd===-100){dir=FS.cwd()}else{var dirstream=SYSCALLS.getStreamFromFD(dirfd);dir=dirstream.path}if(path.length==0){if(!allowEmpty){throw new FS.ErrnoError(44)}return dir}return PATH.join2(dir,path)},doStat(func,path,buf){var stat=func(path);HEAP32[buf>>2]=stat.dev;HEAP32[buf+4>>2]=stat.mode;HEAPU32[buf+8>>2]=stat.nlink;HEAP32[buf+12>>2]=stat.uid;HEAP32[buf+16>>2]=stat.gid;HEAP32[buf+20>>2]=stat.rdev;HEAP64[buf+24>>3]=BigInt(stat.size);HEAP32[buf+32>>2]=4096;HEAP32[buf+36>>2]=stat.blocks;var atime=stat.atime.getTime();var mtime=stat.mtime.getTime();var ctime=stat.ctime.getTime();HEAP64[buf+40>>3]=BigInt(Math.floor(atime/1e3));HEAPU32[buf+48>>2]=atime%1e3*1e3*1e3;HEAP64[buf+56>>3]=BigInt(Math.floor(mtime/1e3));HEAPU32[buf+64>>2]=mtime%1e3*1e3*1e3;HEAP64[buf+72>>3]=BigInt(Math.floor(ctime/1e3));HEAPU32[buf+80>>2]=ctime%1e3*1e3*1e3;HEAP64[buf+88>>3]=BigInt(stat.ino);return 0},doMsync(addr,stream,len,flags,offset){if(!FS.isFile(stream.node.mode)){throw new FS.ErrnoError(43)}if(flags&2){return 0}var buffer=HEAPU8.slice(addr,addr+len);FS.msync(stream,buffer,offset,len,flags)},getStreamFromFD(fd){var stream=FS.getStreamChecked(fd);return stream},varargs:undefined,getStr(ptr){var ret=UTF8ToString(ptr);return ret}};function ___syscall_fcntl64(fd,cmd,varargs){SYSCALLS.varargs=varargs;try{var stream=SYSCALLS.getStreamFromFD(fd);switch(cmd){case 0:{var arg=syscallGetVarargI();if(arg<0){return-28}while(FS.streams[arg]){arg++}var newStream;newStream=FS.dupStream(stream,arg);return newStream.fd}case 1:case 2:return 0;case 3:return stream.flags;case 4:{var arg=syscallGetVarargI();stream.flags|=arg;return 0}case 12:{var arg=syscallGetVarargP();var offset=0;HEAP16[arg+offset>>1]=2;return 0}case 13:case 14:return 0}return-28}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}function ___syscall_fstat64(fd,buf){try{var stream=SYSCALLS.getStreamFromFD(fd);return SYSCALLS.doStat(FS.stat,stream.path,buf)}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}var stringToUTF8=(str,outPtr,maxBytesToWrite)=>stringToUTF8Array(str,HEAPU8,outPtr,maxBytesToWrite);function ___syscall_getdents64(fd,dirp,count){try{var stream=SYSCALLS.getStreamFromFD(fd);stream.getdents||=FS.readdir(stream.path);var struct_size=280;var pos=0;var off=FS.llseek(stream,0,1);var idx=Math.floor(off/struct_size);while(idx<stream.getdents.length&&pos+struct_size<=count){var id;var type;var name=stream.getdents[idx];if(name==="."){id=stream.node.id;type=4}else if(name===".."){var lookup=FS.lookupPath(stream.path,{parent:true});id=lookup.node.id;type=4}else{var child=FS.lookupNode(stream.node,name);id=child.id;type=FS.isChrdev(child.mode)?2:FS.isDir(child.mode)?4:FS.isLink(child.mode)?10:8}HEAP64[dirp+pos>>3]=BigInt(id);HEAP64[dirp+pos+8>>3]=BigInt((idx+1)*struct_size);HEAP16[dirp+pos+16>>1]=280;HEAP8[dirp+pos+18]=type;stringToUTF8(name,dirp+pos+19,256);pos+=struct_size;idx+=1}FS.llseek(stream,idx*struct_size,0);return pos}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}function ___syscall_ioctl(fd,op,varargs){SYSCALLS.varargs=varargs;try{var stream=SYSCALLS.getStreamFromFD(fd);switch(op){case 21509:{if(!stream.tty)return-59;return 0}case 21505:{if(!stream.tty)return-59;if(stream.tty.ops.ioctl_tcgets){var termios=stream.tty.ops.ioctl_tcgets(stream);var argp=syscallGetVarargP();HEAP32[argp>>2]=termios.c_iflag||0;HEAP32[argp+4>>2]=termios.c_oflag||0;HEAP32[argp+8>>2]=termios.c_cflag||0;HEAP32[argp+12>>2]=termios.c_lflag||0;for(var i=0;i<32;i++){HEAP8[argp+i+17]=termios.c_cc[i]||0}return 0}return 0}case 21510:case 21511:case 21512:{if(!stream.tty)return-59;return 0}case 21506:case 21507:case 21508:{if(!stream.tty)return-59;if(stream.tty.ops.ioctl_tcsets){var argp=syscallGetVarargP();var c_iflag=HEAP32[argp>>2];var c_oflag=HEAP32[argp+4>>2];var c_cflag=HEAP32[argp+8>>2];var c_lflag=HEAP32[argp+12>>2];var c_cc=[];for(var i=0;i<32;i++){c_cc.push(HEAP8[argp+i+17])}return stream.tty.ops.ioctl_tcsets(stream.tty,op,{c_iflag,c_oflag,c_cflag,c_lflag,c_cc})}return 0}case 21519:{if(!stream.tty)return-59;var argp=syscallGetVarargP();HEAP32[argp>>2]=0;return 0}case 21520:{if(!stream.tty)return-59;return-28}case 21531:{var argp=syscallGetVarargP();return FS.ioctl(stream,op,argp)}case 21523:{if(!stream.tty)return-59;if(stream.tty.ops.ioctl_tiocgwinsz){var winsize=stream.tty.ops.ioctl_tiocgwinsz(stream.tty);var argp=syscallGetVarargP();HEAP16[argp>>1]=winsize[0];HEAP16[argp+2>>1]=winsize[1]}return 0}case 21524:{if(!stream.tty)return-59;return 0}case 21515:{if(!stream.tty)return-59;return 0}default:return-28}}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}function ___syscall_lstat64(path,buf){try{path=SYSCALLS.getStr(path);return SYSCALLS.doStat(FS.lstat,path,buf)}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}function ___syscall_newfstatat(dirfd,path,buf,flags){try{path=SYSCALLS.getStr(path);var nofollow=flags&256;var allowEmpty=flags&4096;flags=flags&~6400;path=SYSCALLS.calculateAt(dirfd,path,allowEmpty);return SYSCALLS.doStat(nofollow?FS.lstat:FS.stat,path,buf)}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}function ___syscall_openat(dirfd,path,flags,varargs){SYSCALLS.varargs=varargs;try{path=SYSCALLS.getStr(path);path=SYSCALLS.calculateAt(dirfd,path);var mode=varargs?syscallGetVarargI():0;return FS.open(path,flags,mode).fd}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}function ___syscall_stat64(path,buf){try{path=SYSCALLS.getStr(path);return SYSCALLS.doStat(FS.stat,path,buf)}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}var __abort_js=()=>{abort("")};var tupleRegistrations={};var runDestructors=destructors=>{while(destructors.length){var ptr=destructors.pop();var del=destructors.pop();del(ptr)}};function readPointer(pointer){return this["fromWireType"](HEAPU32[pointer>>2])}var awaitingDependencies={};var registeredTypes={};var typeDependencies={};var InternalError;var throwInternalError=message=>{throw new InternalError(message)};var whenDependentTypesAreResolved=(myTypes,dependentTypes,getTypeConverters)=>{myTypes.forEach(type=>typeDependencies[type]=dependentTypes);function onComplete(typeConverters){var myTypeConverters=getTypeConverters(typeConverters);if(myTypeConverters.length!==myTypes.length){throwInternalError("Mismatched type converter count")}for(var i=0;i<myTypes.length;++i){registerType(myTypes[i],myTypeConverters[i])}}var typeConverters=new Array(dependentTypes.length);var unregisteredTypes=[];var registered=0;dependentTypes.forEach((dt,i)=>{if(registeredTypes.hasOwnProperty(dt)){typeConverters[i]=registeredTypes[dt]}else{unregisteredTypes.push(dt);if(!awaitingDependencies.hasOwnProperty(dt)){awaitingDependencies[dt]=[]}awaitingDependencies[dt].push(()=>{typeConverters[i]=registeredTypes[dt];++registered;if(registered===unregisteredTypes.length){onComplete(typeConverters)}})}});if(0===unregisteredTypes.length){onComplete(typeConverters)}};var __embind_finalize_value_array=rawTupleType=>{var reg=tupleRegistrations[rawTupleType];delete tupleRegistrations[rawTupleType];var elements=reg.elements;var elementsLength=elements.length;var elementTypes=elements.map(elt=>elt.getterReturnType).concat(elements.map(elt=>elt.setterArgumentType));var rawConstructor=reg.rawConstructor;var rawDestructor=reg.rawDestructor;whenDependentTypesAreResolved([rawTupleType],elementTypes,elementTypes=>{elements.forEach((elt,i)=>{var getterReturnType=elementTypes[i];var getter=elt.getter;var getterContext=elt.getterContext;var setterArgumentType=elementTypes[i+elementsLength];var setter=elt.setter;var setterContext=elt.setterContext;elt.read=ptr=>getterReturnType["fromWireType"](getter(getterContext,ptr));elt.write=(ptr,o)=>{var destructors=[];setter(setterContext,ptr,setterArgumentType["toWireType"](destructors,o));runDestructors(destructors)}});return[{name:reg.name,fromWireType:ptr=>{var rv=new Array(elementsLength);for(var i=0;i<elementsLength;++i){rv[i]=elements[i].read(ptr)}rawDestructor(ptr);return rv},toWireType:(destructors,o)=>{if(elementsLength!==o.length){throw new TypeError(`Incorrect number of tuple elements for ${reg.name}: expected=${elementsLength}, actual=${o.length}`)}var ptr=rawConstructor();for(var i=0;i<elementsLength;++i){elements[i].write(ptr,o[i])}if(destructors!==null){destructors.push(rawDestructor,ptr)}return ptr},argPackAdvance:GenericWireTypeSize,readValueFromPointer:readPointer,destructorFunction:rawDestructor}]})};var structRegistrations={};var __embind_finalize_value_object=structType=>{var reg=structRegistrations[structType];delete structRegistrations[structType];var rawConstructor=reg.rawConstructor;var rawDestructor=reg.rawDestructor;var fieldRecords=reg.fields;var fieldTypes=fieldRecords.map(field=>field.getterReturnType).concat(fieldRecords.map(field=>field.setterArgumentType));whenDependentTypesAreResolved([structType],fieldTypes,fieldTypes=>{var fields={};fieldRecords.forEach((field,i)=>{var fieldName=field.fieldName;var getterReturnType=fieldTypes[i];var getter=field.getter;var getterContext=field.getterContext;var setterArgumentType=fieldTypes[i+fieldRecords.length];var setter=field.setter;var setterContext=field.setterContext;fields[fieldName]={read:ptr=>getterReturnType["fromWireType"](getter(getterContext,ptr)),write:(ptr,o)=>{var destructors=[];setter(setterContext,ptr,setterArgumentType["toWireType"](destructors,o));runDestructors(destructors)}}});return[{name:reg.name,fromWireType:ptr=>{var rv={};for(var i in fields){rv[i]=fields[i].read(ptr)}rawDestructor(ptr);return rv},toWireType:(destructors,o)=>{for(var fieldName in fields){if(!(fieldName in o)){throw new TypeError(`Missing field: "${fieldName}"`)}}var ptr=rawConstructor();for(fieldName in fields){fields[fieldName].write(ptr,o[fieldName])}if(destructors!==null){destructors.push(rawDestructor,ptr)}return ptr},argPackAdvance:GenericWireTypeSize,readValueFromPointer:readPointer,destructorFunction:rawDestructor}]})};var embindRepr=v=>{if(v===null){return"null"}var t=typeof v;if(t==="object"||t==="array"||t==="function"){return v.toString()}else{return""+v}};var embind_init_charCodes=()=>{var codes=new Array(256);for(var i=0;i<256;++i){codes[i]=String.fromCharCode(i)}embind_charCodes=codes};var embind_charCodes;var readLatin1String=ptr=>{var ret="";var c=ptr;while(HEAPU8[c]){ret+=embind_charCodes[HEAPU8[c++]]}return ret};var BindingError;var throwBindingError=message=>{throw new BindingError(message)};function sharedRegisterType(rawType,registeredInstance,options={}){var name=registeredInstance.name;if(!rawType){throwBindingError(`type "${name}" must have a positive integer typeid pointer`)}if(registeredTypes.hasOwnProperty(rawType)){if(options.ignoreDuplicateRegistrations){return}else{throwBindingError(`Cannot register type '${name}' twice`)}}registeredTypes[rawType]=registeredInstance;delete typeDependencies[rawType];if(awaitingDependencies.hasOwnProperty(rawType)){var callbacks=awaitingDependencies[rawType];delete awaitingDependencies[rawType];callbacks.forEach(cb=>cb())}}function registerType(rawType,registeredInstance,options={}){return sharedRegisterType(rawType,registeredInstance,options)}var integerReadValueFromPointer=(name,width,signed)=>{switch(width){case 1:return signed?pointer=>HEAP8[pointer]:pointer=>HEAPU8[pointer];case 2:return signed?pointer=>HEAP16[pointer>>1]:pointer=>HEAPU16[pointer>>1];case 4:return signed?pointer=>HEAP32[pointer>>2]:pointer=>HEAPU32[pointer>>2];case 8:return signed?pointer=>HEAP64[pointer>>3]:pointer=>HEAPU64[pointer>>3];default:throw new TypeError(`invalid integer width (${width}): ${name}`)}};var __embind_register_bigint=(primitiveType,name,size,minRange,maxRange)=>{name=readLatin1String(name);var isUnsignedType=name.indexOf("u")!=-1;if(isUnsignedType){maxRange=(1n<<64n)-1n}registerType(primitiveType,{name,fromWireType:value=>value,toWireType:function(destructors,value){if(typeof value!="bigint"&&typeof value!="number"){throw new TypeError(`Cannot convert "${embindRepr(value)}" to ${this.name}`)}if(typeof value=="number"){value=BigInt(value)}return value},argPackAdvance:GenericWireTypeSize,readValueFromPointer:integerReadValueFromPointer(name,size,!isUnsignedType),destructorFunction:null})};var GenericWireTypeSize=8;var __embind_register_bool=(rawType,name,trueValue,falseValue)=>{name=readLatin1String(name);registerType(rawType,{name,fromWireType:function(wt){return!!wt},toWireType:function(destructors,o){return o?trueValue:falseValue},argPackAdvance:GenericWireTypeSize,readValueFromPointer:function(pointer){return this["fromWireType"](HEAPU8[pointer])},destructorFunction:null})};var shallowCopyInternalPointer=o=>({count:o.count,deleteScheduled:o.deleteScheduled,preservePointerOnDelete:o.preservePointerOnDelete,ptr:o.ptr,ptrType:o.ptrType,smartPtr:o.smartPtr,smartPtrType:o.smartPtrType});var throwInstanceAlreadyDeleted=obj=>{function getInstanceTypeName(handle){return handle.$$.ptrType.registeredClass.name}throwBindingError(getInstanceTypeName(obj)+" instance already deleted")};var finalizationRegistry=false;var detachFinalizer=handle=>{};var runDestructor=$$=>{if($$.smartPtr){$$.smartPtrType.rawDestructor($$.smartPtr)}else{$$.ptrType.registeredClass.rawDestructor($$.ptr)}};var releaseClassHandle=$$=>{$$.count.value-=1;var toDelete=0===$$.count.value;if(toDelete){runDestructor($$)}};var downcastPointer=(ptr,ptrClass,desiredClass)=>{if(ptrClass===desiredClass){return ptr}if(undefined===desiredClass.baseClass){return null}var rv=downcastPointer(ptr,ptrClass,desiredClass.baseClass);if(rv===null){return null}return desiredClass.downcast(rv)};var registeredPointers={};var registeredInstances={};var getBasestPointer=(class_,ptr)=>{if(ptr===undefined){throwBindingError("ptr should not be undefined")}while(class_.baseClass){ptr=class_.upcast(ptr);class_=class_.baseClass}return ptr};var getInheritedInstance=(class_,ptr)=>{ptr=getBasestPointer(class_,ptr);return registeredInstances[ptr]};var makeClassHandle=(prototype,record)=>{if(!record.ptrType||!record.ptr){throwInternalError("makeClassHandle requires ptr and ptrType")}var hasSmartPtrType=!!record.smartPtrType;var hasSmartPtr=!!record.smartPtr;if(hasSmartPtrType!==hasSmartPtr){throwInternalError("Both smartPtrType and smartPtr must be specified")}record.count={value:1};return attachFinalizer(Object.create(prototype,{$$:{value:record,writable:true}}))};function RegisteredPointer_fromWireType(ptr){var rawPointer=this.getPointee(ptr);if(!rawPointer){this.destructor(ptr);return null}var registeredInstance=getInheritedInstance(this.registeredClass,rawPointer);if(undefined!==registeredInstance){if(0===registeredInstance.$$.count.value){registeredInstance.$$.ptr=rawPointer;registeredInstance.$$.smartPtr=ptr;return registeredInstance["clone"]()}else{var rv=registeredInstance["clone"]();this.destructor(ptr);return rv}}function makeDefaultHandle(){if(this.isSmartPointer){return makeClassHandle(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:rawPointer,smartPtrType:this,smartPtr:ptr})}else{return makeClassHandle(this.registeredClass.instancePrototype,{ptrType:this,ptr})}}var actualType=this.registeredClass.getActualType(rawPointer);var registeredPointerRecord=registeredPointers[actualType];if(!registeredPointerRecord){return makeDefaultHandle.call(this)}var toType;if(this.isConst){toType=registeredPointerRecord.constPointerType}else{toType=registeredPointerRecord.pointerType}var dp=downcastPointer(rawPointer,this.registeredClass,toType.registeredClass);if(dp===null){return makeDefaultHandle.call(this)}if(this.isSmartPointer){return makeClassHandle(toType.registeredClass.instancePrototype,{ptrType:toType,ptr:dp,smartPtrType:this,smartPtr:ptr})}else{return makeClassHandle(toType.registeredClass.instancePrototype,{ptrType:toType,ptr:dp})}}var attachFinalizer=handle=>{if("undefined"===typeof FinalizationRegistry){attachFinalizer=handle=>handle;return handle}finalizationRegistry=new FinalizationRegistry(info=>{releaseClassHandle(info.$$)});attachFinalizer=handle=>{var $$=handle.$$;var hasSmartPtr=!!$$.smartPtr;if(hasSmartPtr){var info={$$};finalizationRegistry.register(handle,info,handle)}return handle};detachFinalizer=handle=>finalizationRegistry.unregister(handle);return attachFinalizer(handle)};var deletionQueue=[];var flushPendingDeletes=()=>{while(deletionQueue.length){var obj=deletionQueue.pop();obj.$$.deleteScheduled=false;obj["delete"]()}};var delayFunction;var init_ClassHandle=()=>{Object.assign(ClassHandle.prototype,{isAliasOf(other){if(!(this instanceof ClassHandle)){return false}if(!(other instanceof ClassHandle)){return false}var leftClass=this.$$.ptrType.registeredClass;var left=this.$$.ptr;other.$$=other.$$;var rightClass=other.$$.ptrType.registeredClass;var right=other.$$.ptr;while(leftClass.baseClass){left=leftClass.upcast(left);leftClass=leftClass.baseClass}while(rightClass.baseClass){right=rightClass.upcast(right);rightClass=rightClass.baseClass}return leftClass===rightClass&&left===right},clone(){if(!this.$$.ptr){throwInstanceAlreadyDeleted(this)}if(this.$$.preservePointerOnDelete){this.$$.count.value+=1;return this}else{var clone=attachFinalizer(Object.create(Object.getPrototypeOf(this),{$$:{value:shallowCopyInternalPointer(this.$$)}}));clone.$$.count.value+=1;clone.$$.deleteScheduled=false;return clone}},delete(){if(!this.$$.ptr){throwInstanceAlreadyDeleted(this)}if(this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete){throwBindingError("Object already scheduled for deletion")}detachFinalizer(this);releaseClassHandle(this.$$);if(!this.$$.preservePointerOnDelete){this.$$.smartPtr=undefined;this.$$.ptr=undefined}},isDeleted(){return!this.$$.ptr},deleteLater(){if(!this.$$.ptr){throwInstanceAlreadyDeleted(this)}if(this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete){throwBindingError("Object already scheduled for deletion")}deletionQueue.push(this);if(deletionQueue.length===1&&delayFunction){delayFunction(flushPendingDeletes)}this.$$.deleteScheduled=true;return this}})};function ClassHandle(){}var createNamedFunction=(name,body)=>Object.defineProperty(body,"name",{value:name});var ensureOverloadTable=(proto,methodName,humanName)=>{if(undefined===proto[methodName].overloadTable){var prevFunc=proto[methodName];proto[methodName]=function(...args){if(!proto[methodName].overloadTable.hasOwnProperty(args.length)){throwBindingError(`Function '${humanName}' called with an invalid number of arguments (${args.length}) - expects one of (${proto[methodName].overloadTable})!`)}return proto[methodName].overloadTable[args.length].apply(this,args)};proto[methodName].overloadTable=[];proto[methodName].overloadTable[prevFunc.argCount]=prevFunc}};var exposePublicSymbol=(name,value,numArguments)=>{if(Module.hasOwnProperty(name)){if(undefined===numArguments||undefined!==Module[name].overloadTable&&undefined!==Module[name].overloadTable[numArguments]){throwBindingError(`Cannot register public name '${name}' twice`)}ensureOverloadTable(Module,name,name);if(Module[name].overloadTable.hasOwnProperty(numArguments)){throwBindingError(`Cannot register multiple overloads of a function with the same number of arguments (${numArguments})!`)}Module[name].overloadTable[numArguments]=value}else{Module[name]=value;Module[name].argCount=numArguments}};var char_0=48;var char_9=57;var makeLegalFunctionName=name=>{name=name.replace(/[^a-zA-Z0-9_]/g,"$");var f=name.charCodeAt(0);if(f>=char_0&&f<=char_9){return`_${name}`}return name};function RegisteredClass(name,constructor,instancePrototype,rawDestructor,baseClass,getActualType,upcast,downcast){this.name=name;this.constructor=constructor;this.instancePrototype=instancePrototype;this.rawDestructor=rawDestructor;this.baseClass=baseClass;this.getActualType=getActualType;this.upcast=upcast;this.downcast=downcast;this.pureVirtualFunctions=[]}var upcastPointer=(ptr,ptrClass,desiredClass)=>{while(ptrClass!==desiredClass){if(!ptrClass.upcast){throwBindingError(`Expected null or instance of ${desiredClass.name}, got an instance of ${ptrClass.name}`)}ptr=ptrClass.upcast(ptr);ptrClass=ptrClass.baseClass}return ptr};function constNoSmartPtrRawPointerToWireType(destructors,handle){if(handle===null){if(this.isReference){throwBindingError(`null is not a valid ${this.name}`)}return 0}if(!handle.$$){throwBindingError(`Cannot pass "${embindRepr(handle)}" as a ${this.name}`)}if(!handle.$$.ptr){throwBindingError(`Cannot pass deleted object as a pointer of type ${this.name}`)}var handleClass=handle.$$.ptrType.registeredClass;var ptr=upcastPointer(handle.$$.ptr,handleClass,this.registeredClass);return ptr}function genericPointerToWireType(destructors,handle){var ptr;if(handle===null){if(this.isReference){throwBindingError(`null is not a valid ${this.name}`)}if(this.isSmartPointer){ptr=this.rawConstructor();if(destructors!==null){destructors.push(this.rawDestructor,ptr)}return ptr}else{return 0}}if(!handle||!handle.$$){throwBindingError(`Cannot pass "${embindRepr(handle)}" as a ${this.name}`)}if(!handle.$$.ptr){throwBindingError(`Cannot pass deleted object as a pointer of type ${this.name}`)}if(!this.isConst&&handle.$$.ptrType.isConst){throwBindingError(`Cannot convert argument of type ${handle.$$.smartPtrType?handle.$$.smartPtrType.name:handle.$$.ptrType.name} to parameter type ${this.name}`)}var handleClass=handle.$$.ptrType.registeredClass;ptr=upcastPointer(handle.$$.ptr,handleClass,this.registeredClass);if(this.isSmartPointer){if(undefined===handle.$$.smartPtr){throwBindingError("Passing raw pointer to smart pointer is illegal")}switch(this.sharingPolicy){case 0:if(handle.$$.smartPtrType===this){ptr=handle.$$.smartPtr}else{throwBindingError(`Cannot convert argument of type ${handle.$$.smartPtrType?handle.$$.smartPtrType.name:handle.$$.ptrType.name} to parameter type ${this.name}`)}break;case 1:ptr=handle.$$.smartPtr;break;case 2:if(handle.$$.smartPtrType===this){ptr=handle.$$.smartPtr}else{var clonedHandle=handle["clone"]();ptr=this.rawShare(ptr,Emval.toHandle(()=>clonedHandle["delete"]()));if(destructors!==null){destructors.push(this.rawDestructor,ptr)}}break;default:throwBindingError("Unsupporting sharing policy")}}return ptr}function nonConstNoSmartPtrRawPointerToWireType(destructors,handle){if(handle===null){if(this.isReference){throwBindingError(`null is not a valid ${this.name}`)}return 0}if(!handle.$$){throwBindingError(`Cannot pass "${embindRepr(handle)}" as a ${this.name}`)}if(!handle.$$.ptr){throwBindingError(`Cannot pass deleted object as a pointer of type ${this.name}`)}if(handle.$$.ptrType.isConst){throwBindingError(`Cannot convert argument of type ${handle.$$.ptrType.name} to parameter type ${this.name}`)}var handleClass=handle.$$.ptrType.registeredClass;var ptr=upcastPointer(handle.$$.ptr,handleClass,this.registeredClass);return ptr}var init_RegisteredPointer=()=>{Object.assign(RegisteredPointer.prototype,{getPointee(ptr){if(this.rawGetPointee){ptr=this.rawGetPointee(ptr)}return ptr},destructor(ptr){this.rawDestructor?.(ptr)},argPackAdvance:GenericWireTypeSize,readValueFromPointer:readPointer,fromWireType:RegisteredPointer_fromWireType})};function RegisteredPointer(name,registeredClass,isReference,isConst,isSmartPointer,pointeeType,sharingPolicy,rawGetPointee,rawConstructor,rawShare,rawDestructor){this.name=name;this.registeredClass=registeredClass;this.isReference=isReference;this.isConst=isConst;this.isSmartPointer=isSmartPointer;this.pointeeType=pointeeType;this.sharingPolicy=sharingPolicy;this.rawGetPointee=rawGetPointee;this.rawConstructor=rawConstructor;this.rawShare=rawShare;this.rawDestructor=rawDestructor;if(!isSmartPointer&&registeredClass.baseClass===undefined){if(isConst){this["toWireType"]=constNoSmartPtrRawPointerToWireType;this.destructorFunction=null}else{this["toWireType"]=nonConstNoSmartPtrRawPointerToWireType;this.destructorFunction=null}}else{this["toWireType"]=genericPointerToWireType}}var replacePublicSymbol=(name,value,numArguments)=>{if(!Module.hasOwnProperty(name)){throwInternalError("Replacing nonexistent public symbol")}if(undefined!==Module[name].overloadTable&&undefined!==numArguments){Module[name].overloadTable[numArguments]=value}else{Module[name]=value;Module[name].argCount=numArguments}};var dynCallLegacy=(sig,ptr,args)=>{sig=sig.replace(/p/g,"i");var f=Module["dynCall_"+sig];return f(ptr,...args)};var wasmTable;var dynCall=(sig,ptr,args=[])=>{var rtn=dynCallLegacy(sig,ptr,args);return rtn};var getDynCaller=(sig,ptr)=>(...args)=>dynCall(sig,ptr,args);var embind__requireFunction=(signature,rawFunction)=>{signature=readLatin1String(signature);function makeDynCaller(){return getDynCaller(signature,rawFunction)}var fp=makeDynCaller();if(typeof fp!="function"){throwBindingError(`unknown function pointer with signature ${signature}: ${rawFunction}`)}return fp};var extendError=(baseErrorType,errorName)=>{var errorClass=createNamedFunction(errorName,function(message){this.name=errorName;this.message=message;var stack=new Error(message).stack;if(stack!==undefined){this.stack=this.toString()+"\n"+stack.replace(/^Error(:[^\n]*)?\n/,"")}});errorClass.prototype=Object.create(baseErrorType.prototype);errorClass.prototype.constructor=errorClass;errorClass.prototype.toString=function(){if(this.message===undefined){return this.name}else{return`${this.name}: ${this.message}`}};return errorClass};var UnboundTypeError;var getTypeName=type=>{var ptr=___getTypeName(type);var rv=readLatin1String(ptr);_free(ptr);return rv};var throwUnboundTypeError=(message,types)=>{var unboundTypes=[];var seen={};function visit(type){if(seen[type]){return}if(registeredTypes[type]){return}if(typeDependencies[type]){typeDependencies[type].forEach(visit);return}unboundTypes.push(type);seen[type]=true}types.forEach(visit);throw new UnboundTypeError(`${message}: `+unboundTypes.map(getTypeName).join([", "]))};var __embind_register_class=(rawType,rawPointerType,rawConstPointerType,baseClassRawType,getActualTypeSignature,getActualType,upcastSignature,upcast,downcastSignature,downcast,name,destructorSignature,rawDestructor)=>{name=readLatin1String(name);getActualType=embind__requireFunction(getActualTypeSignature,getActualType);upcast&&=embind__requireFunction(upcastSignature,upcast);downcast&&=embind__requireFunction(downcastSignature,downcast);rawDestructor=embind__requireFunction(destructorSignature,rawDestructor);var legalFunctionName=makeLegalFunctionName(name);exposePublicSymbol(legalFunctionName,function(){throwUnboundTypeError(`Cannot construct ${name} due to unbound types`,[baseClassRawType])});whenDependentTypesAreResolved([rawType,rawPointerType,rawConstPointerType],baseClassRawType?[baseClassRawType]:[],base=>{base=base[0];var baseClass;var basePrototype;if(baseClassRawType){baseClass=base.registeredClass;basePrototype=baseClass.instancePrototype}else{basePrototype=ClassHandle.prototype}var constructor=createNamedFunction(name,function(...args){if(Object.getPrototypeOf(this)!==instancePrototype){throw new BindingError("Use 'new' to construct "+name)}if(undefined===registeredClass.constructor_body){throw new BindingError(name+" has no accessible constructor")}var body=registeredClass.constructor_body[args.length];if(undefined===body){throw new BindingError(`Tried to invoke ctor of ${name} with invalid number of parameters (${args.length}) - expected (${Object.keys(registeredClass.constructor_body).toString()}) parameters instead!`)}return body.apply(this,args)});var instancePrototype=Object.create(basePrototype,{constructor:{value:constructor}});constructor.prototype=instancePrototype;var registeredClass=new RegisteredClass(name,constructor,instancePrototype,rawDestructor,baseClass,getActualType,upcast,downcast);if(registeredClass.baseClass){registeredClass.baseClass.__derivedClasses??=[];registeredClass.baseClass.__derivedClasses.push(registeredClass)}var referenceConverter=new RegisteredPointer(name,registeredClass,true,false,false);var pointerConverter=new RegisteredPointer(name+"*",registeredClass,false,false,false);var constPointerConverter=new RegisteredPointer(name+" const*",registeredClass,false,true,false);registeredPointers[rawType]={pointerType:pointerConverter,constPointerType:constPointerConverter};replacePublicSymbol(legalFunctionName,constructor);return[referenceConverter,pointerConverter,constPointerConverter]})};function usesDestructorStack(argTypes){for(var i=1;i<argTypes.length;++i){if(argTypes[i]!==null&&argTypes[i].destructorFunction===undefined){return true}}return false}var runAndAbortIfError=func=>{try{return func()}catch(e){abort(e)}};var handleException=e=>{if(e instanceof ExitStatus||e=="unwind"){return EXITSTATUS}quit_(1,e)};var runtimeKeepaliveCounter=0;var keepRuntimeAlive=()=>noExitRuntime||runtimeKeepaliveCounter>0;var _proc_exit=code=>{EXITSTATUS=code;if(!keepRuntimeAlive()){Module["onExit"]?.(code);ABORT=true}quit_(code,new ExitStatus(code))};var exitJS=(status,implicit)=>{EXITSTATUS=status;_proc_exit(status)};var _exit=exitJS;var maybeExit=()=>{if(!keepRuntimeAlive()){try{_exit(EXITSTATUS)}catch(e){handleException(e)}}};var callUserCallback=func=>{if(ABORT){return}try{func();maybeExit()}catch(e){handleException(e)}};var runtimeKeepalivePush=()=>{runtimeKeepaliveCounter+=1};var runtimeKeepalivePop=()=>{runtimeKeepaliveCounter-=1};var Asyncify={instrumentWasmImports(imports){var importPattern=/^(invoke_.*|__asyncjs__.*)$/;for(let[x,original]of Object.entries(imports)){if(typeof original=="function"){let isAsyncifyImport=original.isAsync||importPattern.test(x)}}},instrumentWasmExports(exports){var ret={};for(let[x,original]of Object.entries(exports)){if(typeof original=="function"){ret[x]=(...args)=>{Asyncify.exportCallStack.push(x);try{return original(...args)}finally{if(!ABORT){var y=Asyncify.exportCallStack.pop();Asyncify.maybeStopUnwind()}}}}else{ret[x]=original}}return ret},State:{Normal:0,Unwinding:1,Rewinding:2,Disabled:3},state:0,StackSize:4096,currData:null,handleSleepReturnValue:0,exportCallStack:[],callStackNameToId:{},callStackIdToName:{},callStackId:0,asyncPromiseHandlers:null,sleepCallbacks:[],getCallStackId(funcName){var id=Asyncify.callStackNameToId[funcName];if(id===undefined){id=Asyncify.callStackId++;Asyncify.callStackNameToId[funcName]=id;Asyncify.callStackIdToName[id]=funcName}return id},maybeStopUnwind(){if(Asyncify.currData&&Asyncify.state===Asyncify.State.Unwinding&&Asyncify.exportCallStack.length===0){Asyncify.state=Asyncify.State.Normal;runAndAbortIfError(_asyncify_stop_unwind);if(typeof Fibers!="undefined"){Fibers.trampoline()}}},whenDone(){return new Promise((resolve,reject)=>{Asyncify.asyncPromiseHandlers={resolve,reject}})},allocateData(){var ptr=_malloc(12+Asyncify.StackSize);Asyncify.setDataHeader(ptr,ptr+12,Asyncify.StackSize);Asyncify.setDataRewindFunc(ptr);return ptr},setDataHeader(ptr,stack,stackSize){HEAPU32[ptr>>2]=stack;HEAPU32[ptr+4>>2]=stack+stackSize},setDataRewindFunc(ptr){var bottomOfCallStack=Asyncify.exportCallStack[0];var rewindId=Asyncify.getCallStackId(bottomOfCallStack);HEAP32[ptr+8>>2]=rewindId},getDataRewindFuncName(ptr){var id=HEAP32[ptr+8>>2];var name=Asyncify.callStackIdToName[id];return name},getDataRewindFunc(name){var func=wasmExports[name];return func},doRewind(ptr){var name=Asyncify.getDataRewindFuncName(ptr);var func=Asyncify.getDataRewindFunc(name);return func()},handleSleep(startAsync){if(ABORT)return;if(Asyncify.state===Asyncify.State.Normal){var reachedCallback=false;var reachedAfterCallback=false;startAsync((handleSleepReturnValue=0)=>{if(ABORT)return;Asyncify.handleSleepReturnValue=handleSleepReturnValue;reachedCallback=true;if(!reachedAfterCallback){return}Asyncify.state=Asyncify.State.Rewinding;runAndAbortIfError(()=>_asyncify_start_rewind(Asyncify.currData));if(typeof MainLoop!="undefined"&&MainLoop.func){MainLoop.resume()}var asyncWasmReturnValue,isError=false;try{asyncWasmReturnValue=Asyncify.doRewind(Asyncify.currData)}catch(err){asyncWasmReturnValue=err;isError=true}var handled=false;if(!Asyncify.currData){var asyncPromiseHandlers=Asyncify.asyncPromiseHandlers;if(asyncPromiseHandlers){Asyncify.asyncPromiseHandlers=null;(isError?asyncPromiseHandlers.reject:asyncPromiseHandlers.resolve)(asyncWasmReturnValue);handled=true}}if(isError&&!handled){throw asyncWasmReturnValue}});reachedAfterCallback=true;if(!reachedCallback){Asyncify.state=Asyncify.State.Unwinding;Asyncify.currData=Asyncify.allocateData();if(typeof MainLoop!="undefined"&&MainLoop.func){MainLoop.pause()}runAndAbortIfError(()=>_asyncify_start_unwind(Asyncify.currData))}}else if(Asyncify.state===Asyncify.State.Rewinding){Asyncify.state=Asyncify.State.Normal;runAndAbortIfError(_asyncify_stop_rewind);_free(Asyncify.currData);Asyncify.currData=null;Asyncify.sleepCallbacks.forEach(callUserCallback)}else{abort(`invalid state: ${Asyncify.state}`)}return Asyncify.handleSleepReturnValue},handleAsync(startAsync){return Asyncify.handleSleep(wakeUp=>{startAsync().then(wakeUp)})}};function craftInvokerFunction(humanName,argTypes,classType,cppInvokerFunc,cppTargetFunc,isAsync){var argCount=argTypes.length;if(argCount<2){throwBindingError("argTypes array size mismatch! Must at least get return value and 'this' types!")}var isClassMethodFunc=argTypes[1]!==null&&classType!==null;var needsDestructorStack=usesDestructorStack(argTypes);var returns=argTypes[0].name!=="void";var expectedArgCount=argCount-2;var argsWired=new Array(expectedArgCount);var invokerFuncArgs=[];var destructors=[];var invokerFn=function(...args){destructors.length=0;var thisWired;invokerFuncArgs.length=isClassMethodFunc?2:1;invokerFuncArgs[0]=cppTargetFunc;if(isClassMethodFunc){thisWired=argTypes[1]["toWireType"](destructors,this);invokerFuncArgs[1]=thisWired}for(var i=0;i<expectedArgCount;++i){argsWired[i]=argTypes[i+2]["toWireType"](destructors,args[i]);invokerFuncArgs.push(argsWired[i])}var rv=cppInvokerFunc(...invokerFuncArgs);function onDone(rv){if(needsDestructorStack){runDestructors(destructors)}else{for(var i=isClassMethodFunc?1:2;i<argTypes.length;i++){var param=i===1?thisWired:argsWired[i-2];if(argTypes[i].destructorFunction!==null){argTypes[i].destructorFunction(param)}}}if(returns){return argTypes[0]["fromWireType"](rv)}}if(Asyncify.currData){return Asyncify.whenDone().then(onDone)}return onDone(rv)};return createNamedFunction(humanName,invokerFn)}var heap32VectorToArray=(count,firstElement)=>{var array=[];for(var i=0;i<count;i++){array.push(HEAPU32[firstElement+i*4>>2])}return array};var getFunctionName=signature=>{signature=signature.trim();const argsIndex=signature.indexOf("(");if(argsIndex!==-1){return signature.substr(0,argsIndex)}else{return signature}};var __embind_register_class_class_function=(rawClassType,methodName,argCount,rawArgTypesAddr,invokerSignature,rawInvoker,fn,isAsync,isNonnullReturn)=>{var rawArgTypes=heap32VectorToArray(argCount,rawArgTypesAddr);methodName=readLatin1String(methodName);methodName=getFunctionName(methodName);rawInvoker=embind__requireFunction(invokerSignature,rawInvoker);whenDependentTypesAreResolved([],[rawClassType],classType=>{classType=classType[0];var humanName=`${classType.name}.${methodName}`;function unboundTypesHandler(){throwUnboundTypeError(`Cannot call ${humanName} due to unbound types`,rawArgTypes)}if(methodName.startsWith("@@")){methodName=Symbol[methodName.substring(2)]}var proto=classType.registeredClass.constructor;if(undefined===proto[methodName]){unboundTypesHandler.argCount=argCount-1;proto[methodName]=unboundTypesHandler}else{ensureOverloadTable(proto,methodName,humanName);proto[methodName].overloadTable[argCount-1]=unboundTypesHandler}whenDependentTypesAreResolved([],rawArgTypes,argTypes=>{var invokerArgsArray=[argTypes[0],null].concat(argTypes.slice(1));var func=craftInvokerFunction(humanName,invokerArgsArray,null,rawInvoker,fn,isAsync);if(undefined===proto[methodName].overloadTable){func.argCount=argCount-1;proto[methodName]=func}else{proto[methodName].overloadTable[argCount-1]=func}if(classType.registeredClass.__derivedClasses){for(const derivedClass of classType.registeredClass.__derivedClasses){if(!derivedClass.constructor.hasOwnProperty(methodName)){derivedClass.constructor[methodName]=func}}}return[]});return[]})};var __embind_register_class_constructor=(rawClassType,argCount,rawArgTypesAddr,invokerSignature,invoker,rawConstructor)=>{var rawArgTypes=heap32VectorToArray(argCount,rawArgTypesAddr);invoker=embind__requireFunction(invokerSignature,invoker);whenDependentTypesAreResolved([],[rawClassType],classType=>{classType=classType[0];var humanName=`constructor ${classType.name}`;if(undefined===classType.registeredClass.constructor_body){classType.registeredClass.constructor_body=[]}if(undefined!==classType.registeredClass.constructor_body[argCount-1]){throw new BindingError(`Cannot register multiple constructors with identical number of parameters (${argCount-1}) for class '${classType.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`)}classType.registeredClass.constructor_body[argCount-1]=()=>{throwUnboundTypeError(`Cannot construct ${classType.name} due to unbound types`,rawArgTypes)};whenDependentTypesAreResolved([],rawArgTypes,argTypes=>{argTypes.splice(1,0,null);classType.registeredClass.constructor_body[argCount-1]=craftInvokerFunction(humanName,argTypes,null,invoker,rawConstructor);return[]});return[]})};var __embind_register_class_function=(rawClassType,methodName,argCount,rawArgTypesAddr,invokerSignature,rawInvoker,context,isPureVirtual,isAsync,isNonnullReturn)=>{var rawArgTypes=heap32VectorToArray(argCount,rawArgTypesAddr);methodName=readLatin1String(methodName);methodName=getFunctionName(methodName);rawInvoker=embind__requireFunction(invokerSignature,rawInvoker);whenDependentTypesAreResolved([],[rawClassType],classType=>{classType=classType[0];var humanName=`${classType.name}.${methodName}`;if(methodName.startsWith("@@")){methodName=Symbol[methodName.substring(2)]}if(isPureVirtual){classType.registeredClass.pureVirtualFunctions.push(methodName)}function unboundTypesHandler(){throwUnboundTypeError(`Cannot call ${humanName} due to unbound types`,rawArgTypes)}var proto=classType.registeredClass.instancePrototype;var method=proto[methodName];if(undefined===method||undefined===method.overloadTable&&method.className!==classType.name&&method.argCount===argCount-2){unboundTypesHandler.argCount=argCount-2;unboundTypesHandler.className=classType.name;proto[methodName]=unboundTypesHandler}else{ensureOverloadTable(proto,methodName,humanName);proto[methodName].overloadTable[argCount-2]=unboundTypesHandler}whenDependentTypesAreResolved([],rawArgTypes,argTypes=>{var memberFunction=craftInvokerFunction(humanName,argTypes,classType,rawInvoker,context,isAsync);if(undefined===proto[methodName].overloadTable){memberFunction.argCount=argCount-2;proto[methodName]=memberFunction}else{proto[methodName].overloadTable[argCount-2]=memberFunction}return[]});return[]})};var validateThis=(this_,classType,humanName)=>{if(!(this_ instanceof Object)){throwBindingError(`${humanName} with invalid "this": ${this_}`)}if(!(this_ instanceof classType.registeredClass.constructor)){throwBindingError(`${humanName} incompatible with "this" of type ${this_.constructor.name}`)}if(!this_.$$.ptr){throwBindingError(`cannot call emscripten binding method ${humanName} on deleted object`)}return upcastPointer(this_.$$.ptr,this_.$$.ptrType.registeredClass,classType.registeredClass)};var __embind_register_class_property=(classType,fieldName,getterReturnType,getterSignature,getter,getterContext,setterArgumentType,setterSignature,setter,setterContext)=>{fieldName=readLatin1String(fieldName);getter=embind__requireFunction(getterSignature,getter);whenDependentTypesAreResolved([],[classType],classType=>{classType=classType[0];var humanName=`${classType.name}.${fieldName}`;var desc={get(){throwUnboundTypeError(`Cannot access ${humanName} due to unbound types`,[getterReturnType,setterArgumentType])},enumerable:true,configurable:true};if(setter){desc.set=()=>throwUnboundTypeError(`Cannot access ${humanName} due to unbound types`,[getterReturnType,setterArgumentType])}else{desc.set=v=>throwBindingError(humanName+" is a read-only property")}Object.defineProperty(classType.registeredClass.instancePrototype,fieldName,desc);whenDependentTypesAreResolved([],setter?[getterReturnType,setterArgumentType]:[getterReturnType],types=>{var getterReturnType=types[0];var desc={get(){var ptr=validateThis(this,classType,humanName+" getter");return getterReturnType["fromWireType"](getter(getterContext,ptr))},enumerable:true};if(setter){setter=embind__requireFunction(setterSignature,setter);var setterArgumentType=types[1];desc.set=function(v){var ptr=validateThis(this,classType,humanName+" setter");var destructors=[];setter(setterContext,ptr,setterArgumentType["toWireType"](destructors,v));runDestructors(destructors)}}Object.defineProperty(classType.registeredClass.instancePrototype,fieldName,desc);return[]});return[]})};var __embind_register_constant=(name,type,value)=>{name=readLatin1String(name);whenDependentTypesAreResolved([],[type],type=>{type=type[0];Module[name]=type["fromWireType"](value);return[]})};var emval_freelist=[];var emval_handles=[];var __emval_decref=handle=>{if(handle>9&&0===--emval_handles[handle+1]){emval_handles[handle]=undefined;emval_freelist.push(handle)}};var count_emval_handles=()=>emval_handles.length/2-5-emval_freelist.length;var init_emval=()=>{emval_handles.push(0,1,undefined,1,null,1,true,1,false,1);Module["count_emval_handles"]=count_emval_handles};var Emval={toValue:handle=>{if(!handle){throwBindingError("Cannot use deleted val. handle = "+handle)}return emval_handles[handle]},toHandle:value=>{switch(value){case undefined:return 2;case null:return 4;case true:return 6;case false:return 8;default:{const handle=emval_freelist.pop()||emval_handles.length;emval_handles[handle]=value;emval_handles[handle+1]=1;return handle}}}};var EmValType={name:"emscripten::val",fromWireType:handle=>{var rv=Emval.toValue(handle);__emval_decref(handle);return rv},toWireType:(destructors,value)=>Emval.toHandle(value),argPackAdvance:GenericWireTypeSize,readValueFromPointer:readPointer,destructorFunction:null};var __embind_register_emval=rawType=>registerType(rawType,EmValType);var enumReadValueFromPointer=(name,width,signed)=>{switch(width){case 1:return signed?function(pointer){return this["fromWireType"](HEAP8[pointer])}:function(pointer){return this["fromWireType"](HEAPU8[pointer])};case 2:return signed?function(pointer){return this["fromWireType"](HEAP16[pointer>>1])}:function(pointer){return this["fromWireType"](HEAPU16[pointer>>1])};case 4:return signed?function(pointer){return this["fromWireType"](HEAP32[pointer>>2])}:function(pointer){return this["fromWireType"](HEAPU32[pointer>>2])};default:throw new TypeError(`invalid integer width (${width}): ${name}`)}};var __embind_register_enum=(rawType,name,size,isSigned)=>{name=readLatin1String(name);function ctor(){}ctor.values={};registerType(rawType,{name,constructor:ctor,fromWireType:function(c){return this.constructor.values[c]},toWireType:(destructors,c)=>c.value,argPackAdvance:GenericWireTypeSize,readValueFromPointer:enumReadValueFromPointer(name,size,isSigned),destructorFunction:null});exposePublicSymbol(name,ctor)};var requireRegisteredType=(rawType,humanName)=>{var impl=registeredTypes[rawType];if(undefined===impl){throwBindingError(`${humanName} has unknown type ${getTypeName(rawType)}`)}return impl};var __embind_register_enum_value=(rawEnumType,name,enumValue)=>{var enumType=requireRegisteredType(rawEnumType,"enum");name=readLatin1String(name);var Enum=enumType.constructor;var Value=Object.create(enumType.constructor.prototype,{value:{value:enumValue},constructor:{value:createNamedFunction(`${enumType.name}_${name}`,function(){})}});Enum.values[enumValue]=Value;Enum[name]=Value};var floatReadValueFromPointer=(name,width)=>{switch(width){case 4:return function(pointer){return this["fromWireType"](HEAPF32[pointer>>2])};case 8:return function(pointer){return this["fromWireType"](HEAPF64[pointer>>3])};default:throw new TypeError(`invalid float width (${width}): ${name}`)}};var __embind_register_float=(rawType,name,size)=>{name=readLatin1String(name);registerType(rawType,{name,fromWireType:value=>value,toWireType:(destructors,value)=>value,argPackAdvance:GenericWireTypeSize,readValueFromPointer:floatReadValueFromPointer(name,size),destructorFunction:null})};var __embind_register_integer=(primitiveType,name,size,minRange,maxRange)=>{name=readLatin1String(name);if(maxRange===-1){maxRange=4294967295}var fromWireType=value=>value;if(minRange===0){var bitshift=32-8*size;fromWireType=value=>value<<bitshift>>>bitshift}var isUnsignedType=name.includes("unsigned");var checkAssertions=(value,toTypeName)=>{};var toWireType;if(isUnsignedType){toWireType=function(destructors,value){checkAssertions(value,this.name);return value>>>0}}else{toWireType=function(destructors,value){checkAssertions(value,this.name);return value}}registerType(primitiveType,{name,fromWireType,toWireType,argPackAdvance:GenericWireTypeSize,readValueFromPointer:integerReadValueFromPointer(name,size,minRange!==0),destructorFunction:null})};var __embind_register_memory_view=(rawType,dataTypeIndex,name)=>{var typeMapping=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array];var TA=typeMapping[dataTypeIndex];function decodeMemoryView(handle){var size=HEAPU32[handle>>2];var data=HEAPU32[handle+4>>2];return new TA(HEAP8.buffer,data,size)}name=readLatin1String(name);registerType(rawType,{name,fromWireType:decodeMemoryView,argPackAdvance:GenericWireTypeSize,readValueFromPointer:decodeMemoryView},{ignoreDuplicateRegistrations:true})};var EmValOptionalType=Object.assign({optional:true},EmValType);var __embind_register_optional=(rawOptionalType,rawType)=>{registerType(rawOptionalType,EmValOptionalType)};var __embind_register_std_string=(rawType,name)=>{name=readLatin1String(name);var stdStringIsUTF8=name==="std::string";registerType(rawType,{name,fromWireType(value){var length=HEAPU32[value>>2];var payload=value+4;var str;if(stdStringIsUTF8){var decodeStartPtr=payload;for(var i=0;i<=length;++i){var currentBytePtr=payload+i;if(i==length||HEAPU8[currentBytePtr]==0){var maxRead=currentBytePtr-decodeStartPtr;var stringSegment=UTF8ToString(decodeStartPtr,maxRead);if(str===undefined){str=stringSegment}else{str+=String.fromCharCode(0);str+=stringSegment}decodeStartPtr=currentBytePtr+1}}}else{var a=new Array(length);for(var i=0;i<length;++i){a[i]=String.fromCharCode(HEAPU8[payload+i])}str=a.join("")}_free(value);return str},toWireType(destructors,value){if(value instanceof ArrayBuffer){value=new Uint8Array(value)}var length;var valueIsOfTypeString=typeof value=="string";if(!(valueIsOfTypeString||value instanceof Uint8Array||value instanceof Uint8ClampedArray||value instanceof Int8Array)){throwBindingError("Cannot pass non-string to std::string")}if(stdStringIsUTF8&&valueIsOfTypeString){length=lengthBytesUTF8(value)}else{length=value.length}var base=_malloc(4+length+1);var ptr=base+4;HEAPU32[base>>2]=length;if(stdStringIsUTF8&&valueIsOfTypeString){stringToUTF8(value,ptr,length+1)}else{if(valueIsOfTypeString){for(var i=0;i<length;++i){var charCode=value.charCodeAt(i);if(charCode>255){_free(ptr);throwBindingError("String has UTF-16 code units that do not fit in 8 bits")}HEAPU8[ptr+i]=charCode}}else{for(var i=0;i<length;++i){HEAPU8[ptr+i]=value[i]}}}if(destructors!==null){destructors.push(_free,base)}return base},argPackAdvance:GenericWireTypeSize,readValueFromPointer:readPointer,destructorFunction(ptr){_free(ptr)}})};var UTF16Decoder=typeof TextDecoder!="undefined"?new TextDecoder("utf-16le"):undefined;var UTF16ToString=(ptr,maxBytesToRead)=>{var endPtr=ptr;var idx=endPtr>>1;var maxIdx=idx+maxBytesToRead/2;while(!(idx>=maxIdx)&&HEAPU16[idx])++idx;endPtr=idx<<1;if(endPtr-ptr>32&&UTF16Decoder)return UTF16Decoder.decode(HEAPU8.subarray(ptr,endPtr));var str="";for(var i=0;!(i>=maxBytesToRead/2);++i){var codeUnit=HEAP16[ptr+i*2>>1];if(codeUnit==0)break;str+=String.fromCharCode(codeUnit)}return str};var stringToUTF16=(str,outPtr,maxBytesToWrite)=>{maxBytesToWrite??=2147483647;if(maxBytesToWrite<2)return 0;maxBytesToWrite-=2;var startPtr=outPtr;var numCharsToWrite=maxBytesToWrite<str.length*2?maxBytesToWrite/2:str.length;for(var i=0;i<numCharsToWrite;++i){var codeUnit=str.charCodeAt(i);HEAP16[outPtr>>1]=codeUnit;outPtr+=2}HEAP16[outPtr>>1]=0;return outPtr-startPtr};var lengthBytesUTF16=str=>str.length*2;var UTF32ToString=(ptr,maxBytesToRead)=>{var i=0;var str="";while(!(i>=maxBytesToRead/4)){var utf32=HEAP32[ptr+i*4>>2];if(utf32==0)break;++i;if(utf32>=65536){var ch=utf32-65536;str+=String.fromCharCode(55296|ch>>10,56320|ch&1023)}else{str+=String.fromCharCode(utf32)}}return str};var stringToUTF32=(str,outPtr,maxBytesToWrite)=>{maxBytesToWrite??=2147483647;if(maxBytesToWrite<4)return 0;var startPtr=outPtr;var endPtr=startPtr+maxBytesToWrite-4;for(var i=0;i<str.length;++i){var codeUnit=str.charCodeAt(i);if(codeUnit>=55296&&codeUnit<=57343){var trailSurrogate=str.charCodeAt(++i);codeUnit=65536+((codeUnit&1023)<<10)|trailSurrogate&1023}HEAP32[outPtr>>2]=codeUnit;outPtr+=4;if(outPtr+4>endPtr)break}HEAP32[outPtr>>2]=0;return outPtr-startPtr};var lengthBytesUTF32=str=>{var len=0;for(var i=0;i<str.length;++i){var codeUnit=str.charCodeAt(i);if(codeUnit>=55296&&codeUnit<=57343)++i;len+=4}return len};var __embind_register_std_wstring=(rawType,charSize,name)=>{name=readLatin1String(name);var decodeString,encodeString,readCharAt,lengthBytesUTF;if(charSize===2){decodeString=UTF16ToString;encodeString=stringToUTF16;lengthBytesUTF=lengthBytesUTF16;readCharAt=pointer=>HEAPU16[pointer>>1]}else if(charSize===4){decodeString=UTF32ToString;encodeString=stringToUTF32;lengthBytesUTF=lengthBytesUTF32;readCharAt=pointer=>HEAPU32[pointer>>2]}registerType(rawType,{name,fromWireType:value=>{var length=HEAPU32[value>>2];var str;var decodeStartPtr=value+4;for(var i=0;i<=length;++i){var currentBytePtr=value+4+i*charSize;if(i==length||readCharAt(currentBytePtr)==0){var maxReadBytes=currentBytePtr-decodeStartPtr;var stringSegment=decodeString(decodeStartPtr,maxReadBytes);if(str===undefined){str=stringSegment}else{str+=String.fromCharCode(0);str+=stringSegment}decodeStartPtr=currentBytePtr+charSize}}_free(value);return str},toWireType:(destructors,value)=>{if(!(typeof value=="string")){throwBindingError(`Cannot pass non-string to C++ string type ${name}`)}var length=lengthBytesUTF(value);var ptr=_malloc(4+length+charSize);HEAPU32[ptr>>2]=length/charSize;encodeString(value,ptr+4,length+charSize);if(destructors!==null){destructors.push(_free,ptr)}return ptr},argPackAdvance:GenericWireTypeSize,readValueFromPointer:readPointer,destructorFunction(ptr){_free(ptr)}})};var __embind_register_value_array=(rawType,name,constructorSignature,rawConstructor,destructorSignature,rawDestructor)=>{tupleRegistrations[rawType]={name:readLatin1String(name),rawConstructor:embind__requireFunction(constructorSignature,rawConstructor),rawDestructor:embind__requireFunction(destructorSignature,rawDestructor),elements:[]}};var __embind_register_value_object=(rawType,name,constructorSignature,rawConstructor,destructorSignature,rawDestructor)=>{structRegistrations[rawType]={name:readLatin1String(name),rawConstructor:embind__requireFunction(constructorSignature,rawConstructor),rawDestructor:embind__requireFunction(destructorSignature,rawDestructor),fields:[]}};var __embind_register_value_object_field=(structType,fieldName,getterReturnType,getterSignature,getter,getterContext,setterArgumentType,setterSignature,setter,setterContext)=>{structRegistrations[structType].fields.push({fieldName:readLatin1String(fieldName),getterReturnType,getter:embind__requireFunction(getterSignature,getter),getterContext,setterArgumentType,setter:embind__requireFunction(setterSignature,setter),setterContext})};var __embind_register_void=(rawType,name)=>{name=readLatin1String(name);registerType(rawType,{isVoid:true,name,argPackAdvance:0,fromWireType:()=>undefined,toWireType:(destructors,o)=>undefined})};var nowIsMonotonic=1;var __emscripten_get_now_is_monotonic=()=>nowIsMonotonic;var __emscripten_throw_longjmp=()=>{throw Infinity};var emval_returnValue=(returnType,destructorsRef,handle)=>{var destructors=[];var result=returnType["toWireType"](destructors,handle);if(destructors.length){HEAPU32[destructorsRef>>2]=Emval.toHandle(destructors)}return result};var __emval_as=(handle,returnType,destructorsRef)=>{handle=Emval.toValue(handle);returnType=requireRegisteredType(returnType,"emval::as");return emval_returnValue(returnType,destructorsRef,handle)};var __emval_as_int64=(handle,returnType)=>{handle=Emval.toValue(handle);returnType=requireRegisteredType(returnType,"emval::as");return returnType["toWireType"](null,handle)};var __emval_await=promise=>Asyncify.handleAsync(()=>{promise=Emval.toValue(promise);return promise.then(Emval.toHandle)});__emval_await.isAsync=true;var emval_methodCallers=[];var __emval_call=(caller,handle,destructorsRef,args)=>{caller=emval_methodCallers[caller];handle=Emval.toValue(handle);return caller(null,handle,destructorsRef,args)};var emval_symbols={};var getStringOrSymbol=address=>{var symbol=emval_symbols[address];if(symbol===undefined){return readLatin1String(address)}return symbol};var __emval_call_method=(caller,objHandle,methodName,destructorsRef,args)=>{caller=emval_methodCallers[caller];objHandle=Emval.toValue(objHandle);methodName=getStringOrSymbol(methodName);return caller(objHandle,objHandle[methodName],destructorsRef,args)};var __emval_equals=(first,second)=>{first=Emval.toValue(first);second=Emval.toValue(second);return first==second};var emval_get_global=()=>{if(typeof globalThis=="object"){return globalThis}function testGlobal(obj){obj["$$$embind_global$$$"]=obj;var success=typeof $$$embind_global$$$=="object"&&obj["$$$embind_global$$$"]==obj;if(!success){delete obj["$$$embind_global$$$"]}return success}if(typeof $$$embind_global$$$=="object"){return $$$embind_global$$$}if(typeof global=="object"&&testGlobal(global)){$$$embind_global$$$=global}else if(typeof self=="object"&&testGlobal(self)){$$$embind_global$$$=self}if(typeof $$$embind_global$$$=="object"){return $$$embind_global$$$}throw Error("unable to get global object.")};var __emval_get_global=name=>{if(name===0){return Emval.toHandle(emval_get_global())}else{name=getStringOrSymbol(name);return Emval.toHandle(emval_get_global()[name])}};var emval_addMethodCaller=caller=>{var id=emval_methodCallers.length;emval_methodCallers.push(caller);return id};var emval_lookupTypes=(argCount,argTypes)=>{var a=new Array(argCount);for(var i=0;i<argCount;++i){a[i]=requireRegisteredType(HEAPU32[argTypes+i*4>>2],"parameter "+i)}return a};var reflectConstruct=Reflect.construct;var __emval_get_method_caller=(argCount,argTypes,kind)=>{var types=emval_lookupTypes(argCount,argTypes);var retType=types.shift();argCount--;var argN=new Array(argCount);var invokerFunction=(obj,func,destructorsRef,args)=>{var offset=0;for(var i=0;i<argCount;++i){argN[i]=types[i]["readValueFromPointer"](args+offset);offset+=types[i].argPackAdvance}var rv=kind===1?reflectConstruct(func,argN):func.apply(obj,argN);return emval_returnValue(retType,destructorsRef,rv)};var functionName=`methodCaller<(${types.map(t=>t.name).join(", ")}) => ${retType.name}>`;return emval_addMethodCaller(createNamedFunction(functionName,invokerFunction))};var __emval_get_property=(handle,key)=>{handle=Emval.toValue(handle);key=Emval.toValue(key);return Emval.toHandle(handle[key])};var __emval_incref=handle=>{if(handle>9){emval_handles[handle+1]+=1}};var __emval_new_array=()=>Emval.toHandle([]);var __emval_new_cstring=v=>Emval.toHandle(getStringOrSymbol(v));var __emval_new_object=()=>Emval.toHandle({});var __emval_run_destructors=handle=>{var destructors=Emval.toValue(handle);runDestructors(destructors);__emval_decref(handle)};var __emval_set_property=(handle,key,value)=>{handle=Emval.toValue(handle);key=Emval.toValue(key);value=Emval.toValue(value);handle[key]=value};var __emval_take_value=(type,arg)=>{type=requireRegisteredType(type,"_emval_take_value");var v=type["readValueFromPointer"](arg);return Emval.toHandle(v)};var __emval_typeof=handle=>{handle=Emval.toValue(handle);return Emval.toHandle(typeof handle)};var INT53_MAX=9007199254740992;var INT53_MIN=-9007199254740992;var bigintToI53Checked=num=>num<INT53_MIN||num>INT53_MAX?NaN:Number(num);function __gmtime_js(time,tmPtr){time=bigintToI53Checked(time);var date=new Date(time*1e3);HEAP32[tmPtr>>2]=date.getUTCSeconds();HEAP32[tmPtr+4>>2]=date.getUTCMinutes();HEAP32[tmPtr+8>>2]=date.getUTCHours();HEAP32[tmPtr+12>>2]=date.getUTCDate();HEAP32[tmPtr+16>>2]=date.getUTCMonth();HEAP32[tmPtr+20>>2]=date.getUTCFullYear()-1900;HEAP32[tmPtr+24>>2]=date.getUTCDay();var start=Date.UTC(date.getUTCFullYear(),0,1,0,0,0,0);var yday=(date.getTime()-start)/(1e3*60*60*24)|0;HEAP32[tmPtr+28>>2]=yday}var isLeapYear=year=>year%4===0&&(year%100!==0||year%400===0);var MONTH_DAYS_LEAP_CUMULATIVE=[0,31,60,91,121,152,182,213,244,274,305,335];var MONTH_DAYS_REGULAR_CUMULATIVE=[0,31,59,90,120,151,181,212,243,273,304,334];var ydayFromDate=date=>{var leap=isLeapYear(date.getFullYear());var monthDaysCumulative=leap?MONTH_DAYS_LEAP_CUMULATIVE:MONTH_DAYS_REGULAR_CUMULATIVE;var yday=monthDaysCumulative[date.getMonth()]+date.getDate()-1;return yday};function __localtime_js(time,tmPtr){time=bigintToI53Checked(time);var date=new Date(time*1e3);HEAP32[tmPtr>>2]=date.getSeconds();HEAP32[tmPtr+4>>2]=date.getMinutes();HEAP32[tmPtr+8>>2]=date.getHours();HEAP32[tmPtr+12>>2]=date.getDate();HEAP32[tmPtr+16>>2]=date.getMonth();HEAP32[tmPtr+20>>2]=date.getFullYear()-1900;HEAP32[tmPtr+24>>2]=date.getDay();var yday=ydayFromDate(date)|0;HEAP32[tmPtr+28>>2]=yday;HEAP32[tmPtr+36>>2]=-(date.getTimezoneOffset()*60);var start=new Date(date.getFullYear(),0,1);var summerOffset=new Date(date.getFullYear(),6,1).getTimezoneOffset();var winterOffset=start.getTimezoneOffset();var dst=(summerOffset!=winterOffset&&date.getTimezoneOffset()==Math.min(winterOffset,summerOffset))|0;HEAP32[tmPtr+32>>2]=dst}function __munmap_js(addr,len,prot,flags,fd,offset){offset=bigintToI53Checked(offset);try{var stream=SYSCALLS.getStreamFromFD(fd);if(prot&2){SYSCALLS.doMsync(addr,stream,len,flags,offset)}}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}var __timegm_js=function(tmPtr){var ret=(()=>{var time=Date.UTC(HEAP32[tmPtr+20>>2]+1900,HEAP32[tmPtr+16>>2],HEAP32[tmPtr+12>>2],HEAP32[tmPtr+8>>2],HEAP32[tmPtr+4>>2],HEAP32[tmPtr>>2],0);var date=new Date(time);HEAP32[tmPtr+24>>2]=date.getUTCDay();var start=Date.UTC(date.getUTCFullYear(),0,1,0,0,0,0);var yday=(date.getTime()-start)/(1e3*60*60*24)|0;HEAP32[tmPtr+28>>2]=yday;return date.getTime()/1e3})();return BigInt(ret)};var __tzset_js=(timezone,daylight,std_name,dst_name)=>{var currentYear=(new Date).getFullYear();var winter=new Date(currentYear,0,1);var summer=new Date(currentYear,6,1);var winterOffset=winter.getTimezoneOffset();var summerOffset=summer.getTimezoneOffset();var stdTimezoneOffset=Math.max(winterOffset,summerOffset);HEAPU32[timezone>>2]=stdTimezoneOffset*60;HEAP32[daylight>>2]=Number(winterOffset!=summerOffset);var extractZone=timezoneOffset=>{var sign=timezoneOffset>=0?"-":"+";var absOffset=Math.abs(timezoneOffset);var hours=String(Math.floor(absOffset/60)).padStart(2,"0");var minutes=String(absOffset%60).padStart(2,"0");return`UTC${sign}${hours}${minutes}`};var winterName=extractZone(winterOffset);var summerName=extractZone(summerOffset);if(summerOffset<winterOffset){stringToUTF8(winterName,std_name,17);stringToUTF8(summerName,dst_name,17)}else{stringToUTF8(winterName,dst_name,17);stringToUTF8(summerName,std_name,17)}};var readEmAsmArgsArray=[];var readEmAsmArgs=(sigPtr,buf)=>{readEmAsmArgsArray.length=0;var ch;while(ch=HEAPU8[sigPtr++]){var wide=ch!=105;wide&=ch!=112;buf+=wide&&buf%8?4:0;readEmAsmArgsArray.push(ch==112?HEAPU32[buf>>2]:ch==106?HEAP64[buf>>3]:ch==105?HEAP32[buf>>2]:HEAPF64[buf>>3]);buf+=wide?8:4}return readEmAsmArgsArray};var runEmAsmFunction=(code,sigPtr,argbuf)=>{var args=readEmAsmArgs(sigPtr,argbuf);return ASM_CONSTS[code](...args)};var _emscripten_asm_const_int=(code,sigPtr,argbuf)=>runEmAsmFunction(code,sigPtr,argbuf);var safeSetTimeout=(func,timeout)=>setTimeout(()=>{callUserCallback(func)},timeout);var _emscripten_set_main_loop_timing=(mode,value)=>{MainLoop.timingMode=mode;MainLoop.timingValue=value;if(!MainLoop.func){return 1}if(!MainLoop.running){MainLoop.running=true}if(mode==0){MainLoop.scheduler=function MainLoop_scheduler_setTimeout(){var timeUntilNextTick=Math.max(0,MainLoop.tickStartTime+value-_emscripten_get_now())|0;setTimeout(MainLoop.runner,timeUntilNextTick)};MainLoop.method="timeout"}else if(mode==1){MainLoop.scheduler=function MainLoop_scheduler_rAF(){MainLoop.requestAnimationFrame(MainLoop.runner)};MainLoop.method="rAF"}else if(mode==2){if(typeof MainLoop.setImmediate=="undefined"){if(typeof setImmediate=="undefined"){var setImmediates=[];var emscriptenMainLoopMessageId="setimmediate";var MainLoop_setImmediate_messageHandler=event=>{if(event.data===emscriptenMainLoopMessageId||event.data.target===emscriptenMainLoopMessageId){event.stopPropagation();setImmediates.shift()()}};addEventListener("message",MainLoop_setImmediate_messageHandler,true);MainLoop.setImmediate=func=>{setImmediates.push(func);if(ENVIRONMENT_IS_WORKER){Module["setImmediates"]??=[];Module["setImmediates"].push(func);postMessage({target:emscriptenMainLoopMessageId})}else postMessage(emscriptenMainLoopMessageId,"*")}}else{MainLoop.setImmediate=setImmediate}}MainLoop.scheduler=function MainLoop_scheduler_setImmediate(){MainLoop.setImmediate(MainLoop.runner)};MainLoop.method="immediate"}return 0};var _emscripten_get_now=()=>performance.now();var setMainLoop=(iterFunc,fps,simulateInfiniteLoop,arg,noSetTiming)=>{MainLoop.func=iterFunc;MainLoop.arg=arg;var thisMainLoopId=MainLoop.currentlyRunningMainloop;function checkIsRunning(){if(thisMainLoopId<MainLoop.currentlyRunningMainloop){maybeExit();return false}return true}MainLoop.running=false;MainLoop.runner=function MainLoop_runner(){if(ABORT)return;if(MainLoop.queue.length>0){var start=Date.now();var blocker=MainLoop.queue.shift();blocker.func(blocker.arg);if(MainLoop.remainingBlockers){var remaining=MainLoop.remainingBlockers;var next=remaining%1==0?remaining-1:Math.floor(remaining);if(blocker.counted){MainLoop.remainingBlockers=next}else{next=next+.5;MainLoop.remainingBlockers=(8*remaining+next)/9}}MainLoop.updateStatus();if(!checkIsRunning())return;setTimeout(MainLoop.runner,0);return}if(!checkIsRunning())return;MainLoop.currentFrameNumber=MainLoop.currentFrameNumber+1|0;if(MainLoop.timingMode==1&&MainLoop.timingValue>1&&MainLoop.currentFrameNumber%MainLoop.timingValue!=0){MainLoop.scheduler();return}else if(MainLoop.timingMode==0){MainLoop.tickStartTime=_emscripten_get_now()}MainLoop.runIter(iterFunc);if(!checkIsRunning())return;MainLoop.scheduler()};if(!noSetTiming){if(fps&&fps>0){_emscripten_set_main_loop_timing(0,1e3/fps)}else{_emscripten_set_main_loop_timing(1,1)}MainLoop.scheduler()}if(simulateInfiniteLoop){throw"unwind"}};var MainLoop={running:false,scheduler:null,method:"",currentlyRunningMainloop:0,func:null,arg:0,timingMode:0,timingValue:0,currentFrameNumber:0,queue:[],preMainLoop:[],postMainLoop:[],pause(){MainLoop.scheduler=null;MainLoop.currentlyRunningMainloop++},resume(){MainLoop.currentlyRunningMainloop++;var timingMode=MainLoop.timingMode;var timingValue=MainLoop.timingValue;var func=MainLoop.func;MainLoop.func=null;setMainLoop(func,0,false,MainLoop.arg,true);_emscripten_set_main_loop_timing(timingMode,timingValue);MainLoop.scheduler()},updateStatus(){if(Module["setStatus"]){var message=Module["statusMessage"]||"Please wait...";var remaining=MainLoop.remainingBlockers??0;var expected=MainLoop.expectedBlockers??0;if(remaining){if(remaining<expected){Module["setStatus"](`{message} ({expected - remaining}/{expected})`)}else{Module["setStatus"](message)}}else{Module["setStatus"]("")}}},init(){Module["preMainLoop"]&&MainLoop.preMainLoop.push(Module["preMainLoop"]);Module["postMainLoop"]&&MainLoop.postMainLoop.push(Module["postMainLoop"])},runIter(func){if(ABORT)return;for(var pre of MainLoop.preMainLoop){if(pre()===false){return}}callUserCallback(func);for(var post of MainLoop.postMainLoop){post()}},nextRAF:0,fakeRequestAnimationFrame(func){var now=Date.now();if(MainLoop.nextRAF===0){MainLoop.nextRAF=now+1e3/60}else{while(now+2>=MainLoop.nextRAF){MainLoop.nextRAF+=1e3/60}}var delay=Math.max(MainLoop.nextRAF-now,0);setTimeout(func,delay)},requestAnimationFrame(func){if(typeof requestAnimationFrame=="function"){requestAnimationFrame(func);return}var RAF=MainLoop.fakeRequestAnimationFrame;RAF(func)}};var warnOnce=text=>{warnOnce.shown||={};if(!warnOnce.shown[text]){warnOnce.shown[text]=1;err(text)}};var Browser={useWebGL:false,isFullscreen:false,pointerLock:false,moduleContextCreatedCallbacks:[],workers:[],init(){if(Browser.initted)return;Browser.initted=true;var imagePlugin={};imagePlugin["canHandle"]=function imagePlugin_canHandle(name){return!Module["noImageDecoding"]&&/\.(jpg|jpeg|png|bmp|webp)$/i.test(name)};imagePlugin["handle"]=function imagePlugin_handle(byteArray,name,onload,onerror){var b=new Blob([byteArray],{type:Browser.getMimetype(name)});if(b.size!==byteArray.length){b=new Blob([new Uint8Array(byteArray).buffer],{type:Browser.getMimetype(name)})}var url=URL.createObjectURL(b);var img=new Image;img.onload=()=>{var canvas=document.createElement("canvas");canvas.width=img.width;canvas.height=img.height;var ctx=canvas.getContext("2d");ctx.drawImage(img,0,0);preloadedImages[name]=canvas;URL.revokeObjectURL(url);onload?.(byteArray)};img.onerror=event=>{err(`Image ${url} could not be decoded`);onerror?.()};img.src=url};preloadPlugins.push(imagePlugin);var audioPlugin={};audioPlugin["canHandle"]=function audioPlugin_canHandle(name){return!Module["noAudioDecoding"]&&name.substr(-4)in{".ogg":1,".wav":1,".mp3":1}};audioPlugin["handle"]=function audioPlugin_handle(byteArray,name,onload,onerror){var done=false;function finish(audio){if(done)return;done=true;preloadedAudios[name]=audio;onload?.(byteArray)}var b=new Blob([byteArray],{type:Browser.getMimetype(name)});var url=URL.createObjectURL(b);var audio=new Audio;audio.addEventListener("canplaythrough",()=>finish(audio),false);audio.onerror=function audio_onerror(event){if(done)return;err(`warning: browser could not fully decode audio ${name}, trying slower base64 approach`);function encode64(data){var BASE="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var PAD="=";var ret="";var leftchar=0;var leftbits=0;for(var i=0;i<data.length;i++){leftchar=leftchar<<8|data[i];leftbits+=8;while(leftbits>=6){var curr=leftchar>>leftbits-6&63;leftbits-=6;ret+=BASE[curr]}}if(leftbits==2){ret+=BASE[(leftchar&3)<<4];ret+=PAD+PAD}else if(leftbits==4){ret+=BASE[(leftchar&15)<<2];ret+=PAD}return ret}audio.src="data:audio/x-"+name.substr(-3)+";base64,"+encode64(byteArray);finish(audio)};audio.src=url;safeSetTimeout(()=>{finish(audio)},1e4)};preloadPlugins.push(audioPlugin);function pointerLockChange(){Browser.pointerLock=document["pointerLockElement"]===Module["canvas"]||document["mozPointerLockElement"]===Module["canvas"]||document["webkitPointerLockElement"]===Module["canvas"]||document["msPointerLockElement"]===Module["canvas"]}var canvas=Module["canvas"];if(canvas){canvas.requestPointerLock=canvas["requestPointerLock"]||canvas["mozRequestPointerLock"]||canvas["webkitRequestPointerLock"]||canvas["msRequestPointerLock"]||(()=>{});canvas.exitPointerLock=document["exitPointerLock"]||document["mozExitPointerLock"]||document["webkitExitPointerLock"]||document["msExitPointerLock"]||(()=>{});canvas.exitPointerLock=canvas.exitPointerLock.bind(document);document.addEventListener("pointerlockchange",pointerLockChange,false);document.addEventListener("mozpointerlockchange",pointerLockChange,false);document.addEventListener("webkitpointerlockchange",pointerLockChange,false);document.addEventListener("mspointerlockchange",pointerLockChange,false);if(Module["elementPointerLock"]){canvas.addEventListener("click",ev=>{if(!Browser.pointerLock&&Module["canvas"].requestPointerLock){Module["canvas"].requestPointerLock();ev.preventDefault()}},false)}}},createContext(canvas,useWebGL,setInModule,webGLContextAttributes){if(useWebGL&&Module.ctx&&canvas==Module.canvas)return Module.ctx;var ctx;var contextHandle;if(useWebGL){var contextAttributes={antialias:false,alpha:false,majorVersion:1};if(webGLContextAttributes){for(var attribute in webGLContextAttributes){contextAttributes[attribute]=webGLContextAttributes[attribute]}}if(typeof GL!="undefined"){contextHandle=GL.createContext(canvas,contextAttributes);if(contextHandle){ctx=GL.getContext(contextHandle).GLctx}}}else{ctx=canvas.getContext("2d")}if(!ctx)return null;if(setInModule){Module.ctx=ctx;if(useWebGL)GL.makeContextCurrent(contextHandle);Browser.useWebGL=useWebGL;Browser.moduleContextCreatedCallbacks.forEach(callback=>callback());Browser.init()}return ctx},fullscreenHandlersInstalled:false,lockPointer:undefined,resizeCanvas:undefined,requestFullscreen(lockPointer,resizeCanvas){Browser.lockPointer=lockPointer;Browser.resizeCanvas=resizeCanvas;if(typeof Browser.lockPointer=="undefined")Browser.lockPointer=true;if(typeof Browser.resizeCanvas=="undefined")Browser.resizeCanvas=false;var canvas=Module["canvas"];function fullscreenChange(){Browser.isFullscreen=false;var canvasContainer=canvas.parentNode;if((document["fullscreenElement"]||document["mozFullScreenElement"]||document["msFullscreenElement"]||document["webkitFullscreenElement"]||document["webkitCurrentFullScreenElement"])===canvasContainer){canvas.exitFullscreen=Browser.exitFullscreen;if(Browser.lockPointer)canvas.requestPointerLock();Browser.isFullscreen=true;if(Browser.resizeCanvas){Browser.setFullscreenCanvasSize()}else{Browser.updateCanvasDimensions(canvas)}}else{canvasContainer.parentNode.insertBefore(canvas,canvasContainer);canvasContainer.parentNode.removeChild(canvasContainer);if(Browser.resizeCanvas){Browser.setWindowedCanvasSize()}else{Browser.updateCanvasDimensions(canvas)}}Module["onFullScreen"]?.(Browser.isFullscreen);Module["onFullscreen"]?.(Browser.isFullscreen)}if(!Browser.fullscreenHandlersInstalled){Browser.fullscreenHandlersInstalled=true;document.addEventListener("fullscreenchange",fullscreenChange,false);document.addEventListener("mozfullscreenchange",fullscreenChange,false);document.addEventListener("webkitfullscreenchange",fullscreenChange,false);document.addEventListener("MSFullscreenChange",fullscreenChange,false)}var canvasContainer=document.createElement("div");canvas.parentNode.insertBefore(canvasContainer,canvas);canvasContainer.appendChild(canvas);canvasContainer.requestFullscreen=canvasContainer["requestFullscreen"]||canvasContainer["mozRequestFullScreen"]||canvasContainer["msRequestFullscreen"]||(canvasContainer["webkitRequestFullscreen"]?()=>canvasContainer["webkitRequestFullscreen"](Element["ALLOW_KEYBOARD_INPUT"]):null)||(canvasContainer["webkitRequestFullScreen"]?()=>canvasContainer["webkitRequestFullScreen"](Element["ALLOW_KEYBOARD_INPUT"]):null);canvasContainer.requestFullscreen()},exitFullscreen(){if(!Browser.isFullscreen){return false}var CFS=document["exitFullscreen"]||document["cancelFullScreen"]||document["mozCancelFullScreen"]||document["msExitFullscreen"]||document["webkitCancelFullScreen"]||(()=>{});CFS.apply(document,[]);return true},safeSetTimeout(func,timeout){return safeSetTimeout(func,timeout)},getMimetype(name){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",bmp:"image/bmp",ogg:"audio/ogg",wav:"audio/wav",mp3:"audio/mpeg"}[name.substr(name.lastIndexOf(".")+1)]},getUserMedia(func){window.getUserMedia||=navigator["getUserMedia"]||navigator["mozGetUserMedia"];window.getUserMedia(func)},getMovementX(event){return event["movementX"]||event["mozMovementX"]||event["webkitMovementX"]||0},getMovementY(event){return event["movementY"]||event["mozMovementY"]||event["webkitMovementY"]||0},getMouseWheelDelta(event){var delta=0;switch(event.type){case"DOMMouseScroll":delta=event.detail/3;break;case"mousewheel":delta=event.wheelDelta/120;break;case"wheel":delta=event.deltaY;switch(event.deltaMode){case 0:delta/=100;break;case 1:delta/=3;break;case 2:delta*=80;break;default:throw"unrecognized mouse wheel delta mode: "+event.deltaMode}break;default:throw"unrecognized mouse wheel event: "+event.type}return delta},mouseX:0,mouseY:0,mouseMovementX:0,mouseMovementY:0,touches:{},lastTouches:{},calculateMouseCoords(pageX,pageY){var rect=Module["canvas"].getBoundingClientRect();var cw=Module["canvas"].width;var ch=Module["canvas"].height;var scrollX=typeof window.scrollX!="undefined"?window.scrollX:window.pageXOffset;var scrollY=typeof window.scrollY!="undefined"?window.scrollY:window.pageYOffset;var adjustedX=pageX-(scrollX+rect.left);var adjustedY=pageY-(scrollY+rect.top);adjustedX=adjustedX*(cw/rect.width);adjustedY=adjustedY*(ch/rect.height);return{x:adjustedX,y:adjustedY}},setMouseCoords(pageX,pageY){const{x,y}=Browser.calculateMouseCoords(pageX,pageY);Browser.mouseMovementX=x-Browser.mouseX;Browser.mouseMovementY=y-Browser.mouseY;Browser.mouseX=x;Browser.mouseY=y},calculateMouseEvent(event){if(Browser.pointerLock){if(event.type!="mousemove"&&"mozMovementX"in event){Browser.mouseMovementX=Browser.mouseMovementY=0}else{Browser.mouseMovementX=Browser.getMovementX(event);Browser.mouseMovementY=Browser.getMovementY(event)}Browser.mouseX+=Browser.mouseMovementX;Browser.mouseY+=Browser.mouseMovementY}else{if(event.type==="touchstart"||event.type==="touchend"||event.type==="touchmove"){var touch=event.touch;if(touch===undefined){return}var coords=Browser.calculateMouseCoords(touch.pageX,touch.pageY);if(event.type==="touchstart"){Browser.lastTouches[touch.identifier]=coords;Browser.touches[touch.identifier]=coords}else if(event.type==="touchend"||event.type==="touchmove"){var last=Browser.touches[touch.identifier];last||=coords;Browser.lastTouches[touch.identifier]=last;Browser.touches[touch.identifier]=coords}return}Browser.setMouseCoords(event.pageX,event.pageY)}},resizeListeners:[],updateResizeListeners(){var canvas=Module["canvas"];Browser.resizeListeners.forEach(listener=>listener(canvas.width,canvas.height))},setCanvasSize(width,height,noUpdates){var canvas=Module["canvas"];Browser.updateCanvasDimensions(canvas,width,height);if(!noUpdates)Browser.updateResizeListeners()},windowedWidth:0,windowedHeight:0,setFullscreenCanvasSize(){if(typeof SDL!="undefined"){var flags=HEAPU32[SDL.screen>>2];flags=flags|8388608;HEAP32[SDL.screen>>2]=flags}Browser.updateCanvasDimensions(Module["canvas"]);Browser.updateResizeListeners()},setWindowedCanvasSize(){if(typeof SDL!="undefined"){var flags=HEAPU32[SDL.screen>>2];flags=flags&~8388608;HEAP32[SDL.screen>>2]=flags}Browser.updateCanvasDimensions(Module["canvas"]);Browser.updateResizeListeners()},updateCanvasDimensions(canvas,wNative,hNative){if(wNative&&hNative){canvas.widthNative=wNative;canvas.heightNative=hNative}else{wNative=canvas.widthNative;hNative=canvas.heightNative}var w=wNative;var h=hNative;if(Module["forcedAspectRatio"]&&Module["forcedAspectRatio"]>0){if(w/h<Module["forcedAspectRatio"]){w=Math.round(h*Module["forcedAspectRatio"])}else{h=Math.round(w/Module["forcedAspectRatio"])}}if((document["fullscreenElement"]||document["mozFullScreenElement"]||document["msFullscreenElement"]||document["webkitFullscreenElement"]||document["webkitCurrentFullScreenElement"])===canvas.parentNode&&typeof screen!="undefined"){var factor=Math.min(screen.width/w,screen.height/h);w=Math.round(w*factor);h=Math.round(h*factor)}if(Browser.resizeCanvas){if(canvas.width!=w)canvas.width=w;if(canvas.height!=h)canvas.height=h;if(typeof canvas.style!="undefined"){canvas.style.removeProperty("width");canvas.style.removeProperty("height")}}else{if(canvas.width!=wNative)canvas.width=wNative;if(canvas.height!=hNative)canvas.height=hNative;if(typeof canvas.style!="undefined"){if(w!=wNative||h!=hNative){canvas.style.setProperty("width",w+"px","important");canvas.style.setProperty("height",h+"px","important")}else{canvas.style.removeProperty("width");canvas.style.removeProperty("height")}}}}};var safeRequestAnimationFrame=func=>MainLoop.requestAnimationFrame(()=>{callUserCallback(func)});var _emscripten_async_call=(func,arg,millis)=>{function wrapper(){(a1=>dynCall_vi(func,a1))(arg)}if(millis>=0){safeSetTimeout(wrapper,millis)}else{safeRequestAnimationFrame(wrapper)}};var _emscripten_date_now=()=>Date.now();var getHeapMax=()=>2147483648;var growMemory=size=>{var b=wasmMemory.buffer;var pages=(size-b.byteLength+65535)/65536|0;try{wasmMemory.grow(pages);updateMemoryViews();return 1}catch(e){}};var _emscripten_resize_heap=requestedSize=>{var oldSize=HEAPU8.length;requestedSize>>>=0;var maxHeapSize=getHeapMax();if(requestedSize>maxHeapSize){return false}for(var cutDown=1;cutDown<=4;cutDown*=2){var overGrownHeapSize=oldSize*(1+.2/cutDown);overGrownHeapSize=Math.min(overGrownHeapSize,requestedSize+100663296);var newSize=Math.min(maxHeapSize,alignMemory(Math.max(requestedSize,overGrownHeapSize),65536));var replacement=growMemory(newSize);if(replacement){return true}}return false};var _emscripten_sleep=ms=>Asyncify.handleSleep(wakeUp=>safeSetTimeout(wakeUp,ms));_emscripten_sleep.isAsync=true;var ENV={};var getExecutableName=()=>thisProgram||"./this.program";var getEnvStrings=()=>{if(!getEnvStrings.strings){var lang=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8";var env={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:lang,_:getExecutableName()};for(var x in ENV){if(ENV[x]===undefined)delete env[x];else env[x]=ENV[x]}var strings=[];for(var x in env){strings.push(`${x}=${env[x]}`)}getEnvStrings.strings=strings}return getEnvStrings.strings};var stringToAscii=(str,buffer)=>{for(var i=0;i<str.length;++i){HEAP8[buffer++]=str.charCodeAt(i)}HEAP8[buffer]=0};var _environ_get=(__environ,environ_buf)=>{var bufSize=0;getEnvStrings().forEach((string,i)=>{var ptr=environ_buf+bufSize;HEAPU32[__environ+i*4>>2]=ptr;stringToAscii(string,ptr);bufSize+=string.length+1});return 0};var _environ_sizes_get=(penviron_count,penviron_buf_size)=>{var strings=getEnvStrings();HEAPU32[penviron_count>>2]=strings.length;var bufSize=0;strings.forEach(string=>bufSize+=string.length+1);HEAPU32[penviron_buf_size>>2]=bufSize;return 0};function _fd_close(fd){try{var stream=SYSCALLS.getStreamFromFD(fd);FS.close(stream);return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}var doReadv=(stream,iov,iovcnt,offset)=>{var ret=0;for(var i=0;i<iovcnt;i++){var ptr=HEAPU32[iov>>2];var len=HEAPU32[iov+4>>2];iov+=8;var curr=FS.read(stream,HEAP8,ptr,len,offset);if(curr<0)return-1;ret+=curr;if(curr<len)break;if(typeof offset!="undefined"){offset+=curr}}return ret};function _fd_read(fd,iov,iovcnt,pnum){try{var stream=SYSCALLS.getStreamFromFD(fd);var num=doReadv(stream,iov,iovcnt);HEAPU32[pnum>>2]=num;return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}function _fd_seek(fd,offset,whence,newOffset){offset=bigintToI53Checked(offset);try{if(isNaN(offset))return 61;var stream=SYSCALLS.getStreamFromFD(fd);FS.llseek(stream,offset,whence);HEAP64[newOffset>>3]=BigInt(stream.position);if(stream.getdents&&offset===0&&whence===0)stream.getdents=null;return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}var doWritev=(stream,iov,iovcnt,offset)=>{var ret=0;for(var i=0;i<iovcnt;i++){var ptr=HEAPU32[iov>>2];var len=HEAPU32[iov+4>>2];iov+=8;var curr=FS.write(stream,HEAP8,ptr,len,offset);if(curr<0)return-1;ret+=curr;if(curr<len){break}if(typeof offset!="undefined"){offset+=curr}}return ret};function _fd_write(fd,iov,iovcnt,pnum){try{var stream=SYSCALLS.getStreamFromFD(fd);var num=doWritev(stream,iov,iovcnt);HEAPU32[pnum>>2]=num;return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}var getCFunc=ident=>{var func=Module["_"+ident];return func};var writeArrayToMemory=(array,buffer)=>{HEAP8.set(array,buffer)};var stackAlloc=sz=>__emscripten_stack_alloc(sz);var stringToUTF8OnStack=str=>{var size=lengthBytesUTF8(str)+1;var ret=stackAlloc(size);stringToUTF8(str,ret,size);return ret};var ccall=(ident,returnType,argTypes,args,opts)=>{var toC={string:str=>{var ret=0;if(str!==null&&str!==undefined&&str!==0){ret=stringToUTF8OnStack(str)}return ret},array:arr=>{var ret=stackAlloc(arr.length);writeArrayToMemory(arr,ret);return ret}};function convertReturnValue(ret){if(returnType==="string"){return UTF8ToString(ret)}if(returnType==="boolean")return Boolean(ret);return ret}var func=getCFunc(ident);var cArgs=[];var stack=0;if(args){for(var i=0;i<args.length;i++){var converter=toC[argTypes[i]];if(converter){if(stack===0)stack=stackSave();cArgs[i]=converter(args[i])}else{cArgs[i]=args[i]}}}var previousAsync=Asyncify.currData;var ret=func(...cArgs);function onDone(ret){runtimeKeepalivePop();if(stack!==0)stackRestore(stack);return convertReturnValue(ret)}var asyncMode=opts?.async;runtimeKeepalivePush();if(Asyncify.currData!=previousAsync){return Asyncify.whenDone().then(onDone)}ret=onDone(ret);if(asyncMode)return Promise.resolve(ret);return ret};FS.createPreloadedFile=FS_createPreloadedFile;FS.staticInit();InternalError=Module["InternalError"]=class InternalError extends Error{constructor(message){super(message);this.name="InternalError"}};embind_init_charCodes();BindingError=Module["BindingError"]=class BindingError extends Error{constructor(message){super(message);this.name="BindingError"}};init_ClassHandle();init_RegisteredPointer();UnboundTypeError=Module["UnboundTypeError"]=extendError(Error,"UnboundTypeError");init_emval();Module["requestAnimationFrame"]=MainLoop.requestAnimationFrame;Module["pauseMainLoop"]=MainLoop.pause;Module["resumeMainLoop"]=MainLoop.resume;MainLoop.init();Module["requestFullscreen"]=Browser.requestFullscreen;Module["setCanvasSize"]=Browser.setCanvasSize;Module["getUserMedia"]=Browser.getUserMedia;Module["createContext"]=Browser.createContext;var preloadedImages={};var preloadedAudios={};var wasmImports={Ca:SigCaptDialog_new,Ba:StuCaptDialog_new,Aa:Wizard_new,ua:__asyncjs__stuInternalGet,ta:__asyncjs__stuInternalSet,e:___cxa_throw,U:___syscall_fcntl64,pa:___syscall_fstat64,da:___syscall_getdents64,N:___syscall_ioctl,ma:___syscall_lstat64,na:___syscall_newfstatat,V:___syscall_openat,oa:___syscall_stat64,ra:__abort_js,z:__embind_finalize_value_array,v:__embind_finalize_value_object,aa:__embind_register_bigint,Ea:__embind_register_bool,r:__embind_register_class,I:__embind_register_class_class_function,u:__embind_register_class_constructor,i:__embind_register_class_function,o:__embind_register_class_property,za:__embind_register_constant,Da:__embind_register_emval,s:__embind_register_enum,h:__embind_register_enum_value,$:__embind_register_float,B:__embind_register_integer,y:__embind_register_memory_view,E:__embind_register_optional,_:__embind_register_std_string,R:__embind_register_std_wstring,A:__embind_register_value_array,w:__embind_register_value_object,m:__embind_register_value_object_field,Fa:__embind_register_void,qa:__emscripten_get_now_is_monotonic,ba:__emscripten_throw_longjmp,n:__emval_as,P:__emval_as_int64,Q:__emval_await,k:__emval_call,j:__emval_call_method,a:__emval_decref,M:__emval_equals,p:__emval_get_global,c:__emval_get_method_caller,l:__emval_get_property,g:__emval_incref,D:__emval_new_array,f:__emval_new_cstring,x:__emval_new_object,b:__emval_run_destructors,q:__emval_set_property,d:__emval_take_value,sa:__emval_typeof,fa:__gmtime_js,ga:__localtime_js,ea:__munmap_js,ha:__timegm_js,ia:__tzset_js,J:_emscripten_asm_const_int,X:_emscripten_async_call,O:_emscripten_date_now,W:_emscripten_get_now,ca:_emscripten_resize_heap,t:_emscripten_sleep,ka:_environ_get,la:_environ_sizes_get,K:_fd_close,S:_fd_read,ja:_fd_seek,T:_fd_write,L:invoke_diiii,H:invoke_ii,Y:invoke_iii,G:invoke_iiii,ya:invoke_iiiii,C:invoke_vi,F:invoke_vii,wa:invoke_viii,Z:invoke_viiii,va:invoke_viiiiiiii,xa:invoke_viiiiiiiii};var wasmExports=createWasm();var ___wasm_call_ctors=()=>(___wasm_call_ctors=wasmExports["Ha"])();var ___getTypeName=a0=>(___getTypeName=wasmExports["Ia"])(a0);var _internalStuOnInputReport=Module["_internalStuOnInputReport"]=(a0,a1,a2)=>(_internalStuOnInputReport=Module["_internalStuOnInputReport"]=wasmExports["Ka"])(a0,a1,a2);var _malloc=Module["_malloc"]=a0=>(_malloc=Module["_malloc"]=wasmExports["La"])(a0);var _free=Module["_free"]=a0=>(_free=Module["_free"]=wasmExports["Ma"])(a0);var _readLicenceInternalError=Module["_readLicenceInternalError"]=a0=>(_readLicenceInternalError=Module["_readLicenceInternalError"]=wasmExports["Na"])(a0);var _readLicenceInternal=Module["_readLicenceInternal"]=()=>(_readLicenceInternal=Module["_readLicenceInternal"]=wasmExports["Oa"])();var _writeLicenceInternal=Module["_writeLicenceInternal"]=()=>(_writeLicenceInternal=Module["_writeLicenceInternal"]=wasmExports["Pa"])();var _writeLicenceInternalError=Module["_writeLicenceInternalError"]=()=>(_writeLicenceInternalError=Module["_writeLicenceInternalError"]=wasmExports["Qa"])();var _deleteLicenceInternal=Module["_deleteLicenceInternal"]=()=>(_deleteLicenceInternal=Module["_deleteLicenceInternal"]=wasmExports["Ra"])();var _deleteLicenceInternalError=Module["_deleteLicenceInternalError"]=()=>(_deleteLicenceInternalError=Module["_deleteLicenceInternalError"]=wasmExports["Sa"])();var _emscripten_builtin_memalign=(a0,a1)=>(_emscripten_builtin_memalign=wasmExports["Ta"])(a0,a1);var _setThrew=(a0,a1)=>(_setThrew=wasmExports["Ua"])(a0,a1);var __emscripten_stack_restore=a0=>(__emscripten_stack_restore=wasmExports["Va"])(a0);var __emscripten_stack_alloc=a0=>(__emscripten_stack_alloc=wasmExports["Wa"])(a0);var _emscripten_stack_get_current=()=>(_emscripten_stack_get_current=wasmExports["Xa"])();var dynCall_ii=Module["dynCall_ii"]=(a0,a1)=>(dynCall_ii=Module["dynCall_ii"]=wasmExports["Ya"])(a0,a1);var dynCall_vii=Module["dynCall_vii"]=(a0,a1,a2)=>(dynCall_vii=Module["dynCall_vii"]=wasmExports["Za"])(a0,a1,a2);var dynCall_vi=Module["dynCall_vi"]=(a0,a1)=>(dynCall_vi=Module["dynCall_vi"]=wasmExports["_a"])(a0,a1);var dynCall_iii=Module["dynCall_iii"]=(a0,a1,a2)=>(dynCall_iii=Module["dynCall_iii"]=wasmExports["$a"])(a0,a1,a2);var dynCall_viiii=Module["dynCall_viiii"]=(a0,a1,a2,a3,a4)=>(dynCall_viiii=Module["dynCall_viiii"]=wasmExports["ab"])(a0,a1,a2,a3,a4);var dynCall_viii=Module["dynCall_viii"]=(a0,a1,a2,a3)=>(dynCall_viii=Module["dynCall_viii"]=wasmExports["bb"])(a0,a1,a2,a3);var dynCall_v=Module["dynCall_v"]=a0=>(dynCall_v=Module["dynCall_v"]=wasmExports["cb"])(a0);var dynCall_i=Module["dynCall_i"]=a0=>(dynCall_i=Module["dynCall_i"]=wasmExports["db"])(a0);var dynCall_iiiiii=Module["dynCall_iiiiii"]=(a0,a1,a2,a3,a4,a5)=>(dynCall_iiiiii=Module["dynCall_iiiiii"]=wasmExports["eb"])(a0,a1,a2,a3,a4,a5);var dynCall_iiiii=Module["dynCall_iiiii"]=(a0,a1,a2,a3,a4)=>(dynCall_iiiii=Module["dynCall_iiiii"]=wasmExports["fb"])(a0,a1,a2,a3,a4);var dynCall_iiiiiiiiiiiiii=Module["dynCall_iiiiiiiiiiiiii"]=(a0,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10,a11,a12,a13)=>(dynCall_iiiiiiiiiiiiii=Module["dynCall_iiiiiiiiiiiiii"]=wasmExports["gb"])(a0,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10,a11,a12,a13);var dynCall_viiiiiiiiiiiii=Module["dynCall_viiiiiiiiiiiii"]=(a0,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10,a11,a12,a13)=>(dynCall_viiiiiiiiiiiii=Module["dynCall_viiiiiiiiiiiii"]=wasmExports["hb"])(a0,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10,a11,a12,a13);var dynCall_iiii=Module["dynCall_iiii"]=(a0,a1,a2,a3)=>(dynCall_iiii=Module["dynCall_iiii"]=wasmExports["ib"])(a0,a1,a2,a3);var dynCall_viiiii=Module["dynCall_viiiii"]=(a0,a1,a2,a3,a4,a5)=>(dynCall_viiiii=Module["dynCall_viiiii"]=wasmExports["jb"])(a0,a1,a2,a3,a4,a5);var dynCall_dii=Module["dynCall_dii"]=(a0,a1,a2)=>(dynCall_dii=Module["dynCall_dii"]=wasmExports["kb"])(a0,a1,a2);var dynCall_viid=Module["dynCall_viid"]=(a0,a1,a2,a3)=>(dynCall_viid=Module["dynCall_viid"]=wasmExports["lb"])(a0,a1,a2,a3);var dynCall_viiiiiii=Module["dynCall_viiiiiii"]=(a0,a1,a2,a3,a4,a5,a6,a7)=>(dynCall_viiiiiii=Module["dynCall_viiiiiii"]=wasmExports["mb"])(a0,a1,a2,a3,a4,a5,a6,a7);var dynCall_viiiiiiii=Module["dynCall_viiiiiiii"]=(a0,a1,a2,a3,a4,a5,a6,a7,a8)=>(dynCall_viiiiiiii=Module["dynCall_viiiiiiii"]=wasmExports["nb"])(a0,a1,a2,a3,a4,a5,a6,a7,a8);var dynCall_iiff=Module["dynCall_iiff"]=(a0,a1,a2,a3)=>(dynCall_iiff=Module["dynCall_iiff"]=wasmExports["ob"])(a0,a1,a2,a3);var dynCall_iiiff=Module["dynCall_iiiff"]=(a0,a1,a2,a3,a4)=>(dynCall_iiiff=Module["dynCall_iiiff"]=wasmExports["pb"])(a0,a1,a2,a3,a4);var dynCall_iiiiiiiii=Module["dynCall_iiiiiiiii"]=(a0,a1,a2,a3,a4,a5,a6,a7,a8)=>(dynCall_iiiiiiiii=Module["dynCall_iiiiiiiii"]=wasmExports["qb"])(a0,a1,a2,a3,a4,a5,a6,a7,a8);var dynCall_iiifii=Module["dynCall_iiifii"]=(a0,a1,a2,a3,a4,a5)=>(dynCall_iiifii=Module["dynCall_iiifii"]=wasmExports["rb"])(a0,a1,a2,a3,a4,a5);var dynCall_viijii=Module["dynCall_viijii"]=(a0,a1,a2,a3,a4,a5)=>(dynCall_viijii=Module["dynCall_viijii"]=wasmExports["sb"])(a0,a1,a2,a3,a4,a5);var dynCall_fii=Module["dynCall_fii"]=(a0,a1,a2)=>(dynCall_fii=Module["dynCall_fii"]=wasmExports["tb"])(a0,a1,a2);var dynCall_viif=Module["dynCall_viif"]=(a0,a1,a2,a3)=>(dynCall_viif=Module["dynCall_viif"]=wasmExports["ub"])(a0,a1,a2,a3);var dynCall_viiiiifiiffi=Module["dynCall_viiiiifiiffi"]=(a0,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10,a11)=>(dynCall_viiiiifiiffi=Module["dynCall_viiiiifiiffi"]=wasmExports["vb"])(a0,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10,a11);var dynCall_iiiiiifiiffi=Module["dynCall_iiiiiifiiffi"]=(a0,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10,a11)=>(dynCall_iiiiiifiiffi=Module["dynCall_iiiiiifiiffi"]=wasmExports["wb"])(a0,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10,a11);var dynCall_iifi=Module["dynCall_iifi"]=(a0,a1,a2,a3)=>(dynCall_iifi=Module["dynCall_iifi"]=wasmExports["xb"])(a0,a1,a2,a3);var dynCall_viifffi=Module["dynCall_viifffi"]=(a0,a1,a2,a3,a4,a5,a6)=>(dynCall_viifffi=Module["dynCall_viifffi"]=wasmExports["yb"])(a0,a1,a2,a3,a4,a5,a6);var dynCall_viiifffi=Module["dynCall_viiifffi"]=(a0,a1,a2,a3,a4,a5,a6,a7)=>(dynCall_viiifffi=Module["dynCall_viiifffi"]=wasmExports["zb"])(a0,a1,a2,a3,a4,a5,a6,a7);var dynCall_iiiiiiii=Module["dynCall_iiiiiiii"]=(a0,a1,a2,a3,a4,a5,a6,a7)=>(dynCall_iiiiiiii=Module["dynCall_iiiiiiii"]=wasmExports["Ab"])(a0,a1,a2,a3,a4,a5,a6,a7);var dynCall_viiiiii=Module["dynCall_viiiiii"]=(a0,a1,a2,a3,a4,a5,a6)=>(dynCall_viiiiii=Module["dynCall_viiiiii"]=wasmExports["Bb"])(a0,a1,a2,a3,a4,a5,a6);var dynCall_iiiiiii=Module["dynCall_iiiiiii"]=(a0,a1,a2,a3,a4,a5,a6)=>(dynCall_iiiiiii=Module["dynCall_iiiiiii"]=wasmExports["Cb"])(a0,a1,a2,a3,a4,a5,a6);var dynCall_diiii=Module["dynCall_diiii"]=(a0,a1,a2,a3,a4)=>(dynCall_diiii=Module["dynCall_diiii"]=wasmExports["Db"])(a0,a1,a2,a3,a4);var dynCall_viiiiiiiii=Module["dynCall_viiiiiiiii"]=(a0,a1,a2,a3,a4,a5,a6,a7,a8,a9)=>(dynCall_viiiiiiiii=Module["dynCall_viiiiiiiii"]=wasmExports["Eb"])(a0,a1,a2,a3,a4,a5,a6,a7,a8,a9);var dynCall_iid=Module["dynCall_iid"]=(a0,a1,a2)=>(dynCall_iid=Module["dynCall_iid"]=wasmExports["Fb"])(a0,a1,a2);var dynCall_fi=Module["dynCall_fi"]=(a0,a1)=>(dynCall_fi=Module["dynCall_fi"]=wasmExports["Gb"])(a0,a1);var dynCall_vif=Module["dynCall_vif"]=(a0,a1,a2)=>(dynCall_vif=Module["dynCall_vif"]=wasmExports["Hb"])(a0,a1,a2);var dynCall_ff=Module["dynCall_ff"]=(a0,a1)=>(dynCall_ff=Module["dynCall_ff"]=wasmExports["Ib"])(a0,a1);var dynCall_iiiiiiiiii=Module["dynCall_iiiiiiiiii"]=(a0,a1,a2,a3,a4,a5,a6,a7,a8,a9)=>(dynCall_iiiiiiiiii=Module["dynCall_iiiiiiiiii"]=wasmExports["Jb"])(a0,a1,a2,a3,a4,a5,a6,a7,a8,a9);var dynCall_vjii=Module["dynCall_vjii"]=(a0,a1,a2,a3)=>(dynCall_vjii=Module["dynCall_vjii"]=wasmExports["Kb"])(a0,a1,a2,a3);var dynCall_vji=Module["dynCall_vji"]=(a0,a1,a2)=>(dynCall_vji=Module["dynCall_vji"]=wasmExports["Lb"])(a0,a1,a2);var dynCall_iiid=Module["dynCall_iiid"]=(a0,a1,a2,a3)=>(dynCall_iiid=Module["dynCall_iiid"]=wasmExports["Mb"])(a0,a1,a2,a3);var dynCall_iiiiiiiiiii=Module["dynCall_iiiiiiiiiii"]=(a0,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10)=>(dynCall_iiiiiiiiiii=Module["dynCall_iiiiiiiiiii"]=wasmExports["Nb"])(a0,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10);var dynCall_jiji=Module["dynCall_jiji"]=(a0,a1,a2,a3)=>(dynCall_jiji=Module["dynCall_jiji"]=wasmExports["Ob"])(a0,a1,a2,a3);var dynCall_iidiiii=Module["dynCall_iidiiii"]=(a0,a1,a2,a3,a4,a5,a6)=>(dynCall_iidiiii=Module["dynCall_iidiiii"]=wasmExports["Pb"])(a0,a1,a2,a3,a4,a5,a6);var dynCall_iiiiij=Module["dynCall_iiiiij"]=(a0,a1,a2,a3,a4,a5)=>(dynCall_iiiiij=Module["dynCall_iiiiij"]=wasmExports["Qb"])(a0,a1,a2,a3,a4,a5);var dynCall_iiiiid=Module["dynCall_iiiiid"]=(a0,a1,a2,a3,a4,a5)=>(dynCall_iiiiid=Module["dynCall_iiiiid"]=wasmExports["Rb"])(a0,a1,a2,a3,a4,a5);var dynCall_iiiiijj=Module["dynCall_iiiiijj"]=(a0,a1,a2,a3,a4,a5,a6)=>(dynCall_iiiiijj=Module["dynCall_iiiiijj"]=wasmExports["Sb"])(a0,a1,a2,a3,a4,a5,a6);var dynCall_iiiiiijj=Module["dynCall_iiiiiijj"]=(a0,a1,a2,a3,a4,a5,a6,a7)=>(dynCall_iiiiiijj=Module["dynCall_iiiiiijj"]=wasmExports["Tb"])(a0,a1,a2,a3,a4,a5,a6,a7);var _asyncify_start_unwind=a0=>(_asyncify_start_unwind=wasmExports["Ub"])(a0);var _asyncify_stop_unwind=()=>(_asyncify_stop_unwind=wasmExports["Vb"])();var _asyncify_start_rewind=a0=>(_asyncify_start_rewind=wasmExports["Wb"])(a0);var _asyncify_stop_rewind=()=>(_asyncify_stop_rewind=wasmExports["Xb"])();var _myStuDevice=Module["_myStuDevice"]=1046832;function invoke_iiiii(index,a1,a2,a3,a4){var sp=stackSave();try{return dynCall_iiiii(index,a1,a2,a3,a4)}catch(e){stackRestore(sp);if(e!==e+0)throw e;_setThrew(1,0)}}function invoke_ii(index,a1){var sp=stackSave();try{return dynCall_ii(index,a1)}catch(e){stackRestore(sp);if(e!==e+0)throw e;_setThrew(1,0)}}function invoke_iiii(index,a1,a2,a3){var sp=stackSave();try{return dynCall_iiii(index,a1,a2,a3)}catch(e){stackRestore(sp);if(e!==e+0)throw e;_setThrew(1,0)}}function invoke_diiii(index,a1,a2,a3,a4){var sp=stackSave();try{return dynCall_diiii(index,a1,a2,a3,a4)}catch(e){stackRestore(sp);if(e!==e+0)throw e;_setThrew(1,0)}}function invoke_vi(index,a1){var sp=stackSave();try{dynCall_vi(index,a1)}catch(e){stackRestore(sp);if(e!==e+0)throw e;_setThrew(1,0)}}function invoke_vii(index,a1,a2){var sp=stackSave();try{dynCall_vii(index,a1,a2)}catch(e){stackRestore(sp);if(e!==e+0)throw e;_setThrew(1,0)}}function invoke_viiiiiiiii(index,a1,a2,a3,a4,a5,a6,a7,a8,a9){var sp=stackSave();try{dynCall_viiiiiiiii(index,a1,a2,a3,a4,a5,a6,a7,a8,a9)}catch(e){stackRestore(sp);if(e!==e+0)throw e;_setThrew(1,0)}}function invoke_viiii(index,a1,a2,a3,a4){var sp=stackSave();try{dynCall_viiii(index,a1,a2,a3,a4)}catch(e){stackRestore(sp);if(e!==e+0)throw e;_setThrew(1,0)}}function invoke_viii(index,a1,a2,a3){var sp=stackSave();try{dynCall_viii(index,a1,a2,a3)}catch(e){stackRestore(sp);if(e!==e+0)throw e;_setThrew(1,0)}}function invoke_viiiiiiii(index,a1,a2,a3,a4,a5,a6,a7,a8){var sp=stackSave();try{dynCall_viiiiiiii(index,a1,a2,a3,a4,a5,a6,a7,a8)}catch(e){stackRestore(sp);if(e!==e+0)throw e;_setThrew(1,0)}}function invoke_iii(index,a1,a2){var sp=stackSave();try{return dynCall_iii(index,a1,a2)}catch(e){stackRestore(sp);if(e!==e+0)throw e;_setThrew(1,0)}}Module["ccall"]=ccall;var calledRun;dependenciesFulfilled=function runCaller(){if(!calledRun)run();if(!calledRun)dependenciesFulfilled=runCaller};function run(){if(runDependencies>0){return}preRun();if(runDependencies>0){return}function doRun(){if(calledRun)return;calledRun=true;Module["calledRun"]=true;if(ABORT)return;initRuntime();readyPromiseResolve(Module);Module["onRuntimeInitialized"]?.();postRun()}if(Module["setStatus"]){Module["setStatus"]("Running...");setTimeout(()=>{setTimeout(()=>Module["setStatus"](""),1);doRun()},1)}else{doRun()}}if(Module["preInit"]){if(typeof Module["preInit"]=="function")Module["preInit"]=[Module["preInit"]];while(Module["preInit"].length>0){Module["preInit"].pop()()}}run();moduleRtn=readyPromise;


  return moduleRtn;
}
);
})();
export default Module;
